function je(Ee,_e){return _e.forEach(function(j){j&&typeof j!="string"&&!Array.isArray(j)&&Object.keys(j).forEach(function(C){if(C!=="default"&&!(C in Ee)){var x=Object.getOwnPropertyDescriptor(j,C);Object.defineProperty(Ee,C,x.get?x:{enumerable:!0,get:function(){return j[C]}})}})}),Object.freeze(Object.defineProperty(Ee,Symbol.toStringTag,{value:"Module"}))}var He=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function Ve(Ee){return Ee&&Ee.__esModule&&Object.prototype.hasOwnProperty.call(Ee,"default")?Ee.default:Ee}var be={exports:{}};(function(Ee,_e){typeof window!="undefined"&&function(C,x){Ee.exports=x()}(He,function(){return function(j){var C={};function x(M){if(C[M])return C[M].exports;var O=C[M]={i:M,l:!1,exports:{}};return j[M].call(O.exports,O,O.exports,x),O.l=!0,O.exports}return x.m=j,x.c=C,x.d=function(M,O,A){x.o(M,O)||Object.defineProperty(M,O,{enumerable:!0,get:A})},x.r=function(M){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(M,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(M,"__esModule",{value:!0})},x.t=function(M,O){if(O&1&&(M=x(M)),O&8||O&4&&typeof M=="object"&&M&&M.__esModule)return M;var A=Object.create(null);if(x.r(A),Object.defineProperty(A,"default",{enumerable:!0,value:M}),O&2&&typeof M!="string")for(var b in M)x.d(A,b,function(P){return M[P]}.bind(null,b));return A},x.n=function(M){var O=M&&M.__esModule?function(){return M.default}:function(){return M};return x.d(O,"a",O),O},x.o=function(M,O){return Object.prototype.hasOwnProperty.call(M,O)},x.p="/dist/",x(x.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(j,C,x){var M=Object.prototype.hasOwnProperty,O="~";function A(){}Object.create&&(A.prototype=Object.create(null),new A().__proto__||(O=!1));function b(T,S,p){this.fn=T,this.context=S,this.once=p||!1}function P(T,S,p,y,g){if(typeof p!="function")throw new TypeError("The listener must be a function");var c=new b(p,y||T,g),i=O?O+S:S;return T._events[i]?T._events[i].fn?T._events[i]=[T._events[i],c]:T._events[i].push(c):(T._events[i]=c,T._eventsCount++),T}function I(T,S){--T._eventsCount===0?T._events=new A:delete T._events[S]}function L(){this._events=new A,this._eventsCount=0}L.prototype.eventNames=function(){var S=[],p,y;if(this._eventsCount===0)return S;for(y in p=this._events)M.call(p,y)&&S.push(O?y.slice(1):y);return Object.getOwnPropertySymbols?S.concat(Object.getOwnPropertySymbols(p)):S},L.prototype.listeners=function(S){var p=O?O+S:S,y=this._events[p];if(!y)return[];if(y.fn)return[y.fn];for(var g=0,c=y.length,i=new Array(c);g<c;g++)i[g]=y[g].fn;return i},L.prototype.listenerCount=function(S){var p=O?O+S:S,y=this._events[p];return y?y.fn?1:y.length:0},L.prototype.emit=function(S,p,y,g,c,i){var e=O?O+S:S;if(!this._events[e])return!1;var s=this._events[e],l=arguments.length,f,o;if(s.fn){switch(s.once&&this.removeListener(S,s.fn,void 0,!0),l){case 1:return s.fn.call(s.context),!0;case 2:return s.fn.call(s.context,p),!0;case 3:return s.fn.call(s.context,p,y),!0;case 4:return s.fn.call(s.context,p,y,g),!0;case 5:return s.fn.call(s.context,p,y,g,c),!0;case 6:return s.fn.call(s.context,p,y,g,c,i),!0}for(o=1,f=new Array(l-1);o<l;o++)f[o-1]=arguments[o];s.fn.apply(s.context,f)}else{var t=s.length,n;for(o=0;o<t;o++)switch(s[o].once&&this.removeListener(S,s[o].fn,void 0,!0),l){case 1:s[o].fn.call(s[o].context);break;case 2:s[o].fn.call(s[o].context,p);break;case 3:s[o].fn.call(s[o].context,p,y);break;case 4:s[o].fn.call(s[o].context,p,y,g);break;default:if(!f)for(n=1,f=new Array(l-1);n<l;n++)f[n-1]=arguments[n];s[o].fn.apply(s[o].context,f)}}return!0},L.prototype.on=function(S,p,y){return P(this,S,p,y,!1)},L.prototype.once=function(S,p,y){return P(this,S,p,y,!0)},L.prototype.removeListener=function(S,p,y,g){var c=O?O+S:S;if(!this._events[c])return this;if(!p)return I(this,c),this;var i=this._events[c];if(i.fn)i.fn===p&&(!g||i.once)&&(!y||i.context===y)&&I(this,c);else{for(var e=0,s=[],l=i.length;e<l;e++)(i[e].fn!==p||g&&!i[e].once||y&&i[e].context!==y)&&s.push(i[e]);s.length?this._events[c]=s.length===1?s[0]:s:I(this,c)}return this},L.prototype.removeAllListeners=function(S){var p;return S?(p=O?O+S:S,this._events[p]&&I(this,p)):(this._events=new A,this._eventsCount=0),this},L.prototype.off=L.prototype.removeListener,L.prototype.addListener=L.prototype.on,L.prefixed=O,L.EventEmitter=L,j.exports=L},"./node_modules/url-toolkit/src/url-toolkit.js":function(j,C,x){(function(M){var O=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,A=/^(?=([^\/?#]*))\1([^]*)$/,b=/(?:\/|^)\.(?=\/)/g,P=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,I={buildAbsoluteURL:function(L,T,S){if(S=S||{},L=L.trim(),T=T.trim(),!T){if(!S.alwaysNormalize)return L;var p=I.parseURL(L);if(!p)throw new Error("Error trying to parse base URL.");return p.path=I.normalizePath(p.path),I.buildURLFromParts(p)}var y=I.parseURL(T);if(!y)throw new Error("Error trying to parse relative URL.");if(y.scheme)return S.alwaysNormalize?(y.path=I.normalizePath(y.path),I.buildURLFromParts(y)):T;var g=I.parseURL(L);if(!g)throw new Error("Error trying to parse base URL.");if(!g.netLoc&&g.path&&g.path[0]!=="/"){var c=A.exec(g.path);g.netLoc=c[1],g.path=c[2]}g.netLoc&&!g.path&&(g.path="/");var i={scheme:g.scheme,netLoc:y.netLoc,path:null,params:y.params,query:y.query,fragment:y.fragment};if(!y.netLoc&&(i.netLoc=g.netLoc,y.path[0]!=="/"))if(!y.path)i.path=g.path,y.params||(i.params=g.params,y.query||(i.query=g.query));else{var e=g.path,s=e.substring(0,e.lastIndexOf("/")+1)+y.path;i.path=I.normalizePath(s)}return i.path===null&&(i.path=S.alwaysNormalize?I.normalizePath(y.path):y.path),I.buildURLFromParts(i)},parseURL:function(L){var T=O.exec(L);return T?{scheme:T[1]||"",netLoc:T[2]||"",path:T[3]||"",params:T[4]||"",query:T[5]||"",fragment:T[6]||""}:null},normalizePath:function(L){for(L=L.split("").reverse().join("").replace(b,"");L.length!==(L=L.replace(P,"")).length;);return L.split("").reverse().join("")},buildURLFromParts:function(L){return L.scheme+L.netLoc+L.path+L.params+L.query+L.fragment}};j.exports=I})()},"./node_modules/webworkify-webpack/index.js":function(j,C,x){function M(S){var p={};function y(c){if(p[c])return p[c].exports;var i=p[c]={i:c,l:!1,exports:{}};return S[c].call(i.exports,i,i.exports,y),i.l=!0,i.exports}y.m=S,y.c=p,y.i=function(c){return c},y.d=function(c,i,e){y.o(c,i)||Object.defineProperty(c,i,{configurable:!1,enumerable:!0,get:e})},y.r=function(c){Object.defineProperty(c,"__esModule",{value:!0})},y.n=function(c){var i=c&&c.__esModule?function(){return c.default}:function(){return c};return y.d(i,"a",i),i},y.o=function(c,i){return Object.prototype.hasOwnProperty.call(c,i)},y.p="/",y.oe=function(c){throw console.error(c),c};var g=y(y.s=ENTRY_MODULE);return g.default||g}var O="[\\.|\\-|\\+|\\w|/|@]+",A="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+O+").*?\\)";function b(S){return(S+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function P(S){return!isNaN(1*S)}function I(S,p,y){var g={};g[y]=[];var c=p.toString(),i=c.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!i)return g;for(var e=i[1],s=new RegExp("(\\\\n|\\W)"+b(e)+A,"g"),l;l=s.exec(c);)l[3]!=="dll-reference"&&g[y].push(l[3]);for(s=new RegExp("\\("+b(e)+'\\("(dll-reference\\s('+O+'))"\\)\\)'+A,"g");l=s.exec(c);)S[l[2]]||(g[y].push(l[1]),S[l[2]]=x(l[1]).m),g[l[2]]=g[l[2]]||[],g[l[2]].push(l[4]);for(var f=Object.keys(g),o=0;o<f.length;o++)for(var t=0;t<g[f[o]].length;t++)P(g[f[o]][t])&&(g[f[o]][t]=1*g[f[o]][t]);return g}function L(S){var p=Object.keys(S);return p.reduce(function(y,g){return y||S[g].length>0},!1)}function T(S,p){for(var y={main:[p]},g={main:[]},c={main:{}};L(y);)for(var i=Object.keys(y),e=0;e<i.length;e++){var s=i[e],l=y[s],f=l.pop();if(c[s]=c[s]||{},!(c[s][f]||!S[s][f])){c[s][f]=!0,g[s]=g[s]||[],g[s].push(f);for(var o=I(S,S[s][f],s),t=Object.keys(o),n=0;n<t.length;n++)y[t[n]]=y[t[n]]||[],y[t[n]]=y[t[n]].concat(o[t[n]])}}return g}j.exports=function(S,p){p=p||{};var y={main:x.m},g=p.all?{main:Object.keys(y.main)}:T(y,S),c="";Object.keys(g).filter(function(f){return f!=="main"}).forEach(function(f){for(var o=0;g[f][o];)o++;g[f].push(o),y[f][o]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",c=c+"var "+f+" = ("+M.toString().replace("ENTRY_MODULE",JSON.stringify(o))+")({"+g[f].map(function(t){return""+JSON.stringify(t)+": "+y[f][t].toString()}).join(",")+`});
`}),c=c+"new (("+M.toString().replace("ENTRY_MODULE",JSON.stringify(S))+")({"+g.main.map(function(f){return""+JSON.stringify(f)+": "+y.main[f].toString()}).join(",")+"}))(self);";var i=new window.Blob([c],{type:"text/javascript"});if(p.bare)return i;var e=window.URL||window.webkitURL||window.mozURL||window.msURL,s=e.createObjectURL(i),l=new window.Worker(s);return l.objectURL=s,l}},"./src/config.ts":function(j,C,x){x.r(C),x.d(C,"hlsDefaultConfig",function(){return n}),x.d(C,"mergeConfig",function(){return h}),x.d(C,"enableStreamingMode",function(){return d});var M=x("./src/controller/abr-controller.ts"),O=x("./src/controller/audio-stream-controller.ts"),A=x("./src/controller/audio-track-controller.ts"),b=x("./src/controller/subtitle-stream-controller.ts"),P=x("./src/controller/subtitle-track-controller.ts"),I=x("./src/controller/buffer-controller.ts"),L=x("./src/controller/timeline-controller.ts"),T=x("./src/controller/cap-level-controller.ts"),S=x("./src/controller/fps-controller.ts"),p=x("./src/controller/eme-controller.ts"),y=x("./src/controller/cmcd-controller.ts"),g=x("./src/utils/xhr-loader.ts"),c=x("./src/utils/fetch-loader.ts"),i=x("./src/utils/cues.ts"),e=x("./src/utils/mediakeys-helper.ts"),s=x("./src/utils/logger.ts");function l(){return l=Object.assign?Object.assign.bind():function(u){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var v in a)Object.prototype.hasOwnProperty.call(a,v)&&(u[v]=a[v])}return u},l.apply(this,arguments)}function f(u,r){var a=Object.keys(u);if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(u);r&&(v=v.filter(function(m){return Object.getOwnPropertyDescriptor(u,m).enumerable})),a.push.apply(a,v)}return a}function o(u){for(var r=1;r<arguments.length;r++){var a=arguments[r]!=null?arguments[r]:{};r%2?f(Object(a),!0).forEach(function(v){t(u,v,a[v])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(a)):f(Object(a)).forEach(function(v){Object.defineProperty(u,v,Object.getOwnPropertyDescriptor(a,v))})}return u}function t(u,r,a){return r in u?Object.defineProperty(u,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):u[r]=a,u}var n=o(o({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:g.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:M.default,bufferController:I.default,capLevelController:T.default,fpsController:S.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:e.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},E()),{},{subtitleStreamController:b.SubtitleStreamController,subtitleTrackController:P.default,timelineController:L.TimelineController,audioStreamController:O.default,audioTrackController:A.default,emeController:p.default,cmcdController:y.default});function E(){return{cueHandler:i.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function h(u,r){if((r.liveSyncDurationCount||r.liveMaxLatencyDurationCount)&&(r.liveSyncDuration||r.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(r.liveMaxLatencyDurationCount!==void 0&&(r.liveSyncDurationCount===void 0||r.liveMaxLatencyDurationCount<=r.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(r.liveMaxLatencyDuration!==void 0&&(r.liveSyncDuration===void 0||r.liveMaxLatencyDuration<=r.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return l({},u,r)}function d(u){var r=u.loader;if(r!==c.default&&r!==g.default)s.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),u.progressive=!1;else{var a=Object(c.fetchSupported)();a&&(u.loader=c.default,u.progressive=!0,u.enableSoftwareAES=!0,s.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":function(j,C,x){x.r(C);var M=x("./src/polyfills/number.ts"),O=x("./src/utils/ewma-bandwidth-estimator.ts"),A=x("./src/events.ts"),b=x("./src/utils/buffer-helper.ts"),P=x("./src/errors.ts"),I=x("./src/types/loader.ts"),L=x("./src/utils/logger.ts");function T(y,g){for(var c=0;c<g.length;c++){var i=g[c];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(y,i.key,i)}}function S(y,g,c){return g&&T(y.prototype,g),c&&T(y,c),Object.defineProperty(y,"prototype",{writable:!1}),y}var p=function(){function y(c){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=c;var i=c.config;this.bwEstimator=new O.default(i.abrEwmaSlowVoD,i.abrEwmaFastVoD,i.abrEwmaDefaultEstimate),this.registerListeners()}var g=y.prototype;return g.registerListeners=function(){var i=this.hls;i.on(A.Events.FRAG_LOADING,this.onFragLoading,this),i.on(A.Events.FRAG_LOADED,this.onFragLoaded,this),i.on(A.Events.FRAG_BUFFERED,this.onFragBuffered,this),i.on(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.on(A.Events.ERROR,this.onError,this)},g.unregisterListeners=function(){var i=this.hls;i.off(A.Events.FRAG_LOADING,this.onFragLoading,this),i.off(A.Events.FRAG_LOADED,this.onFragLoaded,this),i.off(A.Events.FRAG_BUFFERED,this.onFragBuffered,this),i.off(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.off(A.Events.ERROR,this.onError,this)},g.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},g.onFragLoading=function(i,e){var s=e.frag;if(s.type===I.PlaylistLevelType.MAIN&&!this.timer){var l;this.fragCurrent=s,this.partCurrent=(l=e.part)!=null?l:null,this.timer=self.setInterval(this.onCheck,100)}},g.onLevelLoaded=function(i,e){var s=this.hls.config;e.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD)},g._abandonRulesCheck=function(){var i=this.fragCurrent,e=this.partCurrent,s=this.hls,l=s.autoLevelEnabled,f=s.config,o=s.media;if(!(!i||!o)){var t=e?e.stats:i.stats,n=e?e.duration:i.duration;if(t.aborted){L.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!l||o.paused||!o.playbackRate||!o.readyState)){var E=performance.now()-t.loading.start,h=Math.abs(o.playbackRate);if(!(E<=500*n/h)){var d=s.levels,u=s.minAutoLevel,r=d[i.level],a=t.total||Math.max(t.loaded,Math.round(n*r.maxBitrate/8)),v=Math.max(1,t.bwEstimate?t.bwEstimate/8:t.loaded*1e3/E),m=(a-t.loaded)/v,D=o.currentTime,R=(b.BufferHelper.bufferInfo(o,D,f.maxBufferHole).end-D)/h;if(!(R>=2*n/h||m<=R)){var F=Number.POSITIVE_INFINITY,_;for(_=i.level-1;_>u;_--){var B=d[_].maxBitrate;if(F=n*B/(8*.8*v),F<R)break}if(!(F>=m)){var U=this.bwEstimator.getEstimate();L.logger.warn("Fragment "+i.sn+(e?" part "+e.index:"")+" of level "+i.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+_+`
      Current BW estimate: `+(Object(M.isFiniteNumber)(U)?(U/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+m.toFixed(3)+` s
      Estimated load time for the next fragment: `+F.toFixed(3)+` s
      Time to underbuffer: `+R.toFixed(3)+" s"),s.nextLoadLevel=_,this.bwEstimator.sample(E,t.loaded),this.clearTimer(),i.loader&&(this.fragCurrent=this.partCurrent=null,i.loader.abort()),s.trigger(A.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,part:e,stats:t})}}}}}},g.onFragLoaded=function(i,e){var s=e.frag,l=e.part;if(s.type===I.PlaylistLevelType.MAIN&&Object(M.isFiniteNumber)(s.sn)){var f=l?l.stats:s.stats,o=l?l.duration:s.duration;if(this.clearTimer(),this.lastLoadedFragLevel=s.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var t=this.hls.levels[s.level],n=(t.loaded?t.loaded.bytes:0)+f.loaded,E=(t.loaded?t.loaded.duration:0)+o;t.loaded={bytes:n,duration:E},t.realBitrate=Math.round(8*n/E)}if(s.bitrateTest){var h={stats:f,frag:s,part:l,id:s.type};this.onFragBuffered(A.Events.FRAG_BUFFERED,h),s.bitrateTest=!1}}},g.onFragBuffered=function(i,e){var s=e.frag,l=e.part,f=l?l.stats:s.stats;if(!f.aborted&&!(s.type!==I.PlaylistLevelType.MAIN||s.sn==="initSegment")){var o=f.parsing.end-f.loading.start;this.bwEstimator.sample(o,f.loaded),f.bwEstimate=this.bwEstimator.getEstimate(),s.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}},g.onError=function(i,e){switch(e.details){case P.ErrorDetails.FRAG_LOAD_ERROR:case P.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break}},g.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},g.getNextABRAutoLevel=function(){var i=this.fragCurrent,e=this.partCurrent,s=this.hls,l=s.maxAutoLevel,f=s.config,o=s.minAutoLevel,t=s.media,n=e?e.duration:i?i.duration:0,E=t?t.currentTime:0,h=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,d=this.bwEstimator?this.bwEstimator.getEstimate():f.abrEwmaDefaultEstimate,u=(b.BufferHelper.bufferInfo(t,E,f.maxBufferHole).end-E)/h,r=this.findBestLevel(d,o,l,u,f.abrBandWidthFactor,f.abrBandWidthUpFactor);if(r>=0)return r;L.logger.trace((u?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var a=n?Math.min(n,f.maxStarvationDelay):f.maxStarvationDelay,v=f.abrBandWidthFactor,m=f.abrBandWidthUpFactor;if(!u){var D=this.bitrateTestDelay;if(D){var R=n?Math.min(n,f.maxLoadingDelay):f.maxLoadingDelay;a=R-D,L.logger.trace("bitrate test took "+Math.round(1e3*D)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*a)+" ms"),v=m=1}}return r=this.findBestLevel(d,o,l,u+a,v,m),Math.max(r,0)},g.findBestLevel=function(i,e,s,l,f,o){for(var t,n=this.fragCurrent,E=this.partCurrent,h=this.lastLoadedFragLevel,d=this.hls.levels,u=d[h],r=!!(u!=null&&(t=u.details)!==null&&t!==void 0&&t.live),a=u==null?void 0:u.codecSet,v=E?E.duration:n?n.duration:0,m=s;m>=e;m--){var D=d[m];if(!(!D||a&&D.codecSet!==a)){var R=D.details,F=(E?R==null?void 0:R.partTarget:R==null?void 0:R.averagetargetduration)||v,_=void 0;m<=h?_=f*i:_=o*i;var B=d[m].maxBitrate,U=B*F/_;if(L.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+m+"/"+Math.round(_)+"/"+B+"/"+F+"/"+l+"/"+U),_>B&&(!U||r&&!this.bitrateTestDelay||U<l))return m}}return-1},S(y,[{key:"nextAutoLevel",get:function(){var i=this._nextAutoLevel,e=this.bwEstimator;if(i!==-1&&(!e||!e.canEstimate()))return i;var s=this.getNextABRAutoLevel();return i!==-1&&(s=Math.min(i,s)),s},set:function(i){this._nextAutoLevel=i}}]),y}();C.default=p},"./src/controller/audio-stream-controller.ts":function(j,C,x){x.r(C);var M=x("./src/polyfills/number.ts"),O=x("./src/controller/base-stream-controller.ts"),A=x("./src/events.ts"),b=x("./src/utils/buffer-helper.ts"),P=x("./src/controller/fragment-tracker.ts"),I=x("./src/types/level.ts"),L=x("./src/types/loader.ts"),T=x("./src/loader/fragment.ts"),S=x("./src/demux/chunk-cache.ts"),p=x("./src/demux/transmuxer-interface.ts"),y=x("./src/types/transmuxer.ts"),g=x("./src/controller/fragment-finders.ts"),c=x("./src/utils/discontinuities.ts"),i=x("./src/errors.ts"),e=x("./src/utils/logger.ts");function s(){return s=Object.assign?Object.assign.bind():function(n){for(var E=1;E<arguments.length;E++){var h=arguments[E];for(var d in h)Object.prototype.hasOwnProperty.call(h,d)&&(n[d]=h[d])}return n},s.apply(this,arguments)}function l(n,E){n.prototype=Object.create(E.prototype),n.prototype.constructor=n,f(n,E)}function f(n,E){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(d,u){return d.__proto__=u,d},f(n,E)}var o=100,t=function(n){l(E,n);function E(d,u){var r;return r=n.call(this,d,u,"[audio-stream-controller]")||this,r.videoBuffer=null,r.videoTrackCC=-1,r.waitingVideoCC=-1,r.audioSwitch=!1,r.trackId=-1,r.waitingData=null,r.mainDetails=null,r.bufferFlushed=!1,r.cachedTrackLoadedData=null,r._registerListeners(),r}var h=E.prototype;return h.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},h._registerListeners=function(){var u=this.hls;u.on(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.on(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.on(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.on(A.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),u.on(A.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),u.on(A.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),u.on(A.Events.ERROR,this.onError,this),u.on(A.Events.BUFFER_RESET,this.onBufferReset,this),u.on(A.Events.BUFFER_CREATED,this.onBufferCreated,this),u.on(A.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),u.on(A.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),u.on(A.Events.FRAG_BUFFERED,this.onFragBuffered,this)},h._unregisterListeners=function(){var u=this.hls;u.off(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.off(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.off(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.off(A.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),u.off(A.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),u.off(A.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),u.off(A.Events.ERROR,this.onError,this),u.off(A.Events.BUFFER_RESET,this.onBufferReset,this),u.off(A.Events.BUFFER_CREATED,this.onBufferCreated,this),u.off(A.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),u.off(A.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),u.off(A.Events.FRAG_BUFFERED,this.onFragBuffered,this)},h.onInitPtsFound=function(u,r){var a=r.frag,v=r.id,m=r.initPTS;if(v==="main"){var D=a.cc;this.initPTS[a.cc]=m,this.log("InitPTS for cc: "+D+" found from main: "+m),this.videoTrackCC=D,this.state===O.State.WAITING_INIT_PTS&&this.tick()}},h.startLoad=function(u){if(!this.levels){this.startPosition=u,this.state=O.State.STOPPED;return}var r=this.lastCurrentTime;this.stopLoad(),this.setInterval(o),this.fragLoadError=0,r>0&&u===-1?(this.log("Override startPosition with lastCurrentTime @"+r.toFixed(3)),this.state=O.State.IDLE):(this.loadedmetadata=!1,this.state=O.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=u,this.tick()},h.doTick=function(){switch(this.state){case O.State.IDLE:this.doTickIdle();break;case O.State.WAITING_TRACK:{var u,r=this.levels,a=this.trackId,v=r==null||(u=r[a])===null||u===void 0?void 0:u.details;if(v){if(this.waitForCdnTuneIn(v))break;this.state=O.State.WAITING_INIT_PTS}break}case O.State.FRAG_LOADING_WAITING_RETRY:{var m,D=performance.now(),R=this.retryDate;(!R||D>=R||(m=this.media)!==null&&m!==void 0&&m.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=O.State.IDLE);break}case O.State.WAITING_INIT_PTS:{var F=this.waitingData;if(F){var _=F.frag,B=F.part,U=F.cache,N=F.complete;if(this.initPTS[_.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=O.State.FRAG_LOADING;var k=U.flush(),w={frag:_,part:B,payload:k,networkDetails:null};this._handleFragmentLoadProgress(w),N&&n.prototype._handleFragmentLoadComplete.call(this,w)}else if(this.videoTrackCC!==this.waitingVideoCC)e.logger.log("Waiting fragment cc ("+_.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var K=this.getLoadPosition(),W=b.BufferHelper.bufferInfo(this.mediaBuffer,K,this.config.maxBufferHole),H=Object(g.fragmentWithinToleranceTest)(W.end,this.config.maxFragLookUpTolerance,_);H<0&&(e.logger.log("Waiting fragment cc ("+_.cc+") @ "+_.start+" cancelled because another fragment at "+W.end+" is needed"),this.clearWaitingFragment())}}else this.state=O.State.IDLE}}this.onTickEnd()},h.clearWaitingFragment=function(){var u=this.waitingData;u&&(this.fragmentTracker.removeFragment(u.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=O.State.IDLE)},h.onTickEnd=function(){var u=this.media;if(!(!u||!u.readyState)){var r=this.mediaBuffer?this.mediaBuffer:u,a=r.buffered;!this.loadedmetadata&&a.length&&(this.loadedmetadata=!0),this.lastCurrentTime=u.currentTime}},h.doTickIdle=function(){var u,r,a=this.hls,v=this.levels,m=this.media,D=this.trackId,R=a.config;if(!(!v||!v[D])&&!(!m&&(this.startFragRequested||!R.startFragPrefetch))){var F=v[D],_=F.details;if(!_||_.live&&this.levelLastLoaded!==D||this.waitForCdnTuneIn(_)){this.state=O.State.WAITING_TRACK;return}this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,T.ElementaryStreamTypes.AUDIO,L.PlaylistLevelType.AUDIO));var B=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,L.PlaylistLevelType.AUDIO);if(B!==null){var U=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,L.PlaylistLevelType.MAIN),N=B.len,k=this.getMaxBufferLength(U==null?void 0:U.len),w=this.audioSwitch;if(!(N>=k&&!w)){if(!w&&this._streamEnded(B,_)){a.trigger(A.Events.BUFFER_EOS,{type:"audio"}),this.state=O.State.ENDED;return}var K=_.fragments,W=K[0].start,H=B.end;if(w){var G=this.getLoadPosition();H=G,_.PTSKnown&&G<W&&(B.end>W||B.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),m.currentTime=W+.05)}if(!(U&&H>U.end+_.targetduration)&&!((!U||!U.len)&&B.len)){var Y=this.getNextFragment(H,_);if(!Y){this.bufferFlushed=!0;return}((u=Y.decryptdata)===null||u===void 0?void 0:u.keyFormat)==="identity"&&!((r=Y.decryptdata)!==null&&r!==void 0&&r.key)?this.loadKey(Y,_):this.loadFragment(Y,_,H)}}}}},h.getMaxBufferLength=function(u){var r=n.prototype.getMaxBufferLength.call(this);return u?Math.max(r,u):r},h.onMediaDetaching=function(){this.videoBuffer=null,n.prototype.onMediaDetaching.call(this)},h.onAudioTracksUpdated=function(u,r){var a=r.audioTracks;this.resetTransmuxer(),this.levels=a.map(function(v){return new I.Level(v)})},h.onAudioTrackSwitching=function(u,r){var a=!!r.url;this.trackId=r.id;var v=this.fragCurrent;v!=null&&v.loader&&v.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),a?this.setInterval(o):this.resetTransmuxer(),a?(this.audioSwitch=!0,this.state=O.State.IDLE):this.state=O.State.STOPPED,this.tick()},h.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},h.onLevelLoaded=function(u,r){this.mainDetails=r.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(A.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},h.onAudioTrackLoaded=function(u,r){var a;if(this.mainDetails==null){this.cachedTrackLoadedData=r;return}var v=this.levels,m=r.details,D=r.id;if(!v){this.warn("Audio tracks were reset while loading level "+D);return}this.log("Track "+D+" loaded ["+m.startSN+","+m.endSN+"],duration:"+m.totalduration);var R=v[D],F=0;if(m.live||(a=R.details)!==null&&a!==void 0&&a.live){var _=this.mainDetails;if(m.fragments[0]||(m.deltaUpdateFailed=!0),m.deltaUpdateFailed||!_)return;!R.details&&m.hasProgramDateTime&&_.hasProgramDateTime?(Object(c.alignMediaPlaylistByPDT)(m,_),F=m.fragments[0].start):F=this.alignPlaylists(m,R.details)}R.details=m,this.levelLastLoaded=D,!this.startFragRequested&&(this.mainDetails||!m.live)&&this.setStartPosition(R.details,F),this.state===O.State.WAITING_TRACK&&!this.waitForCdnTuneIn(m)&&(this.state=O.State.IDLE),this.tick()},h._handleFragmentLoadProgress=function(u){var r,a=u.frag,v=u.part,m=u.payload,D=this.config,R=this.trackId,F=this.levels;if(!F){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+a.sn+" of level "+a.level+" will not be buffered");return}var _=F[R];console.assert(_,"Audio track is defined on fragment load progress");var B=_.details;console.assert(B,"Audio track details are defined on fragment load progress");var U=D.defaultAudioCodec||_.audioCodec||"mp4a.40.2",N=this.transmuxer;N||(N=this.transmuxer=new p.default(this.hls,L.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var k=this.initPTS[a.cc],w=(r=a.initSegment)===null||r===void 0?void 0:r.data;if(k!==void 0){var K=!1,W=v?v.index:-1,H=W!==-1,G=new y.ChunkMetadata(a.level,a.sn,a.stats.chunkCount,m.byteLength,W,H);N.push(m,w,U,"",a,v,B.totalduration,K,G,k)}else{e.logger.log("Unknown video PTS for cc "+a.cc+", waiting for video PTS before demuxing audio frag "+a.sn+" of ["+B.startSN+" ,"+B.endSN+"],track "+R);var Y=this.waitingData=this.waitingData||{frag:a,part:v,cache:new S.default,complete:!1},Q=Y.cache;Q.push(new Uint8Array(m)),this.waitingVideoCC=this.videoTrackCC,this.state=O.State.WAITING_INIT_PTS}},h._handleFragmentLoadComplete=function(u){if(this.waitingData){this.waitingData.complete=!0;return}n.prototype._handleFragmentLoadComplete.call(this,u)},h.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},h.onBufferCreated=function(u,r){var a=r.tracks.audio;a&&(this.mediaBuffer=a.buffer),r.tracks.video&&(this.videoBuffer=r.tracks.video.buffer)},h.onFragBuffered=function(u,r){var a=r.frag,v=r.part;if(a.type===L.PlaylistLevelType.AUDIO){if(this.fragContextChanged(a)){this.warn("Fragment "+a.sn+(v?" p: "+v.index:"")+" of level "+a.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}a.sn!=="initSegment"&&(this.fragPrevious=a,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(A.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(a,v)}},h.onError=function(u,r){switch(r.details){case i.ErrorDetails.FRAG_LOAD_ERROR:case i.ErrorDetails.FRAG_LOAD_TIMEOUT:case i.ErrorDetails.KEY_LOAD_ERROR:case i.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(L.PlaylistLevelType.AUDIO,r);break;case i.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case i.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==O.State.ERROR&&this.state!==O.State.STOPPED&&(this.state=r.fatal?O.State.ERROR:O.State.IDLE,this.warn(r.details+" while loading frag, switching to "+this.state+" state"));break;case i.ErrorDetails.BUFFER_FULL_ERROR:if(r.parent==="audio"&&(this.state===O.State.PARSING||this.state===O.State.PARSED)){var a=!0,v=this.getFwdBufferInfo(this.mediaBuffer,L.PlaylistLevelType.AUDIO);v&&v.len>.5&&(a=!this.reduceMaxBufferLength(v.len)),a&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,n.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break}},h.onBufferFlushed=function(u,r){var a=r.type;a===T.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},h._handleTransmuxComplete=function(u){var r,a="audio",v=this.hls,m=u.remuxResult,D=u.chunkMeta,R=this.getCurrentContext(D);if(!R){this.warn("The loading context changed while buffering fragment "+D.sn+" of level "+D.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(D.level);return}var F=R.frag,_=R.part,B=R.level.details,U=m.audio,N=m.text,k=m.id3,w=m.initSegment;if(!(this.fragContextChanged(F)||!B)){if(this.state=O.State.PARSING,this.audioSwitch&&U&&this.completeAudioSwitch(),w!=null&&w.tracks&&(this._bufferInitSegment(w.tracks,F,D),v.trigger(A.Events.FRAG_PARSING_INIT_SEGMENT,{frag:F,id:a,tracks:w.tracks})),U){var K=U.startPTS,W=U.endPTS,H=U.startDTS,G=U.endDTS;_&&(_.elementaryStreams[T.ElementaryStreamTypes.AUDIO]={startPTS:K,endPTS:W,startDTS:H,endDTS:G}),F.setElementaryStreamInfo(T.ElementaryStreamTypes.AUDIO,K,W,H,G),this.bufferFragmentData(U,F,_,D)}if(k!=null&&(r=k.samples)!==null&&r!==void 0&&r.length){var Y=s({id:a,frag:F,details:B},k);v.trigger(A.Events.FRAG_PARSING_METADATA,Y)}if(N){var Q=s({id:a,frag:F,details:B},N);v.trigger(A.Events.FRAG_PARSING_USERDATA,Q)}}},h._bufferInitSegment=function(u,r,a){if(this.state===O.State.PARSING){u.video&&delete u.video;var v=u.audio;if(!!v){v.levelCodec=v.codec,v.id="audio",this.log("Init audio buffer, container:"+v.container+", codecs[parsed]=["+v.codec+"]"),this.hls.trigger(A.Events.BUFFER_CODECS,u);var m=v.initSegment;if(m!=null&&m.byteLength){var D={type:"audio",frag:r,part:null,chunkMeta:a,parent:r.type,data:m};this.hls.trigger(A.Events.BUFFER_APPENDING,D)}this.tick()}}},h.loadFragment=function(u,r,a){var v=this.fragmentTracker.getState(u);this.fragCurrent=u,(this.audioSwitch||v===P.FragmentState.NOT_LOADED||v===P.FragmentState.PARTIAL)&&(u.sn==="initSegment"?this._loadInitSegment(u):r.live&&!Object(M.isFiniteNumber)(this.initPTS[u.cc])?(this.log("Waiting for video PTS in continuity counter "+u.cc+" of live stream before loading audio fragment "+u.sn+" of level "+this.trackId),this.state=O.State.WAITING_INIT_PTS):(this.startFragRequested=!0,n.prototype.loadFragment.call(this,u,r,a)))},h.completeAudioSwitch=function(){var u=this.hls,r=this.media,a=this.trackId;r&&(this.log("Switching audio track : flushing all audio"),n.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,u.trigger(A.Events.AUDIO_TRACK_SWITCHED,{id:a})},E}(O.default);C.default=t},"./src/controller/audio-track-controller.ts":function(j,C,x){x.r(C);var M=x("./src/events.ts"),O=x("./src/errors.ts"),A=x("./src/controller/base-playlist-controller.ts"),b=x("./src/types/loader.ts");function P(p,y){for(var g=0;g<y.length;g++){var c=y[g];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(p,c.key,c)}}function I(p,y,g){return y&&P(p.prototype,y),g&&P(p,g),Object.defineProperty(p,"prototype",{writable:!1}),p}function L(p,y){p.prototype=Object.create(y.prototype),p.prototype.constructor=p,T(p,y)}function T(p,y){return T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,i){return c.__proto__=i,c},T(p,y)}var S=function(p){L(y,p);function y(c){var i;return i=p.call(this,c,"[audio-track-controller]")||this,i.tracks=[],i.groupId=null,i.tracksInGroup=[],i.trackId=-1,i.trackName="",i.selectDefaultTrack=!0,i.registerListeners(),i}var g=y.prototype;return g.registerListeners=function(){var i=this.hls;i.on(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.on(M.Events.LEVEL_LOADING,this.onLevelLoading,this),i.on(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),i.on(M.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),i.on(M.Events.ERROR,this.onError,this)},g.unregisterListeners=function(){var i=this.hls;i.off(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.off(M.Events.LEVEL_LOADING,this.onLevelLoading,this),i.off(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),i.off(M.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),i.off(M.Events.ERROR,this.onError,this)},g.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,p.prototype.destroy.call(this)},g.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},g.onManifestParsed=function(i,e){this.tracks=e.audioTracks||[]},g.onAudioTrackLoaded=function(i,e){var s=e.id,l=e.details,f=this.tracksInGroup[s];if(!f){this.warn("Invalid audio track id "+s);return}var o=f.details;f.details=e.details,this.log("audioTrack "+s+" loaded ["+l.startSN+"-"+l.endSN+"]"),s===this.trackId&&(this.retryCount=0,this.playlistLoaded(s,e,o))},g.onLevelLoading=function(i,e){this.switchLevel(e.level)},g.onLevelSwitching=function(i,e){this.switchLevel(e.level)},g.switchLevel=function(i){var e=this.hls.levels[i];if(!!(e!=null&&e.audioGroupIds)){var s=e.audioGroupIds[e.urlId];if(this.groupId!==s){this.groupId=s;var l=this.tracks.filter(function(o){return!s||o.groupId===s});this.selectDefaultTrack&&!l.some(function(o){return o.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=l;var f={audioTracks:l};this.log("Updating audio tracks, "+l.length+' track(s) found in "'+s+'" group-id'),this.hls.trigger(M.Events.AUDIO_TRACKS_UPDATED,f),this.selectInitialTrack()}}},g.onError=function(i,e){p.prototype.onError.call(this,i,e),!(e.fatal||!e.context)&&e.context.type===b.PlaylistContextType.AUDIO_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&this.retryLoadingOrFail(e)},g.setAudioTrack=function(i){var e=this.tracksInGroup;if(i<0||i>=e.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var s=e[this.trackId];this.log("Now switching to audio-track index "+i);var l=e[i],f=l.id,o=l.groupId,t=o===void 0?"":o,n=l.name,E=l.type,h=l.url;if(this.trackId=i,this.trackName=n,this.selectDefaultTrack=!1,this.hls.trigger(M.Events.AUDIO_TRACK_SWITCHING,{id:f,groupId:t,name:n,type:E,url:h}),!(l.details&&!l.details.live)){var d=this.switchParams(l.url,s==null?void 0:s.details);this.loadPlaylist(d)}},g.selectInitialTrack=function(){var i=this.tracksInGroup;console.assert(i.length,"Initial audio track should be selected when tracks are known");var e=this.trackName,s=this.findTrackId(e)||this.findTrackId();s!==-1?this.setAudioTrack(s):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},g.findTrackId=function(i){for(var e=this.tracksInGroup,s=0;s<e.length;s++){var l=e[s];if((!this.selectDefaultTrack||l.default)&&(!i||i===l.name))return l.id}return-1},g.loadPlaylist=function(i){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var s=e.id,l=e.groupId,f=e.url;if(i)try{f=i.addDirectives(f)}catch(o){this.warn("Could not construct new URL with HLS Delivery Directives: "+o)}this.log("loading audio-track playlist for id: "+s),this.clearTimer(),this.hls.trigger(M.Events.AUDIO_TRACK_LOADING,{url:f,id:s,groupId:l,deliveryDirectives:i||null})}},I(y,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(i){this.selectDefaultTrack=!1,this.setAudioTrack(i)}}]),y}(A.default);C.default=S},"./src/controller/base-playlist-controller.ts":function(j,C,x){x.r(C),x.d(C,"default",function(){return I});var M=x("./src/polyfills/number.ts"),O=x("./src/types/level.ts"),A=x("./src/controller/level-helper.ts"),b=x("./src/utils/logger.ts"),P=x("./src/errors.ts"),I=function(){function L(S,p){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=b.logger.log.bind(b.logger,p+":"),this.warn=b.logger.warn.bind(b.logger,p+":"),this.hls=S}var T=L.prototype;return T.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},T.onError=function(p,y){y.fatal&&y.type===P.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},T.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},T.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},T.stopLoad=function(){this.canLoad=!1,this.clearTimer()},T.switchParams=function(p,y){var g=y==null?void 0:y.renditionReports;if(g)for(var c=0;c<g.length;c++){var i=g[c],e=""+i.URI;if(e===p.slice(-e.length)){var s=parseInt(i["LAST-MSN"]),l=parseInt(i["LAST-PART"]);if(y&&this.hls.config.lowLatencyMode){var f=Math.min(y.age-y.partTarget,y.targetduration);l!==void 0&&f>y.partTarget&&(l+=1)}if(Object(M.isFiniteNumber)(s))return new O.HlsUrlParameters(s,Object(M.isFiniteNumber)(l)?l:void 0,O.HlsSkip.No)}}},T.loadPlaylist=function(p){},T.shouldLoadTrack=function(p){return this.canLoad&&p&&!!p.url&&(!p.details||p.details.live)},T.playlistLoaded=function(p,y,g){var c=this,i=y.details,e=y.stats,s=e.loading.end?Math.max(0,self.performance.now()-e.loading.end):0;if(i.advancedDateTime=Date.now()-s,i.live||g!=null&&g.live){if(i.reloaded(g),g&&this.log("live playlist "+p+" "+(i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:"MISSED")),g&&i.fragments.length>0&&Object(A.mergeDetails)(g,i),!this.canLoad||!i.live)return;var l,f=void 0,o=void 0;if(i.canBlockReload&&i.endSN&&i.advanced){var t=this.hls.config.lowLatencyMode,n=i.lastPartSn,E=i.endSN,h=i.lastPartIndex,d=h!==-1,u=n===E,r=t?0:h;d?(f=u?E+1:n,o=u?r:h+1):f=E+1;var a=i.age,v=a+i.ageHeader,m=Math.min(v-i.partTarget,i.targetduration*1.5);if(m>0){if(g&&m>g.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+g.tuneInGoal+" to: "+m+" with playlist age: "+i.age),m=0;else{var D=Math.floor(m/i.targetduration);if(f+=D,o!==void 0){var R=Math.round(m%i.targetduration/i.partTarget);o+=R}this.log("CDN Tune-in age: "+i.ageHeader+"s last advanced "+a.toFixed(2)+"s goal: "+m+" skip sn "+D+" to part "+o)}i.tuneInGoal=m}if(l=this.getDeliveryDirectives(i,y.deliveryDirectives,f,o),t||!u){this.loadPlaylist(l);return}}else l=this.getDeliveryDirectives(i,y.deliveryDirectives,f,o);var F=Object(A.computeReloadInterval)(i,e);f!==void 0&&i.canBlockReload&&(F-=i.partTarget||1),this.log("reload live playlist "+p+" in "+Math.round(F)+" ms"),this.timer=self.setTimeout(function(){return c.loadPlaylist(l)},F)}else this.clearTimer()},T.getDeliveryDirectives=function(p,y,g,c){var i=Object(O.getSkipValue)(p,g);return y!=null&&y.skip&&p.deltaUpdateFailed&&(g=y.msn,c=y.part,i=O.HlsSkip.No),new O.HlsUrlParameters(g,c,i)},T.retryLoadingOrFail=function(p){var y=this,g=this.hls.config,c=this.retryCount<g.levelLoadingMaxRetry;if(c){var i;if(this.retryCount++,p.details.indexOf("LoadTimeOut")>-1&&(i=p.context)!==null&&i!==void 0&&i.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+p.details+'"'),this.loadPlaylist();else{var e=Math.min(Math.pow(2,this.retryCount)*g.levelLoadingRetryDelay,g.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return y.loadPlaylist()},e),this.warn("retry playlist loading #"+this.retryCount+" in "+e+' ms after "'+p.details+'"')}}else this.warn('cannot recover from error "'+p.details+'"'),this.clearTimer(),p.fatal=!0;return c},L}()},"./src/controller/base-stream-controller.ts":function(j,C,x){x.r(C),x.d(C,"State",function(){return E}),x.d(C,"default",function(){return h});var M=x("./src/polyfills/number.ts"),O=x("./src/task-loop.ts"),A=x("./src/controller/fragment-tracker.ts"),b=x("./src/utils/buffer-helper.ts"),P=x("./src/utils/logger.ts"),I=x("./src/events.ts"),L=x("./src/errors.ts"),T=x("./src/types/transmuxer.ts"),S=x("./src/utils/mp4-tools.ts"),p=x("./src/utils/discontinuities.ts"),y=x("./src/controller/fragment-finders.ts"),g=x("./src/controller/level-helper.ts"),c=x("./src/loader/fragment-loader.ts"),i=x("./src/crypt/decrypter.ts"),e=x("./src/utils/time-ranges.ts"),s=x("./src/types/loader.ts");function l(d,u){for(var r=0;r<u.length;r++){var a=u[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}function f(d,u,r){return u&&l(d.prototype,u),r&&l(d,r),Object.defineProperty(d,"prototype",{writable:!1}),d}function o(d){if(d===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return d}function t(d,u){d.prototype=Object.create(u.prototype),d.prototype.constructor=d,n(d,u)}function n(d,u){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,v){return a.__proto__=v,a},n(d,u)}var E={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},h=function(d){t(u,d);function u(a,v,m){var D;return D=d.call(this)||this,D.hls=void 0,D.fragPrevious=null,D.fragCurrent=null,D.fragmentTracker=void 0,D.transmuxer=null,D._state=E.STOPPED,D.media=void 0,D.mediaBuffer=void 0,D.config=void 0,D.bitrateTest=!1,D.lastCurrentTime=0,D.nextLoadPosition=0,D.startPosition=0,D.loadedmetadata=!1,D.fragLoadError=0,D.retryDate=0,D.levels=null,D.fragmentLoader=void 0,D.levelLastLoaded=null,D.startFragRequested=!1,D.decrypter=void 0,D.initPTS=[],D.onvseeking=null,D.onvended=null,D.logPrefix="",D.log=void 0,D.warn=void 0,D.logPrefix=m,D.log=P.logger.log.bind(P.logger,m+":"),D.warn=P.logger.warn.bind(P.logger,m+":"),D.hls=a,D.fragmentLoader=new c.default(a.config),D.fragmentTracker=v,D.config=a.config,D.decrypter=new i.default(a,a.config),a.on(I.Events.KEY_LOADED,D.onKeyLoaded,o(D)),D}var r=u.prototype;return r.doTick=function(){this.onTickEnd()},r.onTickEnd=function(){},r.startLoad=function(v){},r.stopLoad=function(){this.fragmentLoader.abort();var v=this.fragCurrent;v&&this.fragmentTracker.removeFragment(v),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=E.STOPPED},r._streamEnded=function(v,m){var D=this.fragCurrent,R=this.fragmentTracker;if(!m.live&&D&&D.sn>=m.endSN&&!v.nextStart){var F=m.partList;if(F!=null&&F.length){var _=F[F.length-1],B=b.BufferHelper.isBuffered(this.media,_.start+_.duration/2);return B}var U=R.getState(D);return U===A.FragmentState.PARTIAL||U===A.FragmentState.OK}return!1},r.onMediaAttached=function(v,m){var D=this.media=this.mediaBuffer=m.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),D.addEventListener("seeking",this.onvseeking),D.addEventListener("ended",this.onvended);var R=this.config;this.levels&&R.autoStartLoad&&this.state===E.STOPPED&&this.startLoad(R.startPosition)},r.onMediaDetaching=function(){var v=this.media;v!=null&&v.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),v&&(v.removeEventListener("seeking",this.onvseeking),v.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},r.onMediaSeeking=function(){var v=this.config,m=this.fragCurrent,D=this.media,R=this.mediaBuffer,F=this.state,_=D?D.currentTime:0,B=b.BufferHelper.bufferInfo(R||D,_,v.maxBufferHole);if(this.log("media seeking to "+(Object(M.isFiniteNumber)(_)?_.toFixed(3):_)+", state: "+F),F===E.ENDED)this.resetLoadingState();else if(m&&!B.len){var U=v.maxFragLookUpTolerance,N=m.start-U,k=m.start+m.duration+U,w=_>k;(_<N||w)&&(w&&m.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),m.loader.abort()),this.resetLoadingState())}D&&(this.lastCurrentTime=_),!this.loadedmetadata&&!B.len&&(this.nextLoadPosition=this.startPosition=_),this.tickImmediate()},r.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},r.onKeyLoaded=function(v,m){if(!(this.state!==E.KEY_LOADING||m.frag!==this.fragCurrent||!this.levels)){this.state=E.IDLE;var D=this.levels[m.frag.level].details;D&&this.loadFragment(m.frag,D,m.frag.start)}},r.onHandlerDestroying=function(){this.stopLoad(),d.prototype.onHandlerDestroying.call(this)},r.onHandlerDestroyed=function(){this.state=E.STOPPED,this.hls.off(I.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,d.prototype.onHandlerDestroyed.call(this)},r.loadKey=function(v,m){this.log("Loading key for "+v.sn+" of ["+m.startSN+"-"+m.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+v.level),this.state=E.KEY_LOADING,this.fragCurrent=v,this.hls.trigger(I.Events.KEY_LOADING,{frag:v})},r.loadFragment=function(v,m,D){this._loadFragForPlayback(v,m,D)},r._loadFragForPlayback=function(v,m,D){var R=this,F=function(B){if(R.fragContextChanged(v)){R.warn("Fragment "+v.sn+(B.part?" p: "+B.part.index:"")+" of level "+v.level+" was dropped during download."),R.fragmentTracker.removeFragment(v);return}v.stats.chunkCount++,R._handleFragmentLoadProgress(B)};this._doFragLoad(v,m,D,F).then(function(_){if(!!_){R.fragLoadError=0;var B=R.state;if(R.fragContextChanged(v)){(B===E.FRAG_LOADING||!R.fragCurrent&&B===E.PARSING)&&(R.fragmentTracker.removeFragment(v),R.state=E.IDLE);return}"payload"in _&&(R.log("Loaded fragment "+v.sn+" of level "+v.level),R.hls.trigger(I.Events.FRAG_LOADED,_)),R._handleFragmentLoadComplete(_)}}).catch(function(_){R.state!==E.STOPPED&&(R.warn(_),R.resetFragmentLoading(v))})},r.flushMainBuffer=function(v,m,D){if(D===void 0&&(D=null),!!(v-m)){var R={startOffset:v,endOffset:m,type:D};this.fragLoadError=0,this.hls.trigger(I.Events.BUFFER_FLUSHING,R)}},r._loadInitSegment=function(v){var m=this;this._doFragLoad(v).then(function(D){if(!D||m.fragContextChanged(v)||!m.levels)throw new Error("init load aborted");return D}).then(function(D){var R=m.hls,F=D.payload,_=v.decryptdata;if(F&&F.byteLength>0&&_&&_.key&&_.iv&&_.method==="AES-128"){var B=self.performance.now();return m.decrypter.webCryptoDecrypt(new Uint8Array(F),_.key.buffer,_.iv.buffer).then(function(U){var N=self.performance.now();return R.trigger(I.Events.FRAG_DECRYPTED,{frag:v,payload:U,stats:{tstart:B,tdecrypt:N}}),D.payload=U,D})}return D}).then(function(D){var R=m.fragCurrent,F=m.hls,_=m.levels;if(!_)throw new Error("init load aborted, missing levels");var B=_[v.level].details;console.assert(B,"Level details are defined when init segment is loaded");var U=v.stats;m.state=E.IDLE,m.fragLoadError=0,v.data=new Uint8Array(D.payload),U.parsing.start=U.buffering.start=self.performance.now(),U.parsing.end=U.buffering.end=self.performance.now(),D.frag===R&&F.trigger(I.Events.FRAG_BUFFERED,{stats:U,frag:R,part:null,id:v.type}),m.tick()}).catch(function(D){m.warn(D),m.resetFragmentLoading(v)})},r.fragContextChanged=function(v){var m=this.fragCurrent;return!v||!m||v.level!==m.level||v.sn!==m.sn||v.urlId!==m.urlId},r.fragBufferedComplete=function(v,m){var D=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+v.type+" sn: "+v.sn+(m?" part: "+m.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+v.level+" "+e.default.toString(b.BufferHelper.getBuffered(D))),this.state=E.IDLE,this.tick()},r._handleFragmentLoadComplete=function(v){var m=this.transmuxer;if(!!m){var D=v.frag,R=v.part,F=v.partsLoaded,_=!F||F.length===0||F.some(function(U){return!U}),B=new T.ChunkMetadata(D.level,D.sn,D.stats.chunkCount+1,0,R?R.index:-1,!_);m.flush(B)}},r._handleFragmentLoadProgress=function(v){},r._doFragLoad=function(v,m,D,R){var F=this;if(D===void 0&&(D=null),!this.levels)throw new Error("frag load aborted, missing levels");if(D=Math.max(v.start,D||0),this.config.lowLatencyMode&&m){var _=m.partList;if(_&&R){D>v.end&&m.fragmentHint&&(v=m.fragmentHint);var B=this.getNextPart(_,v,D);if(B>-1){var U=_[B];return this.log("Loading part sn: "+v.sn+" p: "+U.index+" cc: "+v.cc+" of playlist ["+m.startSN+"-"+m.endSN+"] parts [0-"+B+"-"+(_.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+v.level+", target: "+parseFloat(D.toFixed(3))),this.nextLoadPosition=U.start+U.duration,this.state=E.FRAG_LOADING,this.hls.trigger(I.Events.FRAG_LOADING,{frag:v,part:_[B],targetBufferTime:D}),this.doFragPartsLoad(v,_,B,R).catch(function(N){return F.handleFragLoadError(N)})}else if(!v.url||this.loadedEndOfParts(_,D))return Promise.resolve(null)}}return this.log("Loading fragment "+v.sn+" cc: "+v.cc+" "+(m?"of ["+m.startSN+"-"+m.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+v.level+", target: "+parseFloat(D.toFixed(3))),Object(M.isFiniteNumber)(v.sn)&&!this.bitrateTest&&(this.nextLoadPosition=v.start+v.duration),this.state=E.FRAG_LOADING,this.hls.trigger(I.Events.FRAG_LOADING,{frag:v,targetBufferTime:D}),this.fragmentLoader.load(v,R).catch(function(N){return F.handleFragLoadError(N)})},r.doFragPartsLoad=function(v,m,D,R){var F=this;return new Promise(function(_,B){var U=[],N=function k(w){var K=m[w];F.fragmentLoader.loadPart(v,K,R).then(function(W){U[K.index]=W;var H=W.part;F.hls.trigger(I.Events.FRAG_LOADED,W);var G=m[w+1];if(G&&G.fragment===v)k(w+1);else return _({frag:v,part:H,partsLoaded:U})}).catch(B)};N(D)})},r.handleFragLoadError=function(v){var m=v.data;return m&&m.details===L.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(m.frag,m.part):this.hls.trigger(I.Events.ERROR,m),null},r._handleTransmuxerFlush=function(v){var m=this.getCurrentContext(v);if(!m||this.state!==E.PARSING){this.fragCurrent||(this.state=E.IDLE);return}var D=m.frag,R=m.part,F=m.level,_=self.performance.now();D.stats.parsing.end=_,R&&(R.stats.parsing.end=_),this.updateLevelTiming(D,R,F,v.partial)},r.getCurrentContext=function(v){var m=this.levels,D=v.level,R=v.sn,F=v.part;if(!m||!m[D])return this.warn("Levels object was unset while buffering fragment "+R+" of level "+D+". The current chunk will not be buffered."),null;var _=m[D],B=F>-1?Object(g.getPartWith)(_,R,F):null,U=B?B.fragment:Object(g.getFragmentWithSN)(_,R,this.fragCurrent);return U?{frag:U,part:B,level:_}:null},r.bufferFragmentData=function(v,m,D,R){if(!(!v||this.state!==E.PARSING)){var F=v.data1,_=v.data2,B=F;if(F&&_&&(B=Object(S.appendUint8Array)(F,_)),!(!B||!B.length)){var U={type:v.type,frag:m,part:D,chunkMeta:R,parent:m.type,data:B};this.hls.trigger(I.Events.BUFFER_APPENDING,U),v.dropped&&v.independent&&!D&&this.flushBufferGap(m)}}},r.flushBufferGap=function(v){var m=this.media;if(!!m){if(!b.BufferHelper.isBuffered(m,m.currentTime)){this.flushMainBuffer(0,v.start);return}var D=m.currentTime,R=b.BufferHelper.bufferInfo(m,D,0),F=v.duration,_=Math.min(this.config.maxFragLookUpTolerance*2,F*.25),B=Math.max(Math.min(v.start-_,R.end-_),D+_);v.start-B>_&&this.flushMainBuffer(B,v.start)}},r.getFwdBufferInfo=function(v,m){var D=this.config,R=this.getLoadPosition();if(!Object(M.isFiniteNumber)(R))return null;var F=b.BufferHelper.bufferInfo(v,R,D.maxBufferHole);if(F.len===0&&F.nextStart!==void 0){var _=this.fragmentTracker.getBufferedFrag(R,m);if(_&&F.nextStart<_.end)return b.BufferHelper.bufferInfo(v,R,Math.max(F.nextStart,D.maxBufferHole))}return F},r.getMaxBufferLength=function(v){var m=this.config,D;return v?D=Math.max(8*m.maxBufferSize/v,m.maxBufferLength):D=m.maxBufferLength,Math.min(D,m.maxMaxBufferLength)},r.reduceMaxBufferLength=function(v){var m=this.config,D=v||m.maxBufferLength;return m.maxMaxBufferLength>=D?(m.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+m.maxMaxBufferLength+"s"),!0):!1},r.getNextFragment=function(v,m){var D,R,F=m.fragments,_=F.length;if(!_)return null;var B=this.config,U=F[0].start,N;if(m.live){var k=B.initialLiveManifestSize;if(_<k)return this.warn("Not enough fragments to start playback (have: "+_+", need: "+k+")"),null;!m.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(N=this.getInitialLiveFragment(m,F),this.startPosition=N?this.hls.liveSyncPosition||N.start:v)}else v<=U&&(N=F[0]);if(!N){var w=B.lowLatencyMode?m.partEnd:m.fragmentEnd;N=this.getFragmentAtPosition(v,w,m)}return(D=N)!==null&&D!==void 0&&D.initSegment&&!((R=N)!==null&&R!==void 0&&R.initSegment.data)&&!this.bitrateTest&&(N=N.initSegment),N},r.getNextPart=function(v,m,D){for(var R=-1,F=!1,_=!0,B=0,U=v.length;B<U;B++){var N=v[B];if(_=_&&!N.independent,R>-1&&D<N.start)break;var k=N.loaded;!k&&(F||N.independent||_)&&N.fragment===m&&(R=B),F=k}return R},r.loadedEndOfParts=function(v,m){var D=v[v.length-1];return D&&m>D.start&&D.loaded},r.getInitialLiveFragment=function(v,m){var D=this.fragPrevious,R=null;if(D){if(v.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+D.programDateTime),R=Object(y.findFragmentByPDT)(m,D.endProgramDateTime,this.config.maxFragLookUpTolerance)),!R){var F=D.sn+1;if(F>=v.startSN&&F<=v.endSN){var _=m[F-v.startSN];D.cc===_.cc&&(R=_,this.log("Live playlist, switching playlist, load frag with next SN: "+R.sn))}R||(R=Object(y.findFragWithCC)(m,D.cc),R&&this.log("Live playlist, switching playlist, load frag with same CC: "+R.sn))}}else{var B=this.hls.liveSyncPosition;B!==null&&(R=this.getFragmentAtPosition(B,this.bitrateTest?v.fragmentEnd:v.edge,v))}return R},r.getFragmentAtPosition=function(v,m,D){var R=this.config,F=this.fragPrevious,_=D.fragments,B=D.endSN,U=D.fragmentHint,N=R.maxFragLookUpTolerance,k=!!(R.lowLatencyMode&&D.partList&&U);k&&U&&!this.bitrateTest&&(_=_.concat(U),B=U.sn);var w;if(v<m){var K=v>m-N?0:N;w=Object(y.findFragmentByPTS)(F,_,v,K)}else w=_[_.length-1];if(w){var W=w.sn-D.startSN,H=F&&w.level===F.level,G=_[W+1];F&&w.sn===F.sn&&!k&&H&&(w.sn<B&&this.fragmentTracker.getState(G)!==A.FragmentState.OK?(this.log("SN "+w.sn+" just loaded, load next one: "+G.sn),w=G):w=null)}return w},r.synchronizeToLiveEdge=function(v){var m=this.config,D=this.media;if(!!D){var R=this.hls.liveSyncPosition,F=D.currentTime,_=v.fragments[0].start,B=v.edge,U=F>=_-m.maxFragLookUpTolerance&&F<=B;if(R!==null&&D.duration>R&&(F<R||!U)){var N=m.liveMaxLatencyDuration!==void 0?m.liveMaxLatencyDuration:m.liveMaxLatencyDurationCount*v.targetduration;(!U&&D.readyState<4||F<B-N)&&(this.loadedmetadata||(this.nextLoadPosition=R),D.readyState&&(this.warn("Playback: "+F.toFixed(3)+" is located too far from the end of live sliding playlist: "+B+", reset currentTime to : "+R.toFixed(3)),D.currentTime=R))}}},r.alignPlaylists=function(v,m){var D=this.levels,R=this.levelLastLoaded,F=this.fragPrevious,_=R!==null?D[R]:null,B=v.fragments.length;if(!B)return this.warn("No fragments in live playlist"),0;var U=v.fragments[0].start,N=!m,k=v.alignedSliding&&Object(M.isFiniteNumber)(U);if(N||!k&&!U){Object(p.alignStream)(F,_,v);var w=v.fragments[0].start;return this.log("Live playlist sliding: "+w.toFixed(2)+" start-sn: "+(m?m.startSN:"na")+"->"+v.startSN+" prev-sn: "+(F?F.sn:"na")+" fragments: "+B),w}return U},r.waitForCdnTuneIn=function(v){var m=3;return v.live&&v.canBlockReload&&v.partTarget&&v.tuneInGoal>Math.max(v.partHoldBack,v.partTarget*m)},r.setStartPosition=function(v,m){var D=this.startPosition;if(D<m&&(D=-1),D===-1||this.lastCurrentTime===-1){var R=v.startTimeOffset;Object(M.isFiniteNumber)(R)?(D=m+R,R<0&&(D+=v.totalduration),D=Math.min(Math.max(m,D),m+v.totalduration),this.log("Start time offset "+R+" found in playlist, adjust startPosition to "+D),this.startPosition=D):v.live?D=this.hls.liveSyncPosition||m:this.startPosition=D=0,this.lastCurrentTime=D}this.nextLoadPosition=D},r.getLoadPosition=function(){var v=this.media,m=0;return this.loadedmetadata&&v?m=v.currentTime:this.nextLoadPosition&&(m=this.nextLoadPosition),m},r.handleFragLoadAborted=function(v,m){this.transmuxer&&v.sn!=="initSegment"&&v.stats.aborted&&(this.warn("Fragment "+v.sn+(m?" part"+m.index:"")+" of level "+v.level+" was aborted"),this.resetFragmentLoading(v))},r.resetFragmentLoading=function(v){(!this.fragCurrent||!this.fragContextChanged(v))&&(this.state=E.IDLE)},r.onFragmentOrKeyLoadError=function(v,m){if(!m.fatal){var D=m.frag;if(!(!D||D.type!==v)){var R=this.fragCurrent;console.assert(R&&D.sn===R.sn&&D.level===R.level&&D.urlId===R.urlId,"Frag load error must match current frag to retry");var F=this.config;if(this.fragLoadError+1<=F.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(D.level))return;var _=Math.min(Math.pow(2,this.fragLoadError)*F.fragLoadingRetryDelay,F.fragLoadingMaxRetryTimeout);this.warn("Fragment "+D.sn+" of "+v+" "+D.level+" failed to load, retrying in "+_+"ms"),this.retryDate=self.performance.now()+_,this.fragLoadError++,this.state=E.FRAG_LOADING_WAITING_RETRY}else m.levelRetry?(v===s.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=E.IDLE):(P.logger.error(m.details+" reaches max retry, redispatch as fatal ..."),m.fatal=!0,this.hls.stopLoad(),this.state=E.ERROR)}}},r.afterBufferFlushed=function(v,m,D){if(!!v){var R=b.BufferHelper.getBuffered(v);this.fragmentTracker.detectEvictedFragments(m,R,D),this.state===E.ENDED&&this.resetLoadingState()}},r.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=E.IDLE},r.resetLiveStartWhenNotLoaded=function(v){if(!this.loadedmetadata){this.startFragRequested=!1;var m=this.levels?this.levels[v].details:null;if(m!=null&&m.live)return this.startPosition=-1,this.setStartPosition(m,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},r.updateLevelTiming=function(v,m,D,R){var F=this,_=D.details;console.assert(!!_,"level.details must be defined");var B=Object.keys(v.elementaryStreams).reduce(function(U,N){var k=v.elementaryStreams[N];if(k){var w=k.endPTS-k.startPTS;if(w<=0)return F.warn("Could not parse fragment "+v.sn+" "+N+" duration reliably ("+w+")"),U||!1;var K=R?0:Object(g.updateFragPTSDTS)(_,v,k.startPTS,k.endPTS,k.startDTS,k.endDTS);return F.hls.trigger(I.Events.LEVEL_PTS_UPDATED,{details:_,level:D,drift:K,type:N,frag:v,start:k.startPTS,end:k.endPTS}),!0}return U},!1);B||(this.warn("Found no media in fragment "+v.sn+" of level "+D.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=E.PARSED,this.hls.trigger(I.Events.FRAG_PARSED,{frag:v,part:m})},r.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},f(u,[{key:"state",get:function(){return this._state},set:function(v){var m=this._state;m!==v&&(this._state=v,this.log(m+"->"+v))}}]),u}(O.default)},"./src/controller/buffer-controller.ts":function(j,C,x){x.r(C),x.d(C,"default",function(){return y});var M=x("./src/polyfills/number.ts"),O=x("./src/events.ts"),A=x("./src/utils/logger.ts"),b=x("./src/errors.ts"),P=x("./src/utils/buffer-helper.ts"),I=x("./src/utils/mediasource-helper.ts"),L=x("./src/loader/fragment.ts"),T=x("./src/controller/buffer-operation-queue.ts"),S=Object(I.getMediaSource)(),p=/([ha]vc.)(?:\.[^.,]+)+/,y=function(){function g(i){var e=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var s=e.hls,l=e.media,f=e.mediaSource;A.logger.log("[buffer-controller]: Media source opened"),l&&(e.updateMediaElementDuration(),s.trigger(O.Events.MEDIA_ATTACHED,{media:l})),f&&f.removeEventListener("sourceopen",e._onMediaSourceOpen),e.checkPendingTracks()},this._onMediaSourceClose=function(){A.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){A.logger.log("[buffer-controller]: Media source ended")},this.hls=i,this._initSourceBuffer(),this.registerListeners()}var c=g.prototype;return c.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},c.destroy=function(){this.unregisterListeners(),this.details=null},c.registerListeners=function(){var e=this.hls;e.on(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(O.Events.BUFFER_RESET,this.onBufferReset,this),e.on(O.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(O.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(O.Events.BUFFER_EOS,this.onBufferEos,this),e.on(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(O.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(O.Events.FRAG_PARSED,this.onFragParsed,this),e.on(O.Events.FRAG_CHANGED,this.onFragChanged,this)},c.unregisterListeners=function(){var e=this.hls;e.off(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(O.Events.BUFFER_RESET,this.onBufferReset,this),e.off(O.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(O.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(O.Events.BUFFER_EOS,this.onBufferEos,this),e.off(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(O.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(O.Events.FRAG_PARSED,this.onFragParsed,this),e.off(O.Events.FRAG_CHANGED,this.onFragChanged,this)},c._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new T.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},c.onManifestParsed=function(e,s){var l=2;(s.audio&&!s.video||!s.altAudio)&&(l=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=l,this.details=null,A.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},c.onMediaAttaching=function(e,s){var l=this.media=s.media;if(l&&S){var f=this.mediaSource=new S;f.addEventListener("sourceopen",this._onMediaSourceOpen),f.addEventListener("sourceended",this._onMediaSourceEnded),f.addEventListener("sourceclose",this._onMediaSourceClose),l.src=self.URL.createObjectURL(f),this._objectUrl=l.src}},c.onMediaDetaching=function(){var e=this.media,s=this.mediaSource,l=this._objectUrl;if(s){if(A.logger.log("[buffer-controller]: media source detaching"),s.readyState==="open")try{s.endOfStream()}catch(f){A.logger.warn("[buffer-controller]: onMediaDetaching: "+f.message+" while calling endOfStream")}this.onBufferReset(),s.removeEventListener("sourceopen",this._onMediaSourceOpen),s.removeEventListener("sourceended",this._onMediaSourceEnded),s.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(l&&self.URL.revokeObjectURL(l),e.src===l?(e.removeAttribute("src"),e.load()):A.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(O.Events.MEDIA_DETACHED,void 0)},c.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach(function(s){var l=e.sourceBuffer[s];try{l&&(e.removeBufferListeners(s),e.mediaSource&&e.mediaSource.removeSourceBuffer(l),e.sourceBuffer[s]=void 0)}catch(f){A.logger.warn("[buffer-controller]: Failed to reset the "+s+" buffer",f)}}),this._initSourceBuffer()},c.onBufferCodecs=function(e,s){var l=this,f=this.getSourceBufferTypes().length;Object.keys(s).forEach(function(o){if(f){var t=l.tracks[o];if(t&&typeof t.buffer.changeType=="function"){var n=s[o],E=n.id,h=n.codec,d=n.levelCodec,u=n.container,r=n.metadata,a=(t.levelCodec||t.codec).replace(p,"$1"),v=(d||h).replace(p,"$1");if(a!==v){var m=u+";codecs="+(d||h);l.appendChangeType(o,m),A.logger.log("[buffer-controller]: switching codec "+a+" to "+v),l.tracks[o]={buffer:t.buffer,codec:h,container:u,levelCodec:d,metadata:r,id:E}}}}else l.pendingTracks[o]=s[o]}),!f&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},c.appendChangeType=function(e,s){var l=this,f=this.operationQueue,o={execute:function(){var n=l.sourceBuffer[e];n&&(A.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+s),n.changeType(s)),f.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(n){A.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",n)}};f.append(o,e)},c.onBufferAppending=function(e,s){var l=this,f=this.hls,o=this.operationQueue,t=this.tracks,n=s.data,E=s.type,h=s.frag,d=s.part,u=s.chunkMeta,r=u.buffering[E],a=self.performance.now();r.start=a;var v=h.stats.buffering,m=d?d.stats.buffering:null;v.start===0&&(v.start=a),m&&m.start===0&&(m.start=a);var D=t.audio,R=E==="audio"&&u.id===1&&(D==null?void 0:D.container)==="audio/mpeg",F={execute:function(){if(r.executeStart=self.performance.now(),R){var B=l.sourceBuffer[E];if(B){var U=h.start-B.timestampOffset;Math.abs(U)>=.1&&(A.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+h.start+" (delta: "+U+") sn: "+h.sn+")"),B.timestampOffset=h.start)}}l.appendExecutor(n,E)},onStart:function(){},onComplete:function(){var B=self.performance.now();r.executeEnd=r.end=B,v.first===0&&(v.first=B),m&&m.first===0&&(m.first=B);var U=l.sourceBuffer,N={};for(var k in U)N[k]=P.BufferHelper.getBuffered(U[k]);l.appendError=0,l.hls.trigger(O.Events.BUFFER_APPENDED,{type:E,frag:h,part:d,chunkMeta:u,parent:h.type,timeRanges:N})},onError:function(B){A.logger.error("[buffer-controller]: Error encountered while trying to append to the "+E+" SourceBuffer",B);var U={type:b.ErrorTypes.MEDIA_ERROR,parent:h.type,details:b.ErrorDetails.BUFFER_APPEND_ERROR,err:B,fatal:!1};B.code===DOMException.QUOTA_EXCEEDED_ERR?U.details=b.ErrorDetails.BUFFER_FULL_ERROR:(l.appendError++,U.details=b.ErrorDetails.BUFFER_APPEND_ERROR,l.appendError>f.config.appendErrorMaxRetry&&(A.logger.error("[buffer-controller]: Failed "+f.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),U.fatal=!0)),f.trigger(O.Events.ERROR,U)}};o.append(F,E)},c.onBufferFlushing=function(e,s){var l=this,f=this.operationQueue,o=function(n){return{execute:l.removeExecutor.bind(l,n,s.startOffset,s.endOffset),onStart:function(){},onComplete:function(){l.hls.trigger(O.Events.BUFFER_FLUSHED,{type:n})},onError:function(h){A.logger.warn("[buffer-controller]: Failed to remove from "+n+" SourceBuffer",h)}}};s.type?f.append(o(s.type),s.type):this.getSourceBufferTypes().forEach(function(t){f.append(o(t),t)})},c.onFragParsed=function(e,s){var l=this,f=s.frag,o=s.part,t=[],n=o?o.elementaryStreams:f.elementaryStreams;n[L.ElementaryStreamTypes.AUDIOVIDEO]?t.push("audiovideo"):(n[L.ElementaryStreamTypes.AUDIO]&&t.push("audio"),n[L.ElementaryStreamTypes.VIDEO]&&t.push("video"));var E=function(){var d=self.performance.now();f.stats.buffering.end=d,o&&(o.stats.buffering.end=d);var u=o?o.stats:f.stats;l.hls.trigger(O.Events.FRAG_BUFFERED,{frag:f,part:o,stats:u,id:f.type})};t.length===0&&A.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+f.type+" level: "+f.level+" sn: "+f.sn),this.blockBuffers(E,t)},c.onFragChanged=function(e,s){this.flushBackBuffer()},c.onBufferEos=function(e,s){var l=this,f=this.getSourceBufferTypes().reduce(function(o,t){var n=l.sourceBuffer[t];return(!s.type||s.type===t)&&n&&!n.ended&&(n.ended=!0,A.logger.log("[buffer-controller]: "+t+" sourceBuffer now EOS")),o&&!!(!n||n.ended)},!0);f&&this.blockBuffers(function(){var o=l.mediaSource;!o||o.readyState!=="open"||o.endOfStream()})},c.onLevelUpdated=function(e,s){var l=s.details;!l.fragments.length||(this.details=l,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},c.flushBackBuffer=function(){var e=this.hls,s=this.details,l=this.media,f=this.sourceBuffer;if(!(!l||s===null)){var o=this.getSourceBufferTypes();if(!!o.length){var t=s.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if(!(!Object(M.isFiniteNumber)(t)||t<0)){var n=l.currentTime,E=s.levelTargetDuration,h=Math.max(t,E),d=Math.floor(n/E)*E-h;o.forEach(function(u){var r=f[u];if(r){var a=P.BufferHelper.getBuffered(r);a.length>0&&d>a.start(0)&&(e.trigger(O.Events.BACK_BUFFER_REACHED,{bufferEnd:d}),s.live&&e.trigger(O.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:d}),e.trigger(O.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:d,type:u}))}})}}}},c.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var e=this.details,s=this.hls,l=this.media,f=this.mediaSource,o=e.fragments[0].start+e.totalduration,t=l.duration,n=Object(M.isFiniteNumber)(f.duration)?f.duration:0;e.live&&s.config.liveDurationInfinity?(A.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),f.duration=1/0,this.updateSeekableRange(e)):(o>n&&o>t||!Object(M.isFiniteNumber)(t))&&(A.logger.log("[buffer-controller]: Updating Media Source duration to "+o.toFixed(3)),f.duration=o)}},c.updateSeekableRange=function(e){var s=this.mediaSource,l=e.fragments,f=l.length;if(f&&e.live&&s!==null&&s!==void 0&&s.setLiveSeekableRange){var o=Math.max(0,l[0].start),t=Math.max(o,o+e.totalduration);s.setLiveSeekableRange(o,t)}},c.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,s=this.operationQueue,l=this.pendingTracks,f=Object.keys(l).length;if(f&&!e||f===2){this.createSourceBuffers(l),this.pendingTracks={};var o=this.getSourceBufferTypes();if(o.length===0){this.hls.trigger(O.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}o.forEach(function(t){s.executeNext(t)})}},c.createSourceBuffers=function(e){var s=this.sourceBuffer,l=this.mediaSource;if(!l)throw Error("createSourceBuffers called when mediaSource was null");var f=0;for(var o in e)if(!s[o]){var t=e[o];if(!t)throw Error("source buffer exists for track "+o+", however track does not");var n=t.levelCodec||t.codec,E=t.container+";codecs="+n;A.logger.log("[buffer-controller]: creating sourceBuffer("+E+")");try{var h=s[o]=l.addSourceBuffer(E),d=o;this.addBufferListener(d,"updatestart",this._onSBUpdateStart),this.addBufferListener(d,"updateend",this._onSBUpdateEnd),this.addBufferListener(d,"error",this._onSBUpdateError),this.tracks[o]={buffer:h,codec:n,container:t.container,levelCodec:t.levelCodec,metadata:t.metadata,id:t.id},f++}catch(u){A.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+u.message),this.hls.trigger(O.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:u,mimeType:E})}}f&&this.hls.trigger(O.Events.BUFFER_CREATED,{tracks:this.tracks})},c._onSBUpdateStart=function(e){var s=this.operationQueue,l=s.current(e);l.onStart()},c._onSBUpdateEnd=function(e){var s=this.operationQueue,l=s.current(e);l.onComplete(),s.shiftAndExecuteNext(e)},c._onSBUpdateError=function(e,s){A.logger.error("[buffer-controller]: "+e+" SourceBuffer error",s),this.hls.trigger(O.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var l=this.operationQueue.current(e);l&&l.onError(s)},c.removeExecutor=function(e,s,l){var f=this.media,o=this.mediaSource,t=this.operationQueue,n=this.sourceBuffer,E=n[e];if(!f||!o||!E){A.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),t.shiftAndExecuteNext(e);return}var h=Object(M.isFiniteNumber)(f.duration)?f.duration:1/0,d=Object(M.isFiniteNumber)(o.duration)?o.duration:1/0,u=Math.max(0,s),r=Math.min(l,h,d);r>u?(A.logger.log("[buffer-controller]: Removing ["+u+","+r+"] from the "+e+" SourceBuffer"),console.assert(!E.updating,e+" sourceBuffer must not be updating"),E.remove(u,r)):t.shiftAndExecuteNext(e)},c.appendExecutor=function(e,s){var l=this.operationQueue,f=this.sourceBuffer,o=f[s];if(!o){A.logger.warn("[buffer-controller]: Attempting to append to the "+s+" SourceBuffer, but it does not exist"),l.shiftAndExecuteNext(s);return}o.ended=!1,console.assert(!o.updating,s+" sourceBuffer must not be updating"),o.appendBuffer(e)},c.blockBuffers=function(e,s){var l=this;if(s===void 0&&(s=this.getSourceBufferTypes()),!s.length){A.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);return}var f=this.operationQueue,o=s.map(function(t){return f.appendBlocker(t)});Promise.all(o).then(function(){e(),s.forEach(function(t){var n=l.sourceBuffer[t];(!n||!n.updating)&&f.shiftAndExecuteNext(t)})})},c.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},c.addBufferListener=function(e,s,l){var f=this.sourceBuffer[e];if(!!f){var o=l.bind(this,e);this.listeners[e].push({event:s,listener:o}),f.addEventListener(s,o)}},c.removeBufferListeners=function(e){var s=this.sourceBuffer[e];!s||this.listeners[e].forEach(function(l){s.removeEventListener(l.event,l.listener)})},g}()},"./src/controller/buffer-operation-queue.ts":function(j,C,x){x.r(C),x.d(C,"default",function(){return O});var M=x("./src/utils/logger.ts"),O=function(){function A(P){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=P}var b=A.prototype;return b.append=function(I,L){var T=this.queues[L];T.push(I),T.length===1&&this.buffers[L]&&this.executeNext(L)},b.insertAbort=function(I,L){var T=this.queues[L];T.unshift(I),this.executeNext(L)},b.appendBlocker=function(I){var L,T=new Promise(function(p){L=p}),S={execute:L,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(S,I),T},b.executeNext=function(I){var L=this.buffers,T=this.queues,S=L[I],p=T[I];if(p.length){var y=p[0];try{y.execute()}catch(g){M.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),y.onError(g),(!S||!S.updating)&&(p.shift(),this.executeNext(I))}}},b.shiftAndExecuteNext=function(I){this.queues[I].shift(),this.executeNext(I)},b.current=function(I){return this.queues[I][0]},A}()},"./src/controller/cap-level-controller.ts":function(j,C,x){x.r(C);var M=x("./src/events.ts");function O(P,I){for(var L=0;L<I.length;L++){var T=I[L];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(P,T.key,T)}}function A(P,I,L){return I&&O(P.prototype,I),L&&O(P,L),Object.defineProperty(P,"prototype",{writable:!1}),P}var b=function(){function P(L){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=L,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var I=P.prototype;return I.setStreamController=function(T){this.streamController=T},I.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},I.registerListeners=function(){var T=this.hls;T.on(M.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),T.on(M.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),T.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),T.on(M.Events.BUFFER_CODECS,this.onBufferCodecs,this),T.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},I.unregisterListener=function(){var T=this.hls;T.off(M.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),T.off(M.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),T.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),T.off(M.Events.BUFFER_CODECS,this.onBufferCodecs,this),T.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},I.onFpsDropLevelCapping=function(T,S){P.isLevelAllowed(S.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(S.droppedLevel)},I.onMediaAttaching=function(T,S){this.media=S.media instanceof HTMLVideoElement?S.media:null},I.onManifestParsed=function(T,S){var p=this.hls;this.restrictedLevels=[],this.firstLevel=S.firstLevel,p.config.capLevelToPlayerSize&&S.video&&this.startCapping()},I.onBufferCodecs=function(T,S){var p=this.hls;p.config.capLevelToPlayerSize&&S.video&&this.startCapping()},I.onMediaDetaching=function(){this.stopCapping()},I.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var T=this.hls.levels;if(T.length){var S=this.hls;S.autoLevelCapping=this.getMaxLevel(T.length-1),S.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=S.autoLevelCapping}}},I.getMaxLevel=function(T){var S=this,p=this.hls.levels;if(!p.length)return-1;var y=p.filter(function(g,c){return P.isLevelAllowed(c,S.restrictedLevels)&&c<=T});return this.clientRect=null,P.getMaxLevelByMediaSize(y,this.mediaWidth,this.mediaHeight)},I.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},I.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},I.getDimensions=function(){if(this.clientRect)return this.clientRect;var T=this.media,S={width:0,height:0};if(T){var p=T.getBoundingClientRect();S.width=p.width,S.height=p.height,!S.width&&!S.height&&(S.width=p.right-p.left||T.width||0,S.height=p.bottom-p.top||T.height||0)}return this.clientRect=S,S},P.isLevelAllowed=function(T,S){return S===void 0&&(S=[]),S.indexOf(T)===-1},P.getMaxLevelByMediaSize=function(T,S,p){if(!T||!T.length)return-1;for(var y=function(s,l){return l?s.width!==l.width||s.height!==l.height:!0},g=T.length-1,c=0;c<T.length;c+=1){var i=T[c];if((i.width>=S||i.height>=p)&&y(i,T[c+1])){g=c;break}}return g},A(P,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var T=1;if(!this.hls.config.ignoreDevicePixelRatio)try{T=self.devicePixelRatio}catch{}return T}}]),P}();C.default=b},"./src/controller/cmcd-controller.ts":function(j,C,x){x.r(C),x.d(C,"default",function(){return y});var M=x("./src/events.ts"),O=x("./src/types/cmcd.ts"),A=x("./src/utils/buffer-helper.ts"),b=x("./src/utils/logger.ts");function P(g,c){for(var i=0;i<c.length;i++){var e=c[i];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(g,e.key,e)}}function I(g,c,i){return c&&P(g.prototype,c),i&&P(g,i),Object.defineProperty(g,"prototype",{writable:!1}),g}function L(g,c){var i=typeof Symbol!="undefined"&&g[Symbol.iterator]||g["@@iterator"];if(i)return(i=i.call(g)).next.bind(i);if(Array.isArray(g)||(i=T(g))||c&&g&&typeof g.length=="number"){i&&(g=i);var e=0;return function(){return e>=g.length?{done:!0}:{done:!1,value:g[e++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function T(g,c){if(!!g){if(typeof g=="string")return S(g,c);var i=Object.prototype.toString.call(g).slice(8,-1);if(i==="Object"&&g.constructor&&(i=g.constructor.name),i==="Map"||i==="Set")return Array.from(g);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return S(g,c)}}function S(g,c){(c==null||c>g.length)&&(c=g.length);for(var i=0,e=new Array(c);i<c;i++)e[i]=g[i];return e}function p(){return p=Object.assign?Object.assign.bind():function(g){for(var c=1;c<arguments.length;c++){var i=arguments[c];for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(g[e]=i[e])}return g},p.apply(this,arguments)}var y=function(){function g(i){var e=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){e.initialized&&(e.starved=!0),e.buffering=!0},this.onPlaying=function(){e.initialized||(e.initialized=!0),e.buffering=!1},this.applyPlaylistData=function(f){try{e.apply(f,{ot:O.CMCDObjectType.MANIFEST,su:!e.initialized})}catch(o){b.logger.warn("Could not generate manifest CMCD data.",o)}},this.applyFragmentData=function(f){try{var o=f.frag,t=e.hls.levels[o.level],n=e.getObjectType(o),E={d:o.duration*1e3,ot:n};(n===O.CMCDObjectType.VIDEO||n===O.CMCDObjectType.AUDIO||n==O.CMCDObjectType.MUXED)&&(E.br=t.bitrate/1e3,E.tb=e.getTopBandwidth(n)/1e3,E.bl=e.getBufferLength(n)),e.apply(f,E)}catch(h){b.logger.warn("Could not generate segment CMCD data.",h)}},this.hls=i;var s=this.config=i.config,l=s.cmcd;l!=null&&(s.pLoader=this.createPlaylistLoader(),s.fLoader=this.createFragmentLoader(),this.sid=l.sessionId||g.uuid(),this.cid=l.contentId,this.useHeaders=l.useHeaders===!0,this.registerListeners())}var c=g.prototype;return c.registerListeners=function(){var e=this.hls;e.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.on(M.Events.BUFFER_CREATED,this.onBufferCreated,this)},c.unregisterListeners=function(){var e=this.hls;e.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.off(M.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},c.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},c.onMediaAttached=function(e,s){this.media=s.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},c.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},c.onBufferCreated=function(e,s){var l,f;this.audioBuffer=(l=s.tracks.audio)===null||l===void 0?void 0:l.buffer,this.videoBuffer=(f=s.tracks.video)===null||f===void 0?void 0:f.buffer},c.createData=function(){var e;return{v:O.CMCDVersion,sf:O.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)===null||e===void 0?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},c.apply=function(e,s){s===void 0&&(s={}),p(s,this.createData());var l=s.ot===O.CMCDObjectType.INIT||s.ot===O.CMCDObjectType.VIDEO||s.ot===O.CMCDObjectType.MUXED;if(this.starved&&l&&(s.bs=!0,s.su=!0,this.starved=!1),s.su==null&&(s.su=this.buffering),this.useHeaders){var f=g.toHeaders(s);if(!Object.keys(f).length)return;e.headers||(e.headers={}),p(e.headers,f)}else{var o=g.toQuery(s);if(!o)return;e.url=g.appendQueryToUri(e.url,o)}},c.getObjectType=function(e){var s=e.type;if(s==="subtitle")return O.CMCDObjectType.TIMED_TEXT;if(e.sn==="initSegment")return O.CMCDObjectType.INIT;if(s==="audio")return O.CMCDObjectType.AUDIO;if(s==="main")return this.hls.audioTracks.length?O.CMCDObjectType.VIDEO:O.CMCDObjectType.MUXED},c.getTopBandwidth=function(e){var s=0,l,f=this.hls;if(e===O.CMCDObjectType.AUDIO)l=f.audioTracks;else{var o=f.maxAutoLevel,t=o>-1?o+1:f.levels.length;l=f.levels.slice(0,t)}for(var n=L(l),E;!(E=n()).done;){var h=E.value;h.bitrate>s&&(s=h.bitrate)}return s>0?s:NaN},c.getBufferLength=function(e){var s=this.hls.media,l=e===O.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!l||!s)return NaN;var f=A.BufferHelper.bufferInfo(l,s.currentTime,this.config.maxBufferHole);return f.len*1e3},c.createPlaylistLoader=function(){var e=this.config.pLoader,s=this.applyPlaylistData,l=e||this.config.loader;return function(){function f(t){this.loader=void 0,this.loader=new l(t)}var o=f.prototype;return o.destroy=function(){this.loader.destroy()},o.abort=function(){this.loader.abort()},o.load=function(n,E,h){s(n),this.loader.load(n,E,h)},I(f,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),f}()},c.createFragmentLoader=function(){var e=this.config.fLoader,s=this.applyFragmentData,l=e||this.config.loader;return function(){function f(t){this.loader=void 0,this.loader=new l(t)}var o=f.prototype;return o.destroy=function(){this.loader.destroy()},o.abort=function(){this.loader.abort()},o.load=function(n,E,h){s(n),this.loader.load(n,E,h)},I(f,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),f}()},g.uuid=function(){var e=URL.createObjectURL(new Blob),s=e.toString();return URL.revokeObjectURL(e),s.slice(s.lastIndexOf("/")+1)},g.serialize=function(e){for(var s=[],l=function(R){return!Number.isNaN(R)&&R!=null&&R!==""&&R!==!1},f=function(R){return Math.round(R)},o=function(R){return f(R/100)*100},t=function(R){return encodeURIComponent(R)},n={br:f,d:f,bl:o,dl:o,mtp:o,nor:t,rtp:o,tb:f},E=Object.keys(e||{}).sort(),h=L(E),d;!(d=h()).done;){var u=d.value,r=e[u];if(!!l(r)&&!(u==="v"&&r===1)&&!(u=="pr"&&r===1)){var a=n[u];a&&(r=a(r));var v=typeof r,m=void 0;u==="ot"||u==="sf"||u==="st"?m=u+"="+r:v==="boolean"?m=u:v==="number"?m=u+"="+r:m=u+"="+JSON.stringify(r),s.push(m)}}return s.join(",")},g.toHeaders=function(e){for(var s=Object.keys(e),l={},f=["Object","Request","Session","Status"],o=[{},{},{},{}],t={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},n=0,E=s;n<E.length;n++){var h=E[n],d=t[h]!=null?t[h]:1;o[d][h]=e[h]}for(var u=0;u<o.length;u++){var r=g.serialize(o[u]);r&&(l["CMCD-"+f[u]]=r)}return l},g.toQuery=function(e){return"CMCD="+encodeURIComponent(g.serialize(e))},g.appendQueryToUri=function(e,s){if(!s)return e;var l=e.includes("?")?"&":"?";return""+e+l+s},g}()},"./src/controller/eme-controller.ts":function(j,C,x){x.r(C);var M=x("./src/events.ts"),O=x("./src/errors.ts"),A=x("./src/utils/logger.ts"),b=x("./src/utils/mediakeys-helper.ts");function P(y,g){for(var c=0;c<g.length;c++){var i=g[c];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(y,i.key,i)}}function I(y,g,c){return g&&P(y.prototype,g),c&&P(y,c),Object.defineProperty(y,"prototype",{writable:!1}),y}var L=3,T=function(g,c,i){var e={audioCapabilities:[],videoCapabilities:[]};return g.forEach(function(s){e.audioCapabilities.push({contentType:'audio/mp4; codecs="'+s+'"',robustness:i.audioRobustness||""})}),c.forEach(function(s){e.videoCapabilities.push({contentType:'video/mp4; codecs="'+s+'"',robustness:i.videoRobustness||""})}),[e]},S=function(g,c,i,e){switch(g){case b.KeySystems.WIDEVINE:return T(c,i,e);default:throw new Error("Unknown key-system: "+g)}},p=function(){function y(c){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=c,this._config=c.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var g=y.prototype;return g.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},g._registerListeners=function(){this.hls.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this)},g._unregisterListeners=function(){this.hls.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(M.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this)},g.getLicenseServerUrl=function(i){switch(i){case b.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+i+'"')},g._attemptKeySystemAccess=function(i,e,s){var l=this,f=S(i,e,s,this._drmSystemOptions);A.logger.log("Requesting encrypted media key-system access");var o=this.requestMediaKeySystemAccess(i,f);this.mediaKeysPromise=o.then(function(t){return l._onMediaKeySystemAccessObtained(i,t)}),o.catch(function(t){A.logger.error('Failed to obtain key-system "'+i+'" access:',t)})},g._onMediaKeySystemAccessObtained=function(i,e){var s=this;A.logger.log('Access for key-system "'+i+'" obtained');var l={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:e,mediaKeySystemDomain:i};this._mediaKeysList.push(l);var f=Promise.resolve().then(function(){return e.createMediaKeys()}).then(function(o){return l.mediaKeys=o,A.logger.log('Media-keys created for key-system "'+i+'"'),s._onMediaKeysCreated(),o});return f.catch(function(o){A.logger.error("Failed to create media-keys:",o)}),f},g._onMediaKeysCreated=function(){var i=this;this._mediaKeysList.forEach(function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession(),i._onNewMediaKeySession(e.mediaKeysSession))})},g._onNewMediaKeySession=function(i){var e=this;A.logger.log("New key-system session "+i.sessionId),i.addEventListener("message",function(s){e._onKeySessionMessage(i,s.message)},!1)},g._onKeySessionMessage=function(i,e){A.logger.log("Got EME message event, creating license request"),this._requestLicense(e,function(s){A.logger.log("Received license data (length: "+(s&&s.byteLength)+"), updating key-session"),i.update(s).catch(function(l){A.logger.warn("Updating key-session failed: "+l)})})},g.onMediaEncrypted=function(i){var e=this;if(A.logger.log('Media is encrypted using "'+i.initDataType+'" init data type'),!this.mediaKeysPromise){A.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var s=function(f){!e._media||(e._attemptSetMediaKeys(f),e._generateRequestWithPreferredKeySession(i.initDataType,i.initData))};this.mediaKeysPromise.then(s).catch(s)},g._attemptSetMediaKeys=function(i){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys){A.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}A.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},g._generateRequestWithPreferredKeySession=function(i,e){var s=this,l=this._mediaKeysList[0];if(!l){A.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(l.mediaKeysSessionInitialized){A.logger.warn("Key-Session already initialized but requested again");return}var f=l.mediaKeysSession;if(!f){A.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!e){A.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}A.logger.log('Generating key-session request for "'+i+'" init data type'),l.mediaKeysSessionInitialized=!0,f.generateRequest(i,e).then(function(){A.logger.debug("Key-session generation succeeded")}).catch(function(o){A.logger.error("Error generating key-session request:",o),s.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},g._createLicenseXhr=function(i,e,s){var l=new XMLHttpRequest;l.responseType="arraybuffer",l.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,l,i,e,s);var f=this._licenseXhrSetup;if(f)try{f.call(this.hls,l,i),f=void 0}catch(o){A.logger.error(o)}try{l.readyState||l.open("POST",i,!0),f&&f.call(this.hls,l,i)}catch(o){throw new Error("issue setting up KeySystem license XHR "+o)}return l},g._onLicenseRequestReadyStageChange=function(i,e,s,l){switch(i.readyState){case 4:if(i.status===200){this._requestLicenseFailureCount=0,A.logger.log("License request succeeded");var f=i.response,o=this._licenseResponseCallback;if(o)try{f=o.call(this.hls,i,e)}catch(n){A.logger.error(n)}l(f)}else{if(A.logger.error("License Request XHR failed ("+e+"). Status: "+i.status+" ("+i.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>L){this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var t=L-this._requestLicenseFailureCount+1;A.logger.warn("Retrying license request, "+t+" attempts left"),this._requestLicense(s,l)}break}},g._generateLicenseRequestChallenge=function(i,e){switch(i.mediaKeySystemDomain){case b.KeySystems.WIDEVINE:return e}throw new Error("unsupported key-system: "+i.mediaKeySystemDomain)},g._requestLicense=function(i,e){A.logger.log("Requesting content license for key-system");var s=this._mediaKeysList[0];if(!s){A.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var l=this.getLicenseServerUrl(s.mediaKeySystemDomain),f=this._createLicenseXhr(l,i,e);A.logger.log("Sending license request to URL: "+l);var o=this._generateLicenseRequestChallenge(s,i);f.send(o)}catch(t){A.logger.error("Failure requesting DRM license: "+t),this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},g.onMediaAttached=function(i,e){if(!!this._emeEnabled){var s=e.media;this._media=s,s.addEventListener("encrypted",this._onMediaEncrypted)}},g.onMediaDetached=function(){var i=this._media,e=this._mediaKeysList;!i||(i.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(e.map(function(s){if(s.mediaKeysSession)return s.mediaKeysSession.close().catch(function(){})})).then(function(){return i.setMediaKeys(null)}).catch(function(){}))},g.onManifestParsed=function(i,e){if(!!this._emeEnabled){var s=e.levels.map(function(f){return f.audioCodec}).filter(function(f){return!!f}),l=e.levels.map(function(f){return f.videoCodec}).filter(function(f){return!!f});this._attemptKeySystemAccess(b.KeySystems.WIDEVINE,s,l)}},I(y,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),y}();C.default=p},"./src/controller/fps-controller.ts":function(j,C,x){x.r(C);var M=x("./src/events.ts"),O=x("./src/utils/logger.ts"),A=function(){function b(I){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=I,this.registerListeners()}var P=b.prototype;return P.setStreamController=function(L){this.streamController=L},P.registerListeners=function(){this.hls.on(M.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},P.unregisterListeners=function(){this.hls.off(M.Events.MEDIA_ATTACHING,this.onMediaAttaching)},P.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},P.onMediaAttaching=function(L,T){var S=this.hls.config;if(S.capLevelOnFPSDrop){var p=T.media instanceof self.HTMLVideoElement?T.media:null;this.media=p,p&&typeof p.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),S.fpsDroppedMonitoringPeriod)}},P.checkFPS=function(L,T,S){var p=performance.now();if(T){if(this.lastTime){var y=p-this.lastTime,g=S-this.lastDroppedFrames,c=T-this.lastDecodedFrames,i=1e3*g/y,e=this.hls;if(e.trigger(M.Events.FPS_DROP,{currentDropped:g,currentDecoded:c,totalDroppedFrames:S}),i>0&&g>e.config.fpsDroppedMonitoringThreshold*c){var s=e.currentLevel;O.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+s),s>0&&(e.autoLevelCapping===-1||e.autoLevelCapping>=s)&&(s=s-1,e.trigger(M.Events.FPS_DROP_LEVEL_CAPPING,{level:s,droppedLevel:e.currentLevel}),e.autoLevelCapping=s,this.streamController.nextLevelSwitch())}}this.lastTime=p,this.lastDroppedFrames=S,this.lastDecodedFrames=T}},P.checkFPSInterval=function(){var L=this.media;if(L)if(this.isVideoPlaybackQualityAvailable){var T=L.getVideoPlaybackQuality();this.checkFPS(L,T.totalVideoFrames,T.droppedVideoFrames)}else this.checkFPS(L,L.webkitDecodedFrameCount,L.webkitDroppedFrameCount)},b}();C.default=A},"./src/controller/fragment-finders.ts":function(j,C,x){x.r(C),x.d(C,"findFragmentByPDT",function(){return A}),x.d(C,"findFragmentByPTS",function(){return b}),x.d(C,"fragmentWithinToleranceTest",function(){return P}),x.d(C,"pdtWithinToleranceTest",function(){return I}),x.d(C,"findFragWithCC",function(){return L});var M=x("./src/polyfills/number.ts"),O=x("./src/utils/binary-search.ts");function A(T,S,p){if(S===null||!Array.isArray(T)||!T.length||!Object(M.isFiniteNumber)(S))return null;var y=T[0].programDateTime;if(S<(y||0))return null;var g=T[T.length-1].endProgramDateTime;if(S>=(g||0))return null;p=p||0;for(var c=0;c<T.length;++c){var i=T[c];if(I(S,p,i))return i}return null}function b(T,S,p,y){p===void 0&&(p=0),y===void 0&&(y=0);var g=null;if(T?g=S[T.sn-S[0].sn+1]||null:p===0&&S[0].start===0&&(g=S[0]),g&&P(p,y,g)===0)return g;var c=O.default.search(S,P.bind(null,p,y));return c||g}function P(T,S,p){T===void 0&&(T=0),S===void 0&&(S=0);var y=Math.min(S,p.duration+(p.deltaPTS?p.deltaPTS:0));return p.start+p.duration-y<=T?1:p.start-y>T&&p.start?-1:0}function I(T,S,p){var y=Math.min(S,p.duration+(p.deltaPTS?p.deltaPTS:0))*1e3,g=p.endProgramDateTime||0;return g-y>T}function L(T,S){return O.default.search(T,function(p){return p.cc<S?1:p.cc>S?-1:0})}},"./src/controller/fragment-tracker.ts":function(j,C,x){x.r(C),x.d(C,"FragmentState",function(){return A}),x.d(C,"FragmentTracker",function(){return b});var M=x("./src/events.ts"),O=x("./src/types/loader.ts"),A;(function(L){L.NOT_LOADED="NOT_LOADED",L.APPENDING="APPENDING",L.PARTIAL="PARTIAL",L.OK="OK"})(A||(A={}));var b=function(){function L(S){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=S,this._registerListeners()}var T=L.prototype;return T._registerListeners=function(){var p=this.hls;p.on(M.Events.BUFFER_APPENDED,this.onBufferAppended,this),p.on(M.Events.FRAG_BUFFERED,this.onFragBuffered,this),p.on(M.Events.FRAG_LOADED,this.onFragLoaded,this)},T._unregisterListeners=function(){var p=this.hls;p.off(M.Events.BUFFER_APPENDED,this.onBufferAppended,this),p.off(M.Events.FRAG_BUFFERED,this.onFragBuffered,this),p.off(M.Events.FRAG_LOADED,this.onFragLoaded,this)},T.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},T.getAppendedFrag=function(p,y){if(y===O.PlaylistLevelType.MAIN){var g=this.activeFragment,c=this.activeParts;if(!g)return null;if(c)for(var i=c.length;i--;){var e=c[i],s=e?e.end:g.appendedPTS;if(e.start<=p&&s!==void 0&&p<=s)return i>9&&(this.activeParts=c.slice(i-9)),e}else if(g.start<=p&&g.appendedPTS!==void 0&&p<=g.appendedPTS)return g}return this.getBufferedFrag(p,y)},T.getBufferedFrag=function(p,y){for(var g=this.fragments,c=Object.keys(g),i=c.length;i--;){var e=g[c[i]];if((e==null?void 0:e.body.type)===y&&e.buffered){var s=e.body;if(s.start<=p&&p<=s.end)return s}}return null},T.detectEvictedFragments=function(p,y,g){var c=this;Object.keys(this.fragments).forEach(function(i){var e=c.fragments[i];if(!!e){if(!e.buffered){e.body.type===g&&c.removeFragment(e.body);return}var s=e.range[p];!s||s.time.some(function(l){var f=!c.isTimeBuffered(l.startPTS,l.endPTS,y);return f&&c.removeFragment(e.body),f})}})},T.detectPartialFragments=function(p){var y=this,g=this.timeRanges,c=p.frag,i=p.part;if(!(!g||c.sn==="initSegment")){var e=I(c),s=this.fragments[e];!s||(Object.keys(g).forEach(function(l){var f=c.elementaryStreams[l];if(!!f){var o=g[l],t=i!==null||f.partial===!0;s.range[l]=y.getBufferedTimes(c,i,t,o)}}),s.loaded=null,Object.keys(s.range).length?s.buffered=!0:this.removeFragment(s.body))}},T.fragBuffered=function(p){var y=I(p),g=this.fragments[y];g&&(g.loaded=null,g.buffered=!0)},T.getBufferedTimes=function(p,y,g,c){for(var i={time:[],partial:g},e=y?y.start:p.start,s=y?y.end:p.end,l=p.minEndPTS||s,f=p.maxStartPTS||e,o=0;o<c.length;o++){var t=c.start(o)-this.bufferPadding,n=c.end(o)+this.bufferPadding;if(f>=t&&l<=n){i.time.push({startPTS:Math.max(e,c.start(o)),endPTS:Math.min(s,c.end(o))});break}else if(e<n&&s>t)i.partial=!0,i.time.push({startPTS:Math.max(e,c.start(o)),endPTS:Math.min(s,c.end(o))});else if(s<=t)break}return i},T.getPartialFragment=function(p){var y=null,g,c,i,e=0,s=this.bufferPadding,l=this.fragments;return Object.keys(l).forEach(function(f){var o=l[f];!o||P(o)&&(c=o.body.start-s,i=o.body.end+s,p>=c&&p<=i&&(g=Math.min(p-c,i-p),e<=g&&(y=o.body,e=g)))}),y},T.getState=function(p){var y=I(p),g=this.fragments[y];return g?g.buffered?P(g)?A.PARTIAL:A.OK:A.APPENDING:A.NOT_LOADED},T.isTimeBuffered=function(p,y,g){for(var c,i,e=0;e<g.length;e++){if(c=g.start(e)-this.bufferPadding,i=g.end(e)+this.bufferPadding,p>=c&&y<=i)return!0;if(y<=c)return!1}return!1},T.onFragLoaded=function(p,y){var g=y.frag,c=y.part;if(!(g.sn==="initSegment"||g.bitrateTest||c)){var i=I(g);this.fragments[i]={body:g,loaded:y,buffered:!1,range:Object.create(null)}}},T.onBufferAppended=function(p,y){var g=this,c=y.frag,i=y.part,e=y.timeRanges;if(c.type===O.PlaylistLevelType.MAIN)if(this.activeFragment=c,i){var s=this.activeParts;s||(this.activeParts=s=[]),s.push(i)}else this.activeParts=null;this.timeRanges=e,Object.keys(e).forEach(function(l){var f=e[l];if(g.detectEvictedFragments(l,f),!i)for(var o=0;o<f.length;o++)c.appendedPTS=Math.max(f.end(o),c.appendedPTS||0)})},T.onFragBuffered=function(p,y){this.detectPartialFragments(y)},T.hasFragment=function(p){var y=I(p);return!!this.fragments[y]},T.removeFragmentsInRange=function(p,y,g){var c=this;Object.keys(this.fragments).forEach(function(i){var e=c.fragments[i];if(!!e&&e.buffered){var s=e.body;s.type===g&&s.start<y&&s.end>p&&c.removeFragment(s)}})},T.removeFragment=function(p){var y=I(p);p.stats.loaded=0,p.clearElementaryStreamInfo(),delete this.fragments[y]},T.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},L}();function P(L){var T,S;return L.buffered&&(((T=L.range.video)===null||T===void 0?void 0:T.partial)||((S=L.range.audio)===null||S===void 0?void 0:S.partial))}function I(L){return L.type+"_"+L.level+"_"+L.urlId+"_"+L.sn}},"./src/controller/gap-controller.ts":function(j,C,x){x.r(C),x.d(C,"STALL_MINIMUM_DURATION_MS",function(){return P}),x.d(C,"MAX_START_GAP_JUMP",function(){return I}),x.d(C,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return L}),x.d(C,"SKIP_BUFFER_RANGE_START",function(){return T}),x.d(C,"default",function(){return S});var M=x("./src/utils/buffer-helper.ts"),O=x("./src/errors.ts"),A=x("./src/events.ts"),b=x("./src/utils/logger.ts"),P=250,I=2,L=.1,T=.05,S=function(){function p(g,c,i,e){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=g,this.media=c,this.fragmentTracker=i,this.hls=e}var y=p.prototype;return y.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},y.poll=function(c,i){var e=this.config,s=this.media,l=this.stalled;if(s!==null){var f=s.currentTime,o=s.seeking,t=this.seeking&&!o,n=!this.seeking&&o;if(this.seeking=o,f!==c){if(this.moved=!0,l!==null){if(this.stallReported){var E=self.performance.now()-l;b.logger.warn("playback not stuck anymore @"+f+", after "+Math.round(E)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((n||t)&&(this.stalled=null),!(s.paused&&!o||s.ended||s.playbackRate===0||!M.BufferHelper.getBuffered(s).length)){var h=M.BufferHelper.bufferInfo(s,f,0),d=h.len>0,u=h.nextStart||0;if(!(!d&&!u)){if(o){var r=h.len>I,a=!u||i&&i.start<=f||u-f>I&&!this.fragmentTracker.getPartialFragment(f);if(r||a)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var v,m=Math.max(u,h.start||0)-f,D=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,R=D==null||(v=D.details)===null||v===void 0?void 0:v.live,F=R?D.details.targetduration*2:I;if(m>0&&m<=F){this._trySkipBufferHole(null);return}}var _=self.performance.now();if(l===null){this.stalled=_;return}var B=_-l;if(!(!o&&B>=P&&(this._reportStall(h),!this.media))){var U=M.BufferHelper.bufferInfo(s,f,e.maxBufferHole);this._tryFixBufferStall(U,B)}}}}},y._tryFixBufferStall=function(c,i){var e=this.config,s=this.fragmentTracker,l=this.media;if(l!==null){var f=l.currentTime,o=s.getPartialFragment(f);if(o){var t=this._trySkipBufferHole(o);if(t||!this.media)return}c.len>e.maxBufferHole&&i>e.highBufferWatchdogPeriod*1e3&&(b.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},y._reportStall=function(c){var i=this.hls,e=this.media,s=this.stallReported;!s&&e&&(this.stallReported=!0,b.logger.warn("Playback stalling at @"+e.currentTime+" due to low buffer ("+JSON.stringify(c)+")"),i.trigger(A.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:c.len}))},y._trySkipBufferHole=function(c){var i=this.config,e=this.hls,s=this.media;if(s===null)return 0;for(var l=s.currentTime,f=0,o=M.BufferHelper.getBuffered(s),t=0;t<o.length;t++){var n=o.start(t);if(l+i.maxBufferHole>=f&&l<n){var E=Math.max(n+T,s.currentTime+L);return b.logger.warn("skipping hole, adjusting currentTime from "+l+" to "+E),this.moved=!0,this.stalled=null,s.currentTime=E,c&&e.trigger(A.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+l+" to "+E,frag:c}),E}f=o.end(t)}return 0},y._tryNudgeBuffer=function(){var c=this.config,i=this.hls,e=this.media,s=this.nudgeRetry;if(e!==null){var l=e.currentTime;if(this.nudgeRetry++,s<c.nudgeMaxRetry){var f=l+(s+1)*c.nudgeOffset;b.logger.warn("Nudging 'currentTime' from "+l+" to "+f),e.currentTime=f,i.trigger(A.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else b.logger.error("Playhead still not moving while enough data buffered @"+l+" after "+c.nudgeMaxRetry+" nudges"),i.trigger(A.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},p}()},"./src/controller/id3-track-controller.ts":function(j,C,x){x.r(C);var M=x("./src/polyfills/number.ts"),O=x("./src/events.ts"),A=x("./src/utils/texttrack-utils.ts"),b=x("./src/demux/id3.ts"),P=x("./src/loader/date-range.ts"),I=x("./src/types/demuxer.ts"),L=.25;function T(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}function S(g,c){return g.getTime()/1e3-c}function p(g){return Uint8Array.from(g.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var y=function(){function g(i){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=i,this._registerListeners()}var c=g.prototype;return c.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},c._registerListeners=function(){var e=this.hls;e.on(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(O.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},c._unregisterListeners=function(){var e=this.hls;e.off(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(O.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},c.onMediaAttached=function(e,s){this.media=s.media},c.onMediaDetaching=function(){!this.id3Track||(Object(A.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},c.onManifestLoading=function(){this.dateRangeCuesAppended={}},c.createTrack=function(e){var s=this.getID3Track(e.textTracks);return s.mode="hidden",s},c.getID3Track=function(e){if(!!this.media){for(var s=0;s<e.length;s++){var l=e[s];if(l.kind==="metadata"&&l.label==="id3")return Object(A.sendAddTrackEvent)(l,this.media),l}return this.media.addTextTrack("metadata","id3")}},c.onFragParsingMetadata=function(e,s){if(!!this.media){var l=this.hls.config,f=l.enableEmsgMetadataCues,o=l.enableID3MetadataCues;if(!(!f&&!o)){var t=s.frag,n=s.samples,E=s.details;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var h=E.edge||t.end,d=T(),u=!1,r={},a=0;a<n.length;a++){var v=n[a].type;if(!(v===I.MetadataSchema.emsg&&!f||!o)){var m=b.getID3Frames(n[a].data);if(m){var D=n[a].pts,R=h,F=R-D;F<=0&&(R=D+L);for(var _=0;_<m.length;_++){var B=m[_];if(!b.isTimeStampFrame(B)){var U=new d(D,R,"");U.value=B,v&&(U.type=v),this.id3Track.addCue(U),r[B.key]=null,u=!0}}}}}u&&this.updateId3CueEnds(r)}}},c.updateId3CueEnds=function(e){var s,l=(s=this.id3Track)===null||s===void 0?void 0:s.cues;if(l)for(var f=l.length;f--;){var o,t=l[f],n=(o=t.value)===null||o===void 0?void 0:o.key;if(n&&n in e){var E=e[n];E&&t.endTime!==E&&(t.endTime=E),e[n]=t.startTime}}},c.onBufferFlushing=function(e,s){var l=s.startOffset,f=s.endOffset,o=s.type,t=this.id3Track,n=this.hls;if(!!n){var E=n.config,h=E.enableEmsgMetadataCues,d=E.enableID3MetadataCues;if(t&&(h||d)){var u;o==="audio"?u=function(a){return a.type===I.MetadataSchema.audioId3&&d}:o==="video"?u=function(a){return a.type===I.MetadataSchema.emsg&&h}:u=function(a){return a.type===I.MetadataSchema.audioId3&&d||a.type===I.MetadataSchema.emsg&&h},Object(A.removeCuesInRange)(t,l,f,u)}}},c.onLevelUpdated=function(e,s){var l=this,f=s.details;if(!(!this.media||!f.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var o=this.dateRangeCuesAppended,t=this.id3Track,n=f.dateRanges,E=Object.keys(n);if(t)for(var h=Object.keys(o).filter(function(F){return!E.includes(F)}),d=function(_){var B=h[_];Object.keys(o[B].cues).forEach(function(U){t.removeCue(o[B].cues[U])}),delete o[B]},u=h.length;u--;)d(u);var r=f.fragments[f.fragments.length-1];if(!(E.length===0||!Object(M.isFiniteNumber)(r==null?void 0:r.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var a=r.programDateTime/1e3-r.start,v=f.edge||r.end,m=T(),D=function(_){var B=E[_],U=n[B],N=o[B],k=(N==null?void 0:N.cues)||{},w=(N==null?void 0:N.durationKnown)||!1,K=S(U.startDate,a),W=v,H=U.endDate;if(H)W=S(H,a),w=!0;else if(U.endOnNext&&!w){var G=E.reduce(function(J,$){var Z=n[$];return Z.class===U.class&&Z.id!==$&&Z.startDate>U.startDate&&J.push(Z),J},[]).sort(function(J,$){return J.startDate.getTime()-$.startDate.getTime()})[0];G&&(W=S(G.startDate,a),w=!0)}for(var Y=Object.keys(U.attr),Q=0;Q<Y.length;Q++){var z=Y[Q];if(!(z===P.DateRangeAttribute.ID||z===P.DateRangeAttribute.CLASS||z===P.DateRangeAttribute.START_DATE||z===P.DateRangeAttribute.DURATION||z===P.DateRangeAttribute.END_DATE||z===P.DateRangeAttribute.END_ON_NEXT)){var V=k[z];if(V)w&&!N.durationKnown&&(V.endTime=W);else{var X=U.attr[z];V=new m(K,W,""),(z===P.DateRangeAttribute.SCTE35_OUT||z===P.DateRangeAttribute.SCTE35_IN)&&(X=p(X)),V.value={key:z,data:X},V.type=I.MetadataSchema.dateRange,l.id3Track.addCue(V),k[z]=V}}}o[B]={cues:k,dateRange:U,durationKnown:w}},R=0;R<E.length;R++)D(R)}}},g}();C.default=y},"./src/controller/latency-controller.ts":function(j,C,x){x.r(C),x.d(C,"default",function(){return I});var M=x("./src/errors.ts"),O=x("./src/events.ts"),A=x("./src/utils/logger.ts");function b(L,T){for(var S=0;S<T.length;S++){var p=T[S];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(L,p.key,p)}}function P(L,T,S){return T&&b(L.prototype,T),S&&b(L,S),Object.defineProperty(L,"prototype",{writable:!1}),L}var I=function(){function L(S){var p=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return p.timeupdate()},this.hls=S,this.config=S.config,this.registerListeners()}var T=L.prototype;return T.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},T.registerListeners=function(){this.hls.on(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(O.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(O.Events.ERROR,this.onError,this)},T.unregisterListeners=function(){this.hls.off(O.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(O.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(O.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(O.Events.ERROR,this.onError)},T.onMediaAttached=function(p,y){this.media=y.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},T.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},T.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},T.onLevelUpdated=function(p,y){var g=y.details;this.levelDetails=g,g.advanced&&this.timeupdate(),!g.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},T.onError=function(p,y){y.details===M.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,A.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},T.timeupdate=function(){var p=this.media,y=this.levelDetails;if(!(!p||!y)){this.currentTime=p.currentTime;var g=this.computeLatency();if(g!==null){this._latency=g;var c=this.config,i=c.lowLatencyMode,e=c.maxLiveSyncPlaybackRate;if(!(!i||e===1)){var s=this.targetLatency;if(s!==null){var l=g-s,f=Math.min(this.maxLatency,s+y.targetduration),o=l<f;if(y.live&&o&&l>.05&&this.forwardBufferLength>1){var t=Math.min(2,Math.max(1,e)),n=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20;p.playbackRate=Math.min(t,Math.max(1,n))}else p.playbackRate!==1&&p.playbackRate!==0&&(p.playbackRate=1)}}}}},T.estimateLiveEdge=function(){var p=this.levelDetails;return p===null?null:p.edge+p.age},T.computeLatency=function(){var p=this.estimateLiveEdge();return p===null?null:p-this.currentTime},P(L,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var p=this.config,y=this.levelDetails;return p.liveMaxLatencyDuration!==void 0?p.liveMaxLatencyDuration:y?p.liveMaxLatencyDurationCount*y.targetduration:0}},{key:"targetLatency",get:function(){var p=this.levelDetails;if(p===null)return null;var y=p.holdBack,g=p.partHoldBack,c=p.targetduration,i=this.config,e=i.liveSyncDuration,s=i.liveSyncDurationCount,l=i.lowLatencyMode,f=this.hls.userConfig,o=l&&g||y;(f.liveSyncDuration||f.liveSyncDurationCount||o===0)&&(o=e!==void 0?e:s*c);var t=c,n=1;return o+Math.min(this.stallCount*n,t)}},{key:"liveSyncPosition",get:function(){var p=this.estimateLiveEdge(),y=this.targetLatency,g=this.levelDetails;if(p===null||y===null||g===null)return null;var c=g.edge,i=p-y-this.edgeStalled,e=c-g.totalduration,s=c-(this.config.lowLatencyMode&&g.partTarget||g.targetduration);return Math.min(Math.max(e,i),s)}},{key:"drift",get:function(){var p=this.levelDetails;return p===null?1:p.drift}},{key:"edgeStalled",get:function(){var p=this.levelDetails;if(p===null)return 0;var y=(this.config.lowLatencyMode&&p.partTarget||p.targetduration)*3;return Math.max(p.age-y,0)}},{key:"forwardBufferLength",get:function(){var p=this.media,y=this.levelDetails;if(!p||!y)return 0;var g=p.buffered.length;return(g?p.buffered.end(g-1):y.edge)-this.currentTime}}]),L}()},"./src/controller/level-controller.ts":function(j,C,x){x.r(C),x.d(C,"default",function(){return i});var M=x("./src/types/level.ts"),O=x("./src/events.ts"),A=x("./src/errors.ts"),b=x("./src/utils/codecs.ts"),P=x("./src/controller/level-helper.ts"),I=x("./src/controller/base-playlist-controller.ts"),L=x("./src/types/loader.ts");function T(){return T=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var l=arguments[s];for(var f in l)Object.prototype.hasOwnProperty.call(l,f)&&(e[f]=l[f])}return e},T.apply(this,arguments)}function S(e,s){for(var l=0;l<s.length;l++){var f=s[l];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(e,f.key,f)}}function p(e,s,l){return s&&S(e.prototype,s),l&&S(e,l),Object.defineProperty(e,"prototype",{writable:!1}),e}function y(e,s){e.prototype=Object.create(s.prototype),e.prototype.constructor=e,g(e,s)}function g(e,s){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(f,o){return f.__proto__=o,f},g(e,s)}var c=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),i=function(e){y(s,e);function s(f){var o;return o=e.call(this,f,"[level-controller]")||this,o._levels=[],o._firstLevel=-1,o._startLevel=void 0,o.currentLevelIndex=-1,o.manualLevelIndex=-1,o.onParsedComplete=void 0,o._registerListeners(),o}var l=s.prototype;return l._registerListeners=function(){var o=this.hls;o.on(O.Events.MANIFEST_LOADED,this.onManifestLoaded,this),o.on(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),o.on(O.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),o.on(O.Events.FRAG_LOADED,this.onFragLoaded,this),o.on(O.Events.ERROR,this.onError,this)},l._unregisterListeners=function(){var o=this.hls;o.off(O.Events.MANIFEST_LOADED,this.onManifestLoaded,this),o.off(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),o.off(O.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),o.off(O.Events.FRAG_LOADED,this.onFragLoaded,this),o.off(O.Events.ERROR,this.onError,this)},l.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,e.prototype.destroy.call(this)},l.startLoad=function(){var o=this._levels;o.forEach(function(t){t.loadError=0}),e.prototype.startLoad.call(this)},l.onManifestLoaded=function(o,t){var n=[],E=[],h=[],d,u={},r,a=!1,v=!1,m=!1;if(t.levels.forEach(function(_){var B=_.attrs;a=a||!!(_.width&&_.height),v=v||!!_.videoCodec,m=m||!!_.audioCodec,c&&_.audioCodec&&_.audioCodec.indexOf("mp4a.40.34")!==-1&&(_.audioCodec=void 0);var U=_.bitrate+"-"+_.attrs.RESOLUTION+"-"+_.attrs.CODECS;r=u[U],r?r.url.push(_.url):(r=new M.Level(_),u[U]=r,n.push(r)),B&&(B.AUDIO&&Object(P.addGroupId)(r,"audio",B.AUDIO),B.SUBTITLES&&Object(P.addGroupId)(r,"text",B.SUBTITLES))}),(a||v)&&m&&(n=n.filter(function(_){var B=_.videoCodec,U=_.width,N=_.height;return!!B||!!(U&&N)})),n=n.filter(function(_){var B=_.audioCodec,U=_.videoCodec;return(!B||Object(b.isCodecSupportedInMp4)(B,"audio"))&&(!U||Object(b.isCodecSupportedInMp4)(U,"video"))}),t.audioTracks&&(E=t.audioTracks.filter(function(_){return!_.audioCodec||Object(b.isCodecSupportedInMp4)(_.audioCodec,"audio")}),Object(P.assignTrackIdsByGroup)(E)),t.subtitles&&(h=t.subtitles,Object(P.assignTrackIdsByGroup)(h)),n.length>0){d=n[0].bitrate,n.sort(function(_,B){return _.bitrate-B.bitrate}),this._levels=n;for(var D=0;D<n.length;D++)if(n[D].bitrate===d){this._firstLevel=D,this.log("manifest loaded, "+n.length+" level(s) found, first bitrate: "+d);break}var R=m&&!v,F={levels:n,audioTracks:E,subtitleTracks:h,firstLevel:this._firstLevel,stats:t.stats,audio:m,video:v,altAudio:!R&&E.some(function(_){return!!_.url})};this.hls.trigger(O.Events.MANIFEST_PARSED,F),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(O.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,reason:"no level with compatible codecs found in manifest"})},l.onError=function(o,t){if(e.prototype.onError.call(this,o,t),!t.fatal){var n=t.context,E=this._levels[this.currentLevelIndex];if(n&&(n.type===L.PlaylistContextType.AUDIO_TRACK&&E.audioGroupIds&&n.groupId===E.audioGroupIds[E.urlId]||n.type===L.PlaylistContextType.SUBTITLE_TRACK&&E.textGroupIds&&n.groupId===E.textGroupIds[E.urlId])){this.redundantFailover(this.currentLevelIndex);return}var h=!1,d=!0,u;switch(t.details){case A.ErrorDetails.FRAG_LOAD_ERROR:case A.ErrorDetails.FRAG_LOAD_TIMEOUT:case A.ErrorDetails.KEY_LOAD_ERROR:case A.ErrorDetails.KEY_LOAD_TIMEOUT:if(t.frag){var r=this._levels[t.frag.level];r?(r.fragmentError++,r.fragmentError>this.hls.config.fragLoadingMaxRetry&&(u=t.frag.level)):u=t.frag.level}break;case A.ErrorDetails.LEVEL_LOAD_ERROR:case A.ErrorDetails.LEVEL_LOAD_TIMEOUT:n&&(n.deliveryDirectives&&(d=!1),u=n.level),h=!0;break;case A.ErrorDetails.REMUX_ALLOC_ERROR:u=t.level,h=!0;break}u!==void 0&&this.recoverLevel(t,u,h,d)}},l.recoverLevel=function(o,t,n,E){var h=o.details,d=this._levels[t];if(d.loadError++,n){var u=this.retryLoadingOrFail(o);if(u)o.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(E){var r=d.url.length;if(r>1&&d.loadError<r)o.levelRetry=!0,this.redundantFailover(t);else if(this.manualLevelIndex===-1){var a=t===0?this._levels.length-1:t-1;this.currentLevelIndex!==a&&this._levels[a].loadError===0&&(this.warn(h+": switch to "+a),o.levelRetry=!0,this.hls.nextAutoLevel=a)}}},l.redundantFailover=function(o){var t=this._levels[o],n=t.url.length;if(n>1){var E=(t.urlId+1)%n;this.warn("Switching to redundant URL-id "+E),this._levels.forEach(function(h){h.urlId=E}),this.level=o}},l.onFragLoaded=function(o,t){var n=t.frag;if(n!==void 0&&n.type===L.PlaylistLevelType.MAIN){var E=this._levels[n.level];E!==void 0&&(E.fragmentError=0,E.loadError=0)}},l.onLevelLoaded=function(o,t){var n,E=t.level,h=t.details,d=this._levels[E];if(!d){var u;this.warn("Invalid level index "+E),(u=t.deliveryDirectives)!==null&&u!==void 0&&u.skip&&(h.deltaUpdateFailed=!0);return}E===this.currentLevelIndex?(d.fragmentError===0&&(d.loadError=0,this.retryCount=0),this.playlistLoaded(E,t,d.details)):(n=t.deliveryDirectives)!==null&&n!==void 0&&n.skip&&(h.deltaUpdateFailed=!0)},l.onAudioTrackSwitched=function(o,t){var n=this.hls.levels[this.currentLevelIndex];if(!!n&&n.audioGroupIds){for(var E=-1,h=this.hls.audioTracks[t.id].groupId,d=0;d<n.audioGroupIds.length;d++)if(n.audioGroupIds[d]===h){E=d;break}E!==n.urlId&&(n.urlId=E,this.startLoad())}},l.loadPlaylist=function(o){var t=this.currentLevelIndex,n=this._levels[t];if(this.canLoad&&n&&n.url.length>0){var E=n.urlId,h=n.url[E];if(o)try{h=o.addDirectives(h)}catch(d){this.warn("Could not construct new URL with HLS Delivery Directives: "+d)}this.log("Attempt loading level index "+t+(o?" at sn "+o.msn+" part "+o.part:"")+" with URL-id "+E+" "+h),this.clearTimer(),this.hls.trigger(O.Events.LEVEL_LOADING,{url:h,level:t,id:E,deliveryDirectives:o||null})}},l.removeLevel=function(o,t){var n=function(d,u){return u!==t},E=this._levels.filter(function(h,d){return d!==o?!0:h.url.length>1&&t!==void 0?(h.url=h.url.filter(n),h.audioGroupIds&&(h.audioGroupIds=h.audioGroupIds.filter(n)),h.textGroupIds&&(h.textGroupIds=h.textGroupIds.filter(n)),h.urlId=0,!0):!1}).map(function(h,d){var u=h.details;return u!=null&&u.fragments&&u.fragments.forEach(function(r){r.level=d}),h});this._levels=E,this.hls.trigger(O.Events.LEVELS_UPDATED,{levels:E})},p(s,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(o){var t,n=this._levels;if(n.length!==0&&!(this.currentLevelIndex===o&&(t=n[o])!==null&&t!==void 0&&t.details)){if(o<0||o>=n.length){var E=o<0;if(this.hls.trigger(O.Events.ERROR,{type:A.ErrorTypes.OTHER_ERROR,details:A.ErrorDetails.LEVEL_SWITCH_ERROR,level:o,fatal:E,reason:"invalid level idx"}),E)return;o=Math.min(o,n.length-1)}this.clearTimer();var h=this.currentLevelIndex,d=n[h],u=n[o];this.log("switching to level "+o+" from "+h),this.currentLevelIndex=o;var r=T({},u,{level:o,maxBitrate:u.maxBitrate,uri:u.uri,urlId:u.urlId});delete r._urlId,this.hls.trigger(O.Events.LEVEL_SWITCHING,r);var a=u.details;if(!a||a.live){var v=this.switchParams(u.uri,d==null?void 0:d.details);this.loadPlaylist(v)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(o){this.manualLevelIndex=o,this._startLevel===void 0&&(this._startLevel=o),o!==-1&&(this.level=o)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(o){this._firstLevel=o}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var o=this.hls.config.startLevel;return o!==void 0?o:this._firstLevel}else return this._startLevel},set:function(o){this._startLevel=o}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(o){this.level=o,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=o)}}]),s}(I.default)},"./src/controller/level-helper.ts":function(j,C,x){x.r(C),x.d(C,"addGroupId",function(){return P}),x.d(C,"assignTrackIdsByGroup",function(){return I}),x.d(C,"updatePTS",function(){return L}),x.d(C,"updateFragPTSDTS",function(){return S}),x.d(C,"mergeDetails",function(){return p}),x.d(C,"mapPartIntersection",function(){return g}),x.d(C,"mapFragmentIntersection",function(){return c}),x.d(C,"adjustSliding",function(){return i}),x.d(C,"addSliding",function(){return e}),x.d(C,"computeReloadInterval",function(){return s}),x.d(C,"getFragmentWithSN",function(){return l}),x.d(C,"getPartWith",function(){return f});var M=x("./src/polyfills/number.ts"),O=x("./src/utils/logger.ts"),A=x("./src/loader/date-range.ts");function b(){return b=Object.assign?Object.assign.bind():function(o){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var E in n)Object.prototype.hasOwnProperty.call(n,E)&&(o[E]=n[E])}return o},b.apply(this,arguments)}function P(o,t,n){switch(t){case"audio":o.audioGroupIds||(o.audioGroupIds=[]),o.audioGroupIds.push(n);break;case"text":o.textGroupIds||(o.textGroupIds=[]),o.textGroupIds.push(n);break}}function I(o){var t={};o.forEach(function(n){var E=n.groupId||"";n.id=t[E]=t[E]||0,t[E]++})}function L(o,t,n){var E=o[t],h=o[n];T(E,h)}function T(o,t){var n=t.startPTS;if(Object(M.isFiniteNumber)(n)){var E=0,h;t.sn>o.sn?(E=n-o.start,h=o):(E=o.start-n,h=t),h.duration!==E&&(h.duration=E)}else if(t.sn>o.sn){var d=o.cc===t.cc;d&&o.minEndPTS?t.start=o.start+(o.minEndPTS-o.start):t.start=o.start+o.duration}else t.start=Math.max(o.start-t.duration,0)}function S(o,t,n,E,h,d){var u=E-n;u<=0&&(O.logger.warn("Fragment should have a positive duration",t),E=n+t.duration,d=h+t.duration);var r=n,a=E,v=t.startPTS,m=t.endPTS;if(Object(M.isFiniteNumber)(v)){var D=Math.abs(v-n);Object(M.isFiniteNumber)(t.deltaPTS)?t.deltaPTS=Math.max(D,t.deltaPTS):t.deltaPTS=D,r=Math.max(n,v),n=Math.min(n,v),h=Math.min(h,t.startDTS),a=Math.min(E,m),E=Math.max(E,m),d=Math.max(d,t.endDTS)}t.duration=E-n;var R=n-t.start;t.appendedPTS=E,t.start=t.startPTS=n,t.maxStartPTS=r,t.startDTS=h,t.endPTS=E,t.minEndPTS=a,t.endDTS=d;var F=t.sn;if(!o||F<o.startSN||F>o.endSN)return 0;var _,B=F-o.startSN,U=o.fragments;for(U[B]=t,_=B;_>0;_--)T(U[_],U[_-1]);for(_=B;_<U.length-1;_++)T(U[_],U[_+1]);return o.fragmentHint&&T(U[U.length-1],o.fragmentHint),o.PTSKnown=o.alignedSliding=!0,R}function p(o,t){for(var n=null,E=o.fragments,h=E.length-1;h>=0;h--){var d=E[h].initSegment;if(d){n=d;break}}o.fragmentHint&&delete o.fragmentHint.endPTS;var u=0,r;if(c(o,t,function(_,B){_.relurl&&(u=_.cc-B.cc),Object(M.isFiniteNumber)(_.startPTS)&&Object(M.isFiniteNumber)(_.endPTS)&&(B.start=B.startPTS=_.startPTS,B.startDTS=_.startDTS,B.appendedPTS=_.appendedPTS,B.maxStartPTS=_.maxStartPTS,B.endPTS=_.endPTS,B.endDTS=_.endDTS,B.minEndPTS=_.minEndPTS,B.duration=_.endPTS-_.startPTS,B.duration&&(r=B),t.PTSKnown=t.alignedSliding=!0),B.elementaryStreams=_.elementaryStreams,B.loader=_.loader,B.stats=_.stats,B.urlId=_.urlId,_.initSegment&&(B.initSegment=_.initSegment,n=_.initSegment)}),n){var a=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments;a.forEach(function(_){var B;(!_.initSegment||_.initSegment.relurl===((B=n)===null||B===void 0?void 0:B.relurl))&&(_.initSegment=n)})}if(t.skippedSegments)if(t.deltaUpdateFailed=t.fragments.some(function(_){return!_}),t.deltaUpdateFailed){O.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var v=t.skippedSegments;v--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}else t.canSkipDateRanges&&(t.dateRanges=y(o.dateRanges,t.dateRanges,t.recentlyRemovedDateranges));var m=t.fragments;if(u){O.logger.warn("discontinuity sliding from playlist, take drift into account");for(var D=0;D<m.length;D++)m[D].cc+=u}t.skippedSegments&&(t.startCC=t.fragments[0].cc),g(o.partList,t.partList,function(_,B){B.elementaryStreams=_.elementaryStreams,B.stats=_.stats}),r?S(t,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS):i(o,t),m.length&&(t.totalduration=t.edge-m[0].start),t.driftStartTime=o.driftStartTime,t.driftStart=o.driftStart;var R=t.advancedDateTime;if(t.advanced&&R){var F=t.edge;t.driftStart||(t.driftStartTime=R,t.driftStart=F),t.driftEndTime=R,t.driftEnd=F}else t.driftEndTime=o.driftEndTime,t.driftEnd=o.driftEnd,t.advancedDateTime=o.advancedDateTime}function y(o,t,n){var E=b({},o);return n&&n.forEach(function(h){delete E[h]}),Object.keys(t).forEach(function(h){var d=new A.DateRange(t[h].attr,E[h]);d.isValid?E[h]=d:O.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(t[h].attr)+'"')}),E}function g(o,t,n){if(o&&t)for(var E=0,h=0,d=o.length;h<=d;h++){var u=o[h],r=t[h+E];u&&r&&u.index===r.index&&u.fragment.sn===r.fragment.sn?n(u,r):E--}}function c(o,t,n){for(var E=t.skippedSegments,h=Math.max(o.startSN,t.startSN)-t.startSN,d=(o.fragmentHint?1:0)+(E?t.endSN:Math.min(o.endSN,t.endSN))-t.startSN,u=t.startSN-o.startSN,r=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,a=o.fragmentHint?o.fragments.concat(o.fragmentHint):o.fragments,v=h;v<=d;v++){var m=a[u+v],D=r[v];E&&!D&&v<E&&(D=t.fragments[v]=m),m&&D&&n(m,D)}}function i(o,t){var n=t.startSN+t.skippedSegments-o.startSN,E=o.fragments;n<0||n>=E.length||e(t,E[n].start)}function e(o,t){if(t){for(var n=o.fragments,E=o.skippedSegments;E<n.length;E++)n[E].start+=t;o.fragmentHint&&(o.fragmentHint.start+=t)}}function s(o,t){var n=1e3*o.levelTargetDuration,E=n/2,h=o.age,d=h>0&&h<n*3,u=t.loading.end-t.loading.start,r,a=o.availabilityDelay;if(o.updated===!1)if(d){var v=333*o.misses;r=Math.max(Math.min(E,u*2),v),o.availabilityDelay=(o.availabilityDelay||0)+r}else r=E;else d?(a=Math.min(a||n/2,h),o.availabilityDelay=a,r=a+n-h):r=n-u;return Math.round(r)}function l(o,t,n){if(!o||!o.details)return null;var E=o.details,h=E.fragments[t-E.startSN];return h||(h=E.fragmentHint,h&&h.sn===t)?h:t<E.startSN&&n&&n.sn===t?n:null}function f(o,t,n){if(!o||!o.details)return null;var E=o.details.partList;if(E)for(var h=E.length;h--;){var d=E[h];if(d.index===n&&d.fragment.sn===t)return d}return null}},"./src/controller/stream-controller.ts":function(j,C,x){x.r(C),x.d(C,"default",function(){return o});var M=x("./src/polyfills/number.ts"),O=x("./src/controller/base-stream-controller.ts"),A=x("./src/is-supported.ts"),b=x("./src/events.ts"),P=x("./src/utils/buffer-helper.ts"),I=x("./src/controller/fragment-tracker.ts"),L=x("./src/types/loader.ts"),T=x("./src/loader/fragment.ts"),S=x("./src/demux/transmuxer-interface.ts"),p=x("./src/types/transmuxer.ts"),y=x("./src/controller/gap-controller.ts"),g=x("./src/errors.ts"),c=x("./src/utils/logger.ts");function i(t,n){for(var E=0;E<n.length;E++){var h=n[E];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(t,h.key,h)}}function e(t,n,E){return n&&i(t.prototype,n),E&&i(t,E),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,l(t,n)}function l(t,n){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,d){return h.__proto__=d,h},l(t,n)}var f=100,o=function(t){s(n,t);function n(h,d){var u;return u=t.call(this,h,d,"[stream-controller]")||this,u.audioCodecSwap=!1,u.gapController=null,u.level=-1,u._forceStartLoad=!1,u.altAudio=!1,u.audioOnly=!1,u.fragPlaying=null,u.onvplaying=null,u.onvseeked=null,u.fragLastKbps=0,u.stalled=!1,u.couldBacktrack=!1,u.backtrackFragment=null,u.audioCodecSwitch=!1,u.videoBuffer=null,u._registerListeners(),u}var E=n.prototype;return E._registerListeners=function(){var d=this.hls;d.on(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),d.on(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),d.on(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),d.on(b.Events.MANIFEST_PARSED,this.onManifestParsed,this),d.on(b.Events.LEVEL_LOADING,this.onLevelLoading,this),d.on(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),d.on(b.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),d.on(b.Events.ERROR,this.onError,this),d.on(b.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),d.on(b.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),d.on(b.Events.BUFFER_CREATED,this.onBufferCreated,this),d.on(b.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),d.on(b.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),d.on(b.Events.FRAG_BUFFERED,this.onFragBuffered,this)},E._unregisterListeners=function(){var d=this.hls;d.off(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),d.off(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),d.off(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),d.off(b.Events.MANIFEST_PARSED,this.onManifestParsed,this),d.off(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),d.off(b.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),d.off(b.Events.ERROR,this.onError,this),d.off(b.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),d.off(b.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),d.off(b.Events.BUFFER_CREATED,this.onBufferCreated,this),d.off(b.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),d.off(b.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),d.off(b.Events.FRAG_BUFFERED,this.onFragBuffered,this)},E.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},E.startLoad=function(d){if(this.levels){var u=this.lastCurrentTime,r=this.hls;if(this.stopLoad(),this.setInterval(f),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var a=r.startLevel;a===-1&&(r.config.testBandwidth?(a=0,this.bitrateTest=!0):a=r.nextAutoLevel),this.level=r.nextLoadLevel=a,this.loadedmetadata=!1}u>0&&d===-1&&(this.log("Override startPosition with lastCurrentTime @"+u.toFixed(3)),d=u),this.state=O.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=d,this.tick()}else this._forceStartLoad=!0,this.state=O.State.STOPPED},E.stopLoad=function(){this._forceStartLoad=!1,t.prototype.stopLoad.call(this)},E.doTick=function(){switch(this.state){case O.State.IDLE:this.doTickIdle();break;case O.State.WAITING_LEVEL:{var d,u=this.levels,r=this.level,a=u==null||(d=u[r])===null||d===void 0?void 0:d.details;if(a&&(!a.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(a))break;this.state=O.State.IDLE;break}break}case O.State.FRAG_LOADING_WAITING_RETRY:{var v,m=self.performance.now(),D=this.retryDate;(!D||m>=D||(v=this.media)!==null&&v!==void 0&&v.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=O.State.IDLE)}break}this.onTickEnd()},E.onTickEnd=function(){t.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},E.doTickIdle=function(){var d,u,r=this.hls,a=this.levelLastLoaded,v=this.levels,m=this.media,D=r.config,R=r.nextLoadLevel;if(!(a===null||!m&&(this.startFragRequested||!D.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!v||!v[R])){var F=v[R];this.level=r.nextLoadLevel=R;var _=F.details;if(!_||this.state===O.State.WAITING_LEVEL||_.live&&this.levelLastLoaded!==R){this.state=O.State.WAITING_LEVEL;return}var B=this.getMainFwdBufferInfo();if(B!==null){var U=B.len,N=this.getMaxBufferLength(F.maxBitrate);if(!(U>=N)){if(this._streamEnded(B,_)){var k={};this.altAudio&&(k.type="video"),this.hls.trigger(b.Events.BUFFER_EOS,k),this.state=O.State.ENDED;return}this.backtrackFragment&&this.backtrackFragment.start>B.end&&(this.backtrackFragment=null);var w=this.backtrackFragment?this.backtrackFragment.start:B.end,K=this.getNextFragment(w,_);if(this.couldBacktrack&&!this.fragPrevious&&K&&K.sn!=="initSegment"&&this.fragmentTracker.getState(K)!==I.FragmentState.OK){var W,H=((W=this.backtrackFragment)!=null?W:K).sn,G=H-_.startSN,Y=_.fragments[G-1];Y&&K.cc===Y.cc&&(K=Y,this.fragmentTracker.removeFragment(Y))}else this.backtrackFragment&&B.len&&(this.backtrackFragment=null);if(K&&this.fragmentTracker.getState(K)===I.FragmentState.OK&&this.nextLoadPosition>w){var Q=this.audioOnly&&!this.altAudio?T.ElementaryStreamTypes.AUDIO:T.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(m,Q,L.PlaylistLevelType.MAIN),K=this.getNextFragment(this.nextLoadPosition,_)}!K||(K.initSegment&&!K.initSegment.data&&!this.bitrateTest&&(K=K.initSegment),((d=K.decryptdata)===null||d===void 0?void 0:d.keyFormat)==="identity"&&!((u=K.decryptdata)!==null&&u!==void 0&&u.key)?this.loadKey(K,_):this.loadFragment(K,_,w))}}}},E.loadFragment=function(d,u,r){var a,v=this.fragmentTracker.getState(d);this.fragCurrent=d,v===I.FragmentState.NOT_LOADED||v===I.FragmentState.PARTIAL?d.sn==="initSegment"?this._loadInitSegment(d):this.bitrateTest?(d.bitrateTest=!0,this.log("Fragment "+d.sn+" of level "+d.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(d)):(this.startFragRequested=!0,t.prototype.loadFragment.call(this,d,u,r)):v===I.FragmentState.APPENDING?this.reduceMaxBufferLength(d.duration)&&this.fragmentTracker.removeFragment(d):((a=this.media)===null||a===void 0?void 0:a.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},E.getAppendedFrag=function(d){var u=this.fragmentTracker.getAppendedFrag(d,L.PlaylistLevelType.MAIN);return u&&"fragment"in u?u.fragment:u},E.getBufferedFrag=function(d){return this.fragmentTracker.getBufferedFrag(d,L.PlaylistLevelType.MAIN)},E.followingBufferedFrag=function(d){return d?this.getBufferedFrag(d.end+.5):null},E.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},E.nextLevelSwitch=function(){var d=this.levels,u=this.media;if(u!=null&&u.readyState){var r,a=this.getAppendedFrag(u.currentTime);if(a&&a.start>1&&this.flushMainBuffer(0,a.start-1),!u.paused&&d){var v=this.hls.nextLoadLevel,m=d[v],D=this.fragLastKbps;D&&this.fragCurrent?r=this.fragCurrent.duration*m.maxBitrate/(1e3*D)+1:r=0}else r=0;var R=this.getBufferedFrag(u.currentTime+r);if(R){var F=this.followingBufferedFrag(R);if(F){this.abortCurrentFrag();var _=F.maxStartPTS?F.maxStartPTS:F.start,B=F.duration,U=Math.max(R.end,_+Math.min(Math.max(B-this.config.maxFragLookUpTolerance,B*.5),B*.75));this.flushMainBuffer(U,Number.POSITIVE_INFINITY)}}}},E.abortCurrentFrag=function(){var d=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,d!=null&&d.loader&&d.loader.abort(),this.state){case O.State.KEY_LOADING:case O.State.FRAG_LOADING:case O.State.FRAG_LOADING_WAITING_RETRY:case O.State.PARSING:case O.State.PARSED:this.state=O.State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},E.flushMainBuffer=function(d,u){t.prototype.flushMainBuffer.call(this,d,u,this.altAudio?"video":null)},E.onMediaAttached=function(d,u){t.prototype.onMediaAttached.call(this,d,u);var r=u.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),r.addEventListener("playing",this.onvplaying),r.addEventListener("seeked",this.onvseeked),this.gapController=new y.default(this.config,r,this.fragmentTracker,this.hls)},E.onMediaDetaching=function(){var d=this.media;d&&(d.removeEventListener("playing",this.onvplaying),d.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),t.prototype.onMediaDetaching.call(this)},E.onMediaPlaying=function(){this.tick()},E.onMediaSeeked=function(){var d=this.media,u=d?d.currentTime:null;Object(M.isFiniteNumber)(u)&&this.log("Media seeked to "+u.toFixed(3)),this.tick()},E.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(b.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},E.onManifestParsed=function(d,u){var r=!1,a=!1,v;u.levels.forEach(function(m){v=m.audioCodec,v&&(v.indexOf("mp4a.40.2")!==-1&&(r=!0),v.indexOf("mp4a.40.5")!==-1&&(a=!0))}),this.audioCodecSwitch=r&&a&&!Object(A.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=u.levels,this.startFragRequested=!1},E.onLevelLoading=function(d,u){var r=this.levels;if(!(!r||this.state!==O.State.IDLE)){var a=r[u.level];(!a.details||a.details.live&&this.levelLastLoaded!==u.level||this.waitForCdnTuneIn(a.details))&&(this.state=O.State.WAITING_LEVEL)}},E.onLevelLoaded=function(d,u){var r,a=this.levels,v=u.level,m=u.details,D=m.totalduration;if(!a){this.warn("Levels were reset while loading level "+v);return}this.log("Level "+v+" loaded ["+m.startSN+","+m.endSN+"], cc ["+m.startCC+", "+m.endCC+"] duration:"+D);var R=this.fragCurrent;R&&(this.state===O.State.FRAG_LOADING||this.state===O.State.FRAG_LOADING_WAITING_RETRY)&&R.level!==u.level&&R.loader&&(this.state=O.State.IDLE,this.backtrackFragment=null,R.loader.abort());var F=a[v],_=0;if(m.live||(r=F.details)!==null&&r!==void 0&&r.live){if(m.fragments[0]||(m.deltaUpdateFailed=!0),m.deltaUpdateFailed)return;_=this.alignPlaylists(m,F.details)}if(F.details=m,this.levelLastLoaded=v,this.hls.trigger(b.Events.LEVEL_UPDATED,{details:m,level:v}),this.state===O.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(m))return;this.state=O.State.IDLE}this.startFragRequested?m.live&&this.synchronizeToLiveEdge(m):this.setStartPosition(m,_),this.tick()},E._handleFragmentLoadProgress=function(d){var u,r=d.frag,a=d.part,v=d.payload,m=this.levels;if(!m){this.warn("Levels were reset while fragment load was in progress. Fragment "+r.sn+" of level "+r.level+" will not be buffered");return}var D=m[r.level],R=D.details;if(!R){this.warn("Dropping fragment "+r.sn+" of level "+r.level+" after level details were reset");return}var F=D.videoCodec,_=R.PTSKnown||!R.live,B=(u=r.initSegment)===null||u===void 0?void 0:u.data,U=this._getAudioCodec(D),N=this.transmuxer=this.transmuxer||new S.default(this.hls,L.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),k=a?a.index:-1,w=k!==-1,K=new p.ChunkMetadata(r.level,r.sn,r.stats.chunkCount,v.byteLength,k,w),W=this.initPTS[r.cc];N.push(v,B,U,F,r,a,R.totalduration,_,K,W)},E.onAudioTrackSwitching=function(d,u){var r=this.altAudio,a=!!u.url,v=u.id;if(!a){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var m=this.fragCurrent;m!=null&&m.loader&&(this.log("Switching to main audio track, cancel main fragment load"),m.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var D=this.hls;r&&D.trigger(b.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),D.trigger(b.Events.AUDIO_TRACK_SWITCHED,{id:v})}},E.onAudioTrackSwitched=function(d,u){var r=u.id,a=!!this.hls.audioTracks[r].url;if(a){var v=this.videoBuffer;v&&this.mediaBuffer!==v&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=v)}this.altAudio=a,this.tick()},E.onBufferCreated=function(d,u){var r=u.tracks,a,v,m=!1;for(var D in r){var R=r[D];if(R.id==="main"){if(v=D,a=R,D==="video"){var F=r[D];F&&(this.videoBuffer=F.buffer)}}else m=!0}m&&a?(this.log("Alternate track found, use "+v+".buffered to schedule main fragment loading"),this.mediaBuffer=a.buffer):this.mediaBuffer=this.media},E.onFragBuffered=function(d,u){var r=u.frag,a=u.part;if(!(r&&r.type!==L.PlaylistLevelType.MAIN)){if(this.fragContextChanged(r)){this.warn("Fragment "+r.sn+(a?" p: "+a.index:"")+" of level "+r.level+" finished buffering, but was aborted. state: "+this.state),this.state===O.State.PARSED&&(this.state=O.State.IDLE);return}var v=a?a.stats:r.stats;this.fragLastKbps=Math.round(8*v.total/(v.buffering.end-v.loading.first)),r.sn!=="initSegment"&&(this.fragPrevious=r),this.fragBufferedComplete(r,a)}},E.onError=function(d,u){switch(u.details){case g.ErrorDetails.FRAG_LOAD_ERROR:case g.ErrorDetails.FRAG_LOAD_TIMEOUT:case g.ErrorDetails.KEY_LOAD_ERROR:case g.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(L.PlaylistLevelType.MAIN,u);break;case g.ErrorDetails.LEVEL_LOAD_ERROR:case g.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==O.State.ERROR&&(u.fatal?(this.warn(""+u.details),this.state=O.State.ERROR):!u.levelRetry&&this.state===O.State.WAITING_LEVEL&&(this.state=O.State.IDLE));break;case g.ErrorDetails.BUFFER_FULL_ERROR:if(u.parent==="main"&&(this.state===O.State.PARSING||this.state===O.State.PARSED)){var r=!0,a=this.getFwdBufferInfo(this.media,L.PlaylistLevelType.MAIN);a&&a.len>.5&&(r=!this.reduceMaxBufferLength(a.len)),r&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break}},E.checkBuffer=function(){var d=this.media,u=this.gapController;if(!(!d||!u||!d.readyState)){var r=P.BufferHelper.getBuffered(d);if(!this.loadedmetadata&&r.length)this.loadedmetadata=!0,this.seekToStartPos();else{var a=this.state!==O.State.IDLE?this.fragCurrent:null;u.poll(this.lastCurrentTime,a)}this.lastCurrentTime=d.currentTime}},E.onFragLoadEmergencyAborted=function(){this.state=O.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},E.onBufferFlushed=function(d,u){var r=u.type;if(r!==T.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var a=(r===T.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(a,r,L.PlaylistLevelType.MAIN)}},E.onLevelsUpdated=function(d,u){this.levels=u.levels},E.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},E.seekToStartPos=function(){var d=this.media,u=d.currentTime,r=this.startPosition;if(r>=0&&u<r){if(d.seeking){c.logger.log("could not seek to "+r+", already seeking at "+u);return}var a=P.BufferHelper.getBuffered(d),v=a.length?a.start(0):0,m=v-r;m>0&&(m<this.config.maxBufferHole||m<this.config.maxFragLookUpTolerance)&&(c.logger.log("adjusting start position by "+m+" to match buffer start"),r+=m,this.startPosition=r),this.log("seek to target start position "+r+" from current time "+u),d.currentTime=r}},E._getAudioCodec=function(d){var u=this.config.defaultAudioCodec||d.audioCodec;return this.audioCodecSwap&&u&&(this.log("Swapping audio codec"),u.indexOf("mp4a.40.5")!==-1?u="mp4a.40.2":u="mp4a.40.5"),u},E._loadBitrateTestFrag=function(d){var u=this;this._doFragLoad(d).then(function(r){var a=u.hls;if(!(!r||a.nextLoadLevel||u.fragContextChanged(d))){u.fragLoadError=0,u.state=O.State.IDLE,u.startFragRequested=!1,u.bitrateTest=!1;var v=d.stats;v.parsing.start=v.parsing.end=v.buffering.start=v.buffering.end=self.performance.now(),a.trigger(b.Events.FRAG_LOADED,r)}})},E._handleTransmuxComplete=function(d){var u,r="main",a=this.hls,v=d.remuxResult,m=d.chunkMeta,D=this.getCurrentContext(m);if(!D){this.warn("The loading context changed while buffering fragment "+m.sn+" of level "+m.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(m.level);return}var R=D.frag,F=D.part,_=D.level,B=v.video,U=v.text,N=v.id3,k=v.initSegment,w=_.details,K=this.altAudio?void 0:v.audio;if(!this.fragContextChanged(R)){if(this.state=O.State.PARSING,k){k.tracks&&(this._bufferInitSegment(_,k.tracks,R,m),a.trigger(b.Events.FRAG_PARSING_INIT_SEGMENT,{frag:R,id:r,tracks:k.tracks}));var W=k.initPTS,H=k.timescale;Object(M.isFiniteNumber)(W)&&(this.initPTS[R.cc]=W,a.trigger(b.Events.INIT_PTS_FOUND,{frag:R,id:r,initPTS:W,timescale:H}))}if(B&&v.independent!==!1){if(w){var G=B.startPTS,Y=B.endPTS,Q=B.startDTS,z=B.endDTS;if(F)F.elementaryStreams[B.type]={startPTS:G,endPTS:Y,startDTS:Q,endDTS:z};else if(B.firstKeyFrame&&B.independent&&(this.couldBacktrack=!0),B.dropped&&B.independent){var V=this.getMainFwdBufferInfo(),X=(V?V.end:this.getLoadPosition())+this.config.maxBufferHole,J=B.firstKeyFramePTS?B.firstKeyFramePTS:G;if(X<J-this.config.maxBufferHole){this.backtrack(R);return}R.setElementaryStreamInfo(B.type,R.start,Y,R.start,z,!0)}R.setElementaryStreamInfo(B.type,G,Y,Q,z),this.backtrackFragment&&(this.backtrackFragment=R),this.bufferFragmentData(B,R,F,m)}}else if(v.independent===!1){this.backtrack(R);return}if(K){var $=K.startPTS,Z=K.endPTS,q=K.startDTS,ee=K.endDTS;F&&(F.elementaryStreams[T.ElementaryStreamTypes.AUDIO]={startPTS:$,endPTS:Z,startDTS:q,endDTS:ee}),R.setElementaryStreamInfo(T.ElementaryStreamTypes.AUDIO,$,Z,q,ee),this.bufferFragmentData(K,R,F,m)}if(w&&N!==null&&N!==void 0&&(u=N.samples)!==null&&u!==void 0&&u.length){var re={id:r,frag:R,details:w,samples:N.samples};a.trigger(b.Events.FRAG_PARSING_METADATA,re)}if(w&&U){var te={id:r,frag:R,details:w,samples:U.samples};a.trigger(b.Events.FRAG_PARSING_USERDATA,te)}}},E._bufferInitSegment=function(d,u,r,a){var v=this;if(this.state===O.State.PARSING){this.audioOnly=!!u.audio&&!u.video,this.altAudio&&!this.audioOnly&&delete u.audio;var m=u.audio,D=u.video,R=u.audiovideo;if(m){var F=d.audioCodec,_=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(F&&(F.indexOf("mp4a.40.5")!==-1?F="mp4a.40.2":F="mp4a.40.5"),m.metadata.channelCount!==1&&_.indexOf("firefox")===-1&&(F="mp4a.40.5")),_.indexOf("android")!==-1&&m.container!=="audio/mpeg"&&(F="mp4a.40.2",this.log("Android: force audio codec to "+F)),d.audioCodec&&d.audioCodec!==F&&this.log('Swapping manifest audio codec "'+d.audioCodec+'" for "'+F+'"'),m.levelCodec=F,m.id="main",this.log("Init audio buffer, container:"+m.container+", codecs[selected/level/parsed]=["+(F||"")+"/"+(d.audioCodec||"")+"/"+m.codec+"]")}D&&(D.levelCodec=d.videoCodec,D.id="main",this.log("Init video buffer, container:"+D.container+", codecs[level/parsed]=["+(d.videoCodec||"")+"/"+D.codec+"]")),R&&this.log("Init audiovideo buffer, container:"+R.container+", codecs[level/parsed]=["+(d.attrs.CODECS||"")+"/"+R.codec+"]"),this.hls.trigger(b.Events.BUFFER_CODECS,u),Object.keys(u).forEach(function(B){var U=u[B],N=U.initSegment;N!=null&&N.byteLength&&v.hls.trigger(b.Events.BUFFER_APPENDING,{type:B,data:N,frag:r,part:null,chunkMeta:a,parent:r.type})}),this.tick()}},E.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,L.PlaylistLevelType.MAIN)},E.backtrack=function(d){this.couldBacktrack=!0,this.backtrackFragment=d,this.resetTransmuxer(),this.flushBufferGap(d),this.fragmentTracker.removeFragment(d),this.fragPrevious=null,this.nextLoadPosition=d.start,this.state=O.State.IDLE},E.checkFragmentChanged=function(){var d=this.media,u=null;if(d&&d.readyState>1&&d.seeking===!1){var r=d.currentTime;if(P.BufferHelper.isBuffered(d,r)?u=this.getAppendedFrag(r):P.BufferHelper.isBuffered(d,r+.1)&&(u=this.getAppendedFrag(r+.1)),u){this.backtrackFragment=null;var a=this.fragPlaying,v=u.level;(!a||u.sn!==a.sn||a.level!==v||u.urlId!==a.urlId)&&(this.hls.trigger(b.Events.FRAG_CHANGED,{frag:u}),(!a||a.level!==v)&&this.hls.trigger(b.Events.LEVEL_SWITCHED,{level:v}),this.fragPlaying=u)}}},e(n,[{key:"nextLevel",get:function(){var d=this.nextBufferedFrag;return d?d.level:-1}},{key:"currentFrag",get:function(){var d=this.media;return d?this.fragPlaying||this.getAppendedFrag(d.currentTime):null}},{key:"currentProgramDateTime",get:function(){var d=this.media;if(d){var u=d.currentTime,r=this.currentFrag;if(r&&Object(M.isFiniteNumber)(u)&&Object(M.isFiniteNumber)(r.programDateTime)){var a=r.programDateTime+(u-r.start)*1e3;return new Date(a)}}return null}},{key:"currentLevel",get:function(){var d=this.currentFrag;return d?d.level:-1}},{key:"nextBufferedFrag",get:function(){var d=this.currentFrag;return d?this.followingBufferedFrag(d):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),n}(O.default)},"./src/controller/subtitle-stream-controller.ts":function(j,C,x){x.r(C),x.d(C,"SubtitleStreamController",function(){return e});var M=x("./src/events.ts"),O=x("./src/utils/buffer-helper.ts"),A=x("./src/controller/fragment-finders.ts"),b=x("./src/utils/discontinuities.ts"),P=x("./src/controller/level-helper.ts"),I=x("./src/controller/fragment-tracker.ts"),L=x("./src/controller/base-stream-controller.ts"),T=x("./src/types/loader.ts"),S=x("./src/types/level.ts");function p(s,l){for(var f=0;f<l.length;f++){var o=l[f];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(s,o.key,o)}}function y(s,l,f){return l&&p(s.prototype,l),f&&p(s,f),Object.defineProperty(s,"prototype",{writable:!1}),s}function g(s,l){s.prototype=Object.create(l.prototype),s.prototype.constructor=s,c(s,l)}function c(s,l){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,t){return o.__proto__=t,o},c(s,l)}var i=500,e=function(s){g(l,s);function l(o,t){var n;return n=s.call(this,o,t,"[subtitle-stream-controller]")||this,n.levels=[],n.currentTrackId=-1,n.tracksBuffered=[],n.mainDetails=null,n._registerListeners(),n}var f=l.prototype;return f.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},f._registerListeners=function(){var t=this.hls;t.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(M.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(M.Events.ERROR,this.onError,this),t.on(M.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(M.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(M.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.on(M.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},f._unregisterListeners=function(){var t=this.hls;t.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(M.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(M.Events.ERROR,this.onError,this),t.off(M.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(M.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(M.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.off(M.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},f.startLoad=function(){this.stopLoad(),this.state=L.State.IDLE,this.setInterval(i),this.tick()},f.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},f.onLevelLoaded=function(t,n){this.mainDetails=n.details},f.onSubtitleFragProcessed=function(t,n){var E=n.frag,h=n.success;if(this.fragPrevious=E,this.state=L.State.IDLE,!!h){var d=this.tracksBuffered[this.currentTrackId];if(!!d){for(var u,r=E.start,a=0;a<d.length;a++)if(r>=d[a].start&&r<=d[a].end){u=d[a];break}var v=E.start+E.duration;u?u.end=v:(u={start:r,end:v},d.push(u)),this.fragmentTracker.fragBuffered(E)}}},f.onBufferFlushing=function(t,n){var E=n.startOffset,h=n.endOffset;if(E===0&&h!==Number.POSITIVE_INFINITY){var d=this.currentTrackId,u=this.levels;if(!u.length||!u[d]||!u[d].details)return;var r=u[d].details,a=r.targetduration,v=h-a;if(v<=0)return;n.endOffsetSubtitles=Math.max(0,v),this.tracksBuffered.forEach(function(m){for(var D=0;D<m.length;){if(m[D].end<=v){m.shift();continue}else if(m[D].start<v)m[D].start=v;else break;D++}}),this.fragmentTracker.removeFragmentsInRange(E,v,T.PlaylistLevelType.SUBTITLE)}},f.onError=function(t,n){var E,h=n.frag;!h||h.type!==T.PlaylistLevelType.SUBTITLE||((E=this.fragCurrent)!==null&&E!==void 0&&E.loader&&this.fragCurrent.loader.abort(),this.state=L.State.IDLE)},f.onSubtitleTracksUpdated=function(t,n){var E=this,h=n.subtitleTracks;this.tracksBuffered=[],this.levels=h.map(function(d){return new S.Level(d)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(d){E.tracksBuffered[d.id]=[]}),this.mediaBuffer=null},f.onSubtitleTrackSwitch=function(t,n){if(this.currentTrackId=n.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var E=this.levels[this.currentTrackId];E!=null&&E.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,E&&this.setInterval(i)},f.onSubtitleTrackLoaded=function(t,n){var E,h=n.details,d=n.id,u=this.currentTrackId,r=this.levels;if(!!r.length){var a=r[u];if(!(d>=r.length||d!==u||!a)){if(this.mediaBuffer=this.mediaBufferTimeRanges,h.live||(E=a.details)!==null&&E!==void 0&&E.live){var v=this.mainDetails;if(h.deltaUpdateFailed||!v)return;var m=v.fragments[0];if(!a.details)h.hasProgramDateTime&&v.hasProgramDateTime?Object(b.alignMediaPlaylistByPDT)(h,v):m&&Object(P.addSliding)(h,m.start);else{var D=this.alignPlaylists(h,a.details);D===0&&m&&Object(P.addSliding)(h,m.start)}}if(a.details=h,this.levelLastLoaded=d,this.tick(),h.live&&!this.fragCurrent&&this.media&&this.state===L.State.IDLE){var R=Object(A.findFragmentByPTS)(null,h.fragments,this.media.currentTime,0);R||(this.warn("Subtitle playlist not aligned with playback"),a.details=void 0)}}}},f._handleFragmentLoadComplete=function(t){var n=t.frag,E=t.payload,h=n.decryptdata,d=this.hls;if(!this.fragContextChanged(n)&&E&&E.byteLength>0&&h&&h.key&&h.iv&&h.method==="AES-128"){var u=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(E),h.key.buffer,h.iv.buffer).then(function(r){var a=performance.now();d.trigger(M.Events.FRAG_DECRYPTED,{frag:n,payload:r,stats:{tstart:u,tdecrypt:a}})})}},f.doTick=function(){if(!this.media){this.state=L.State.IDLE;return}if(this.state===L.State.IDLE){var t,n=this.currentTrackId,E=this.levels;if(!E.length||!E[n]||!E[n].details)return;var h=E[n].details,d=h.targetduration,u=this.config,r=this.media,a=O.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,r.currentTime-d,u.maxBufferHole),v=a.end,m=a.len,D=this.getMaxBufferLength()+d;if(m>D)return;console.assert(h,"Subtitle track details are defined on idle subtitle stream controller tick");var R=h.fragments,F=R.length,_=h.edge,B,U=this.fragPrevious;if(v<_){var N=u.maxFragLookUpTolerance;B=Object(A.findFragmentByPTS)(U,R,Math.max(R[0].start,v),N),!B&&U&&U.start<R[0].start&&(B=R[0])}else B=R[F-1];(t=B)!==null&&t!==void 0&&t.encrypted?this.loadKey(B,h):B&&this.fragmentTracker.getState(B)===I.FragmentState.NOT_LOADED&&this.loadFragment(B,h,v)}},f.loadFragment=function(t,n,E){this.fragCurrent=t,s.prototype.loadFragment.call(this,t,n,E)},y(l,[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}]),l}(L.default)},"./src/controller/subtitle-track-controller.ts":function(j,C,x){x.r(C);var M=x("./src/events.ts"),O=x("./src/utils/texttrack-utils.ts"),A=x("./src/controller/base-playlist-controller.ts"),b=x("./src/types/loader.ts");function P(y,g){for(var c=0;c<g.length;c++){var i=g[c];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(y,i.key,i)}}function I(y,g,c){return g&&P(y.prototype,g),c&&P(y,c),Object.defineProperty(y,"prototype",{writable:!1}),y}function L(y,g){y.prototype=Object.create(g.prototype),y.prototype.constructor=y,T(y,g)}function T(y,g){return T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,e){return i.__proto__=e,i},T(y,g)}var S=function(y){L(g,y);function g(i){var e;return e=y.call(this,i,"[subtitle-track-controller]")||this,e.media=null,e.tracks=[],e.groupId=null,e.tracksInGroup=[],e.trackId=-1,e.selectDefaultTrack=!0,e.queuedDefaultTrack=-1,e.trackChangeListener=function(){return e.onTextTracksChanged()},e.asyncPollTrackChange=function(){return e.pollTrackChange(0)},e.useTextTrackPolling=!1,e.subtitlePollingInterval=-1,e._subtitleDisplay=!0,e.registerListeners(),e}var c=g.prototype;return c.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,y.prototype.destroy.call(this)},c.registerListeners=function(){var e=this.hls;e.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(M.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(M.Events.ERROR,this.onError,this)},c.unregisterListeners=function(){var e=this.hls;e.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(M.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(M.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(M.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(M.Events.ERROR,this.onError,this)},c.onMediaAttached=function(e,s){this.media=s.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},c.pollTrackChange=function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)},c.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var e=p(this.media.textTracks);e.forEach(function(s){Object(O.clearCurrentCues)(s)}),this.subtitleTrack=-1,this.media=null}},c.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},c.onManifestParsed=function(e,s){this.tracks=s.subtitleTracks},c.onSubtitleTrackLoaded=function(e,s){var l=s.id,f=s.details,o=this.trackId,t=this.tracksInGroup[o];if(!t){this.warn("Invalid subtitle track id "+l);return}var n=t.details;t.details=s.details,this.log("subtitle track "+l+" loaded ["+f.startSN+"-"+f.endSN+"]"),l===this.trackId&&(this.retryCount=0,this.playlistLoaded(l,s,n))},c.onLevelLoading=function(e,s){this.switchLevel(s.level)},c.onLevelSwitching=function(e,s){this.switchLevel(s.level)},c.switchLevel=function(e){var s=this.hls.levels[e];if(!!(s!=null&&s.textGroupIds)){var l=s.textGroupIds[s.urlId];if(this.groupId!==l){var f=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,o=this.tracks.filter(function(E){return!l||E.groupId===l});this.tracksInGroup=o;var t=this.findTrackId(f==null?void 0:f.name)||this.findTrackId();this.groupId=l;var n={subtitleTracks:o};this.log("Updating subtitle tracks, "+o.length+' track(s) found in "'+l+'" group-id'),this.hls.trigger(M.Events.SUBTITLE_TRACKS_UPDATED,n),t!==-1&&this.setSubtitleTrack(t,f)}}},c.findTrackId=function(e){for(var s=this.tracksInGroup,l=0;l<s.length;l++){var f=s[l];if((!this.selectDefaultTrack||f.default)&&(!e||e===f.name))return f.id}return-1},c.onError=function(e,s){y.prototype.onError.call(this,e,s),!(s.fatal||!s.context)&&s.context.type===b.PlaylistContextType.SUBTITLE_TRACK&&s.context.id===this.trackId&&s.context.groupId===this.groupId&&this.retryLoadingOrFail(s)},c.loadPlaylist=function(e){var s=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(s)){var l=s.id,f=s.groupId,o=s.url;if(e)try{o=e.addDirectives(o)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log("Loading subtitle playlist for id "+l),this.hls.trigger(M.Events.SUBTITLE_TRACK_LOADING,{url:o,id:l,groupId:f,deliveryDirectives:e||null})}},c.toggleTrackModes=function(e){var s=this,l=this.media,f=this.trackId;if(!!l){var o=p(l.textTracks),t=o.filter(function(h){return h.groupId===s.groupId});if(e===-1)[].slice.call(o).forEach(function(h){h.mode="disabled"});else{var n=t[f];n&&(n.mode="disabled")}var E=t[e];E&&(E.mode=this.subtitleDisplay?"showing":"hidden")}},c.setSubtitleTrack=function(e,s){var l,f=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(this.trackId!==e&&this.toggleTrackModes(e),!(this.trackId===e&&(e===-1||(l=f[e])!==null&&l!==void 0&&l.details)||e<-1||e>=f.length)){this.clearTimer();var o=f[e];if(this.log("Switching to subtitle track "+e),this.trackId=e,o){var t=o.id,n=o.groupId,E=n===void 0?"":n,h=o.name,d=o.type,u=o.url;this.hls.trigger(M.Events.SUBTITLE_TRACK_SWITCH,{id:t,groupId:E,name:h,type:d,url:u});var r=this.switchParams(o.url,s==null?void 0:s.details);this.loadPlaylist(r)}else this.hls.trigger(M.Events.SUBTITLE_TRACK_SWITCH,{id:e})}},c.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var e=-1,s=p(this.media.textTracks),l=0;l<s.length;l++)if(s[l].mode==="hidden")e=l;else if(s[l].mode==="showing"){e=l;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},I(g,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1;var s=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,s)}}]),g}(A.default);function p(y){for(var g=[],c=0;c<y.length;c++){var i=y[c];i.kind==="subtitles"&&i.label&&g.push(y[c])}return g}C.default=S},"./src/controller/timeline-controller.ts":function(j,C,x){x.r(C),x.d(C,"TimelineController",function(){return p});var M=x("./src/polyfills/number.ts"),O=x("./src/events.ts"),A=x("./src/utils/cea-608-parser.ts"),b=x("./src/utils/output-filter.ts"),P=x("./src/utils/webvtt-parser.ts"),I=x("./src/utils/texttrack-utils.ts"),L=x("./src/utils/imsc1-ttml-parser.ts"),T=x("./src/types/loader.ts"),S=x("./src/utils/logger.ts"),p=function(){function i(s){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=c(),this.captionsProperties=void 0,this.hls=s,this.config=s.config,this.Cues=s.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var l=new b.default(this,"textTrack1"),f=new b.default(this,"textTrack2"),o=new b.default(this,"textTrack3"),t=new b.default(this,"textTrack4");this.cea608Parser1=new A.default(1,l,f),this.cea608Parser2=new A.default(3,o,t)}s.on(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),s.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.on(O.Events.MANIFEST_LOADED,this.onManifestLoaded,this),s.on(O.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),s.on(O.Events.FRAG_LOADING,this.onFragLoading,this),s.on(O.Events.FRAG_LOADED,this.onFragLoaded,this),s.on(O.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),s.on(O.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),s.on(O.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),s.on(O.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),s.on(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var e=i.prototype;return e.destroy=function(){var l=this.hls;l.off(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),l.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.off(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.off(O.Events.MANIFEST_LOADED,this.onManifestLoaded,this),l.off(O.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),l.off(O.Events.FRAG_LOADING,this.onFragLoading,this),l.off(O.Events.FRAG_LOADED,this.onFragLoaded,this),l.off(O.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),l.off(O.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),l.off(O.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),l.off(O.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),l.off(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},e.addCues=function(l,f,o,t,n){for(var E=!1,h=n.length;h--;){var d=n[h],u=g(d[0],d[1],f,o);if(u>=0&&(d[0]=Math.min(d[0],f),d[1]=Math.max(d[1],o),E=!0,u/(o-f)>.5))return}if(E||n.push([f,o]),this.config.renderTextTracksNatively){var r=this.captionsTracks[l];this.Cues.newCue(r,f,o,t)}else{var a=this.Cues.newCue(null,f,o,t);this.hls.trigger(O.Events.CUES_PARSED,{type:"captions",cues:a,track:l})}},e.onInitPtsFound=function(l,f){var o=this,t=f.frag,n=f.id,E=f.initPTS,h=f.timescale,d=this.unparsedVttFrags;n==="main"&&(this.initPTS[t.cc]=E,this.timescale[t.cc]=h),d.length&&(this.unparsedVttFrags=[],d.forEach(function(u){o.onFragLoaded(O.Events.FRAG_LOADED,u)}))},e.getExistingTrack=function(l){var f=this.media;if(f)for(var o=0;o<f.textTracks.length;o++){var t=f.textTracks[o];if(t[l])return t}return null},e.createCaptionsTrack=function(l){this.config.renderTextTracksNatively?this.createNativeTrack(l):this.createNonNativeTrack(l)},e.createNativeTrack=function(l){if(!this.captionsTracks[l]){var f=this.captionsProperties,o=this.captionsTracks,t=this.media,n=f[l],E=n.label,h=n.languageCode,d=this.getExistingTrack(l);if(d)o[l]=d,Object(I.clearCurrentCues)(o[l]),Object(I.sendAddTrackEvent)(o[l],t);else{var u=this.createTextTrack("captions",E,h);u&&(u[l]=!0,o[l]=u)}}},e.createNonNativeTrack=function(l){if(!this.nonNativeCaptionsTracks[l]){var f=this.captionsProperties[l];if(!!f){var o=f.label,t={_id:l,label:o,kind:"captions",default:f.media?!!f.media.default:!1,closedCaptions:f.media};this.nonNativeCaptionsTracks[l]=t,this.hls.trigger(O.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[t]})}}},e.createTextTrack=function(l,f,o){var t=this.media;if(!!t)return t.addTextTrack(l,f,o)},e.onMediaAttaching=function(l,f){this.media=f.media,this._cleanTracks()},e.onMediaDetaching=function(){var l=this.captionsTracks;Object.keys(l).forEach(function(f){Object(I.clearCurrentCues)(l[f]),delete l[f]}),this.nonNativeCaptionsTracks={}},e.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=c(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},e._cleanTracks=function(){var l=this.media;if(!!l){var f=l.textTracks;if(f)for(var o=0;o<f.length;o++)Object(I.clearCurrentCues)(f[o])}},e.onSubtitleTracksUpdated=function(l,f){var o=this;this.textTracks=[];var t=f.subtitleTracks||[],n=t.some(function(u){return u.textCodec===L.IMSC1_CODEC});if(this.config.enableWebVTT||n&&this.config.enableIMSC1){var E=this.tracks&&t&&this.tracks.length===t.length;if(this.tracks=t||[],this.config.renderTextTracksNatively){var h=this.media?this.media.textTracks:[];this.tracks.forEach(function(u,r){var a;if(r<h.length){for(var v=null,m=0;m<h.length;m++)if(y(h[m],u)){v=h[m];break}v&&(a=v)}a?Object(I.clearCurrentCues)(a):(a=o.createTextTrack("subtitles",u.name,u.lang),a&&(a.mode="disabled")),a&&(a.groupId=u.groupId,o.textTracks.push(a))})}else if(!E&&this.tracks&&this.tracks.length){var d=this.tracks.map(function(u){return{label:u.name,kind:u.type.toLowerCase(),default:u.default,subtitleTrack:u}});this.hls.trigger(O.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:d})}}},e.onManifestLoaded=function(l,f){var o=this;this.config.enableCEA708Captions&&f.captions&&f.captions.forEach(function(t){var n=/(?:CC|SERVICE)([1-4])/.exec(t.instreamId);if(!!n){var E="textTrack"+n[1],h=o.captionsProperties[E];!h||(h.label=t.name,t.lang&&(h.languageCode=t.lang),h.media=t)}})},e.onFragLoading=function(l,f){var o=this.cea608Parser1,t=this.cea608Parser2,n=this.lastSn,E=this.lastPartIndex;if(!(!this.enabled||!(o&&t))&&f.frag.type===T.PlaylistLevelType.MAIN){var h,d,u=f.frag.sn,r=(h=f==null||(d=f.part)===null||d===void 0?void 0:d.index)!=null?h:-1;u===n+1||u===n&&r===E+1||(o.reset(),t.reset()),this.lastSn=u,this.lastPartIndex=r}},e.onFragLoaded=function(l,f){var o=f.frag,t=f.payload,n=this.initPTS,E=this.unparsedVttFrags;if(o.type===T.PlaylistLevelType.SUBTITLE)if(t.byteLength){if(!Object(M.isFiniteNumber)(n[o.cc])){E.push(f),n.length&&this.hls.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:o,error:new Error("Missing initial subtitle PTS")});return}var h=o.decryptdata,d="stats"in f;if(h==null||h.key==null||h.method!=="AES-128"||d){var u=this.tracks[o.level],r=this.vttCCs;r[o.cc]||(r[o.cc]={start:o.start,prevCC:this.prevCC,new:!0},this.prevCC=o.cc),u&&u.textCodec===L.IMSC1_CODEC?this._parseIMSC1(o,t):this._parseVTTs(o,t,r)}}else this.hls.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:o,error:new Error("Empty subtitle payload")})},e._parseIMSC1=function(l,f){var o=this,t=this.hls;Object(L.parseIMSC1)(f,this.initPTS[l.cc],this.timescale[l.cc],function(n){o._appendCues(n,l.level),t.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:l})},function(n){S.logger.log("Failed to parse IMSC1: "+n),t.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l,error:n})})},e._parseVTTs=function(l,f,o){var t=this,n=this.hls;Object(P.parseWebVTT)(f,this.initPTS[l.cc],this.timescale[l.cc],o,l.cc,l.start,function(E){t._appendCues(E,l.level),n.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:l})},function(E){t._fallbackToIMSC1(l,f),S.logger.log("Failed to parse VTT cue: "+E),n.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l,error:E})})},e._fallbackToIMSC1=function(l,f){var o=this,t=this.tracks[l.level];t.textCodec||Object(L.parseIMSC1)(f,this.initPTS[l.cc],this.timescale[l.cc],function(){t.textCodec=L.IMSC1_CODEC,o._parseIMSC1(l,f)},function(){t.textCodec="wvtt"})},e._appendCues=function(l,f){var o=this.hls;if(this.config.renderTextTracksNatively){var t=this.textTracks[f];if(!t||t.mode==="disabled")return;l.forEach(function(h){return Object(I.addCueToTrack)(t,h)})}else{var n=this.tracks[f];if(!n)return;var E=n.default?"default":"subtitles"+f;o.trigger(O.Events.CUES_PARSED,{type:"subtitles",cues:l,track:E})}},e.onFragDecrypted=function(l,f){var o=f.frag;if(o.type===T.PlaylistLevelType.SUBTITLE){if(!Object(M.isFiniteNumber)(this.initPTS[o.cc])){this.unparsedVttFrags.push(f);return}this.onFragLoaded(O.Events.FRAG_LOADED,f)}},e.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},e.onFragParsingUserdata=function(l,f){var o=this.cea608Parser1,t=this.cea608Parser2;if(!(!this.enabled||!(o&&t)))for(var n=0;n<f.samples.length;n++){var E=f.samples[n].bytes;if(E){var h=this.extractCea608Data(E);o.addData(f.samples[n].pts,h[0]),t.addData(f.samples[n].pts,h[1])}}},e.onBufferFlushing=function(l,f){var o=f.startOffset,t=f.endOffset,n=f.endOffsetSubtitles,E=f.type,h=this.media;if(!(!h||h.currentTime<t)){if(!E||E==="video"){var d=this.captionsTracks;Object.keys(d).forEach(function(r){return Object(I.removeCuesInRange)(d[r],o,t)})}if(this.config.renderTextTracksNatively&&o===0&&n!==void 0){var u=this.textTracks;Object.keys(u).forEach(function(r){return Object(I.removeCuesInRange)(u[r],o,n)})}}},e.extractCea608Data=function(l){for(var f=[[],[]],o=l[0]&31,t=2,n=0;n<o;n++){var E=l[t++],h=127&l[t++],d=127&l[t++];if(!(h===0&&d===0)){var u=(4&E)!==0;if(u){var r=3&E;(r===0||r===1)&&(f[r].push(h),f[r].push(d))}}}return f},i}();function y(i,e){return i&&i.label===e.name&&!(i.textTrack1||i.textTrack2)}function g(i,e,s,l){return Math.min(e,l)-Math.max(i,s)}function c(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}}}},"./src/crypt/aes-crypto.ts":function(j,C,x){x.r(C),x.d(C,"default",function(){return M});var M=function(){function O(b,P){this.subtle=void 0,this.aesIV=void 0,this.subtle=b,this.aesIV=P}var A=O.prototype;return A.decrypt=function(P,I){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},I,P)},O}()},"./src/crypt/aes-decryptor.ts":function(j,C,x){x.r(C),x.d(C,"removePadding",function(){return O}),x.d(C,"default",function(){return A});var M=x("./src/utils/typed-array.ts");function O(b){var P=b.byteLength,I=P&&new DataView(b.buffer).getUint8(P-1);return I?Object(M.sliceUint8)(b,0,P-I):b}var A=function(){function b(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var P=b.prototype;return P.uint8ArrayToUint32Array_=function(L){for(var T=new DataView(L),S=new Uint32Array(4),p=0;p<4;p++)S[p]=T.getUint32(p*4);return S},P.initTable=function(){var L=this.sBox,T=this.invSBox,S=this.subMix,p=S[0],y=S[1],g=S[2],c=S[3],i=this.invSubMix,e=i[0],s=i[1],l=i[2],f=i[3],o=new Uint32Array(256),t=0,n=0,E=0;for(E=0;E<256;E++)E<128?o[E]=E<<1:o[E]=E<<1^283;for(E=0;E<256;E++){var h=n^n<<1^n<<2^n<<3^n<<4;h=h>>>8^h&255^99,L[t]=h,T[h]=t;var d=o[t],u=o[d],r=o[u],a=o[h]*257^h*16843008;p[t]=a<<24|a>>>8,y[t]=a<<16|a>>>16,g[t]=a<<8|a>>>24,c[t]=a,a=r*16843009^u*65537^d*257^t*16843008,e[h]=a<<24|a>>>8,s[h]=a<<16|a>>>16,l[h]=a<<8|a>>>24,f[h]=a,t?(t=d^o[o[o[r^d]]],n^=o[o[n]]):t=n=1}},P.expandKey=function(L){for(var T=this.uint8ArrayToUint32Array_(L),S=!0,p=0;p<T.length&&S;)S=T[p]===this.key[p],p++;if(!S){this.key=T;var y=this.keySize=T.length;if(y!==4&&y!==6&&y!==8)throw new Error("Invalid aes key size="+y);var g=this.ksRows=(y+6+1)*4,c,i,e=this.keySchedule=new Uint32Array(g),s=this.invKeySchedule=new Uint32Array(g),l=this.sBox,f=this.rcon,o=this.invSubMix,t=o[0],n=o[1],E=o[2],h=o[3],d,u;for(c=0;c<g;c++){if(c<y){d=e[c]=T[c];continue}u=d,c%y===0?(u=u<<8|u>>>24,u=l[u>>>24]<<24|l[u>>>16&255]<<16|l[u>>>8&255]<<8|l[u&255],u^=f[c/y|0]<<24):y>6&&c%y===4&&(u=l[u>>>24]<<24|l[u>>>16&255]<<16|l[u>>>8&255]<<8|l[u&255]),e[c]=d=(e[c-y]^u)>>>0}for(i=0;i<g;i++)c=g-i,i&3?u=e[c]:u=e[c-4],i<4||c<=4?s[i]=u:s[i]=t[l[u>>>24]]^n[l[u>>>16&255]]^E[l[u>>>8&255]]^h[l[u&255]],s[i]=s[i]>>>0}},P.networkToHostOrderSwap=function(L){return L<<24|(L&65280)<<8|(L&16711680)>>8|L>>>24},P.decrypt=function(L,T,S){for(var p=this.keySize+6,y=this.invKeySchedule,g=this.invSBox,c=this.invSubMix,i=c[0],e=c[1],s=c[2],l=c[3],f=this.uint8ArrayToUint32Array_(S),o=f[0],t=f[1],n=f[2],E=f[3],h=new Int32Array(L),d=new Int32Array(h.length),u,r,a,v,m,D,R,F,_,B,U,N,k,w,K=this.networkToHostOrderSwap;T<h.length;){for(_=K(h[T]),B=K(h[T+1]),U=K(h[T+2]),N=K(h[T+3]),m=_^y[0],D=N^y[1],R=U^y[2],F=B^y[3],k=4,w=1;w<p;w++)u=i[m>>>24]^e[D>>16&255]^s[R>>8&255]^l[F&255]^y[k],r=i[D>>>24]^e[R>>16&255]^s[F>>8&255]^l[m&255]^y[k+1],a=i[R>>>24]^e[F>>16&255]^s[m>>8&255]^l[D&255]^y[k+2],v=i[F>>>24]^e[m>>16&255]^s[D>>8&255]^l[R&255]^y[k+3],m=u,D=r,R=a,F=v,k=k+4;u=g[m>>>24]<<24^g[D>>16&255]<<16^g[R>>8&255]<<8^g[F&255]^y[k],r=g[D>>>24]<<24^g[R>>16&255]<<16^g[F>>8&255]<<8^g[m&255]^y[k+1],a=g[R>>>24]<<24^g[F>>16&255]<<16^g[m>>8&255]<<8^g[D&255]^y[k+2],v=g[F>>>24]<<24^g[m>>16&255]<<16^g[D>>8&255]<<8^g[R&255]^y[k+3],d[T]=K(u^o),d[T+1]=K(v^t),d[T+2]=K(a^n),d[T+3]=K(r^E),o=_,t=B,n=U,E=N,T=T+4}return d.buffer},b}()},"./src/crypt/decrypter.ts":function(j,C,x){x.r(C),x.d(C,"default",function(){return T});var M=x("./src/crypt/aes-crypto.ts"),O=x("./src/crypt/fast-aes-key.ts"),A=x("./src/crypt/aes-decryptor.ts"),b=x("./src/utils/logger.ts"),P=x("./src/utils/mp4-tools.ts"),I=x("./src/utils/typed-array.ts"),L=16,T=function(){function S(y,g,c){var i=c===void 0?{}:c,e=i.removePKCS7Padding,s=e===void 0?!0:e;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=y,this.config=g,this.removePKCS7Padding=s,s)try{var l=self.crypto;l&&(this.subtle=l.subtle||l.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var p=S.prototype;return p.destroy=function(){this.observer=null},p.isSync=function(){return this.config.enableSoftwareAES},p.flush=function(){var g=this.currentResult;if(!g){this.reset();return}var c=new Uint8Array(g);return this.reset(),this.removePKCS7Padding?Object(A.removePadding)(c):c},p.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},p.decrypt=function(g,c,i,e){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(g),c,i);var s=this.flush();s&&e(s.buffer)}else this.webCryptoDecrypt(new Uint8Array(g),c,i).then(e)},p.softwareDecrypt=function(g,c,i){var e=this.currentIV,s=this.currentResult,l=this.remainderData;this.logOnce("JS AES decrypt"),l&&(g=Object(P.appendUint8Array)(l,g),this.remainderData=null);var f=this.getValidChunk(g);if(!f.length)return null;e&&(i=e);var o=this.softwareDecrypter;o||(o=this.softwareDecrypter=new A.default),o.expandKey(c);var t=s;return this.currentResult=o.decrypt(f.buffer,0,i),this.currentIV=Object(I.sliceUint8)(f,-16).buffer,t||null},p.webCryptoDecrypt=function(g,c,i){var e=this,s=this.subtle;return(this.key!==c||!this.fastAesKey)&&(this.key=c,this.fastAesKey=new O.default(s,c)),this.fastAesKey.expandKey().then(function(l){if(!s)return Promise.reject(new Error("web crypto not initialized"));var f=new M.default(s,i);return f.decrypt(g.buffer,l)}).catch(function(l){return e.onWebCryptoError(l,g,c,i)})},p.onWebCryptoError=function(g,c,i,e){return b.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",g),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(c,i,e)},p.getValidChunk=function(g){var c=g,i=g.length-g.length%L;return i!==g.length&&(c=Object(I.sliceUint8)(g,0,i),this.remainderData=Object(I.sliceUint8)(g,i)),c},p.logOnce=function(g){!this.logEnabled||(b.logger.log("[decrypter.ts]: "+g),this.logEnabled=!1)},S}()},"./src/crypt/fast-aes-key.ts":function(j,C,x){x.r(C),x.d(C,"default",function(){return M});var M=function(){function O(b,P){this.subtle=void 0,this.key=void 0,this.subtle=b,this.key=P}var A=O.prototype;return A.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},O}()},"./src/demux/aacdemuxer.ts":function(j,C,x){x.r(C);var M=x("./src/demux/base-audio-demuxer.ts"),O=x("./src/demux/adts.ts"),A=x("./src/utils/logger.ts"),b=x("./src/demux/id3.ts");function P(T,S){T.prototype=Object.create(S.prototype),T.prototype.constructor=T,I(T,S)}function I(T,S){return I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(y,g){return y.__proto__=g,y},I(T,S)}var L=function(T){P(S,T);function S(y,g){var c;return c=T.call(this)||this,c.observer=void 0,c.config=void 0,c.observer=y,c.config=g,c}var p=S.prototype;return p.resetInitSegment=function(g,c,i,e){T.prototype.resetInitSegment.call(this,g,c,i,e),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:c,duration:e,inputTimeScale:9e4,dropped:0}},S.probe=function(g){if(!g)return!1;for(var c=b.getID3Data(g,0)||[],i=c.length,e=g.length;i<e;i++)if(O.probe(g,i))return A.logger.log("ADTS sync word found !"),!0;return!1},p.canParse=function(g,c){return O.canParse(g,c)},p.appendFrame=function(g,c,i){O.initTrackConfig(g,this.observer,c,i,g.manifestCodec);var e=O.appendFrame(g,c,i,this.initPTS,this.frameIndex);if(e&&e.missing===0)return e},S}(M.default);L.minProbeByteLength=9,C.default=L},"./src/demux/adts.ts":function(j,C,x){x.r(C),x.d(C,"getAudioConfig",function(){return b}),x.d(C,"isHeaderPattern",function(){return P}),x.d(C,"getHeaderLength",function(){return I}),x.d(C,"getFullFrameLength",function(){return L}),x.d(C,"canGetFrameLength",function(){return T}),x.d(C,"isHeader",function(){return S}),x.d(C,"canParse",function(){return p}),x.d(C,"probe",function(){return y}),x.d(C,"initTrackConfig",function(){return g}),x.d(C,"getFrameDuration",function(){return c}),x.d(C,"parseFrameHeader",function(){return i}),x.d(C,"appendFrame",function(){return e});var M=x("./src/utils/logger.ts"),O=x("./src/errors.ts"),A=x("./src/events.ts");function b(s,l,f,o){var t,n,E,h,d=navigator.userAgent.toLowerCase(),u=o,r=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];t=((l[f+2]&192)>>>6)+1;var a=(l[f+2]&60)>>>2;if(a>r.length-1){s.trigger(A.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+a});return}return E=(l[f+2]&1)<<2,E|=(l[f+3]&192)>>>6,M.logger.log("manifest codec:"+o+", ADTS type:"+t+", samplingIndex:"+a),/firefox/i.test(d)?a>=6?(t=5,h=new Array(4),n=a-3):(t=2,h=new Array(2),n=a):d.indexOf("android")!==-1?(t=2,h=new Array(2),n=a):(t=5,h=new Array(4),o&&(o.indexOf("mp4a.40.29")!==-1||o.indexOf("mp4a.40.5")!==-1)||!o&&a>=6?n=a-3:((o&&o.indexOf("mp4a.40.2")!==-1&&(a>=6&&E===1||/vivaldi/i.test(d))||!o&&E===1)&&(t=2,h=new Array(2)),n=a)),h[0]=t<<3,h[0]|=(a&14)>>1,h[1]|=(a&1)<<7,h[1]|=E<<3,t===5&&(h[1]|=(n&14)>>1,h[2]=(n&1)<<7,h[2]|=2<<2,h[3]=0),{config:h,samplerate:r[a],channelCount:E,codec:"mp4a.40."+t,manifestCodec:u}}function P(s,l){return s[l]===255&&(s[l+1]&246)===240}function I(s,l){return s[l+1]&1?7:9}function L(s,l){return(s[l+3]&3)<<11|s[l+4]<<3|(s[l+5]&224)>>>5}function T(s,l){return l+5<s.length}function S(s,l){return l+1<s.length&&P(s,l)}function p(s,l){return T(s,l)&&P(s,l)&&L(s,l)<=s.length-l}function y(s,l){if(S(s,l)){var f=I(s,l);if(l+f>=s.length)return!1;var o=L(s,l);if(o<=f)return!1;var t=l+o;return t===s.length||S(s,t)}return!1}function g(s,l,f,o,t){if(!s.samplerate){var n=b(l,f,o,t);if(!n)return;s.config=n.config,s.samplerate=n.samplerate,s.channelCount=n.channelCount,s.codec=n.codec,s.manifestCodec=n.manifestCodec,M.logger.log("parsed codec:"+s.codec+", rate:"+n.samplerate+", channels:"+n.channelCount)}}function c(s){return 1024*9e4/s}function i(s,l){var f=I(s,l);if(l+f<=s.length){var o=L(s,l)-f;if(o>0)return{headerLength:f,frameLength:o}}}function e(s,l,f,o,t){var n=c(s.samplerate),E=o+t*n,h=i(l,f),d;if(h){var u=h.frameLength,r=h.headerLength,a=r+u,v=Math.max(0,f+a-l.length);v?(d=new Uint8Array(a-r),d.set(l.subarray(f+r,l.length),0)):d=l.subarray(f+r,f+a);var m={unit:d,pts:E};return v||s.samples.push(m),{sample:m,length:a,missing:v}}var D=l.length-f;d=new Uint8Array(D),d.set(l.subarray(f,l.length),0);var R={unit:d,pts:E};return{sample:R,length:D,missing:-1}}},"./src/demux/base-audio-demuxer.ts":function(j,C,x){x.r(C),x.d(C,"initPTSFn",function(){return T});var M=x("./src/polyfills/number.ts"),O=x("./src/demux/id3.ts"),A=x("./src/types/demuxer.ts"),b=x("./src/demux/dummy-demuxed-track.ts"),P=x("./src/utils/mp4-tools.ts"),I=x("./src/utils/typed-array.ts"),L=function(){function S(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var p=S.prototype;return p.resetInitSegment=function(g,c,i,e){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},p.resetTimeStamp=function(){},p.resetContiguity=function(){},p.canParse=function(g,c){return!1},p.appendFrame=function(g,c,i){},p.demux=function(g,c){this.cachedData&&(g=Object(P.appendUint8Array)(this.cachedData,g),this.cachedData=null);var i=O.getID3Data(g,0),e=i?i.length:0,s,l,f=this._audioTrack,o=this._id3Track,t=i?O.getTimeStamp(i):void 0,n=g.length;for((this.frameIndex===0||this.initPTS===null)&&(this.initPTS=T(t,c)),i&&i.length>0&&o.samples.push({pts:this.initPTS,dts:this.initPTS,data:i,type:A.MetadataSchema.audioId3}),l=this.initPTS;e<n;){if(this.canParse(g,e)){var E=this.appendFrame(f,g,e);E?(this.frameIndex++,l=E.sample.pts,e+=E.length,s=e):e=n}else O.canParse(g,e)?(i=O.getID3Data(g,e),o.samples.push({pts:l,dts:l,data:i,type:A.MetadataSchema.audioId3}),e+=i.length,s=e):e++;if(e===n&&s!==n){var h=Object(I.sliceUint8)(g,s);this.cachedData?this.cachedData=Object(P.appendUint8Array)(this.cachedData,h):this.cachedData=h}}return{audioTrack:f,videoTrack:Object(b.dummyTrack)(),id3Track:o,textTrack:Object(b.dummyTrack)()}},p.demuxSampleAes=function(g,c,i){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},p.flush=function(g){var c=this.cachedData;return c&&(this.cachedData=null,this.demux(c,0)),this.frameIndex=0,{audioTrack:this._audioTrack,videoTrack:Object(b.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(b.dummyTrack)()}},p.destroy=function(){},S}(),T=function(p,y){return Object(M.isFiniteNumber)(p)?p*90:y*9e4};C.default=L},"./src/demux/chunk-cache.ts":function(j,C,x){x.r(C),x.d(C,"default",function(){return M});var M=function(){function A(){this.chunks=[],this.dataLength=0}var b=A.prototype;return b.push=function(I){this.chunks.push(I),this.dataLength+=I.length},b.flush=function(){var I=this.chunks,L=this.dataLength,T;if(I.length)I.length===1?T=I[0]:T=O(I,L);else return new Uint8Array(0);return this.reset(),T},b.reset=function(){this.chunks.length=0,this.dataLength=0},A}();function O(A,b){for(var P=new Uint8Array(b),I=0,L=0;L<A.length;L++){var T=A[L];P.set(T,I),I+=T.length}return P}},"./src/demux/dummy-demuxed-track.ts":function(j,C,x){x.r(C),x.d(C,"dummyTrack",function(){return M});function M(O,A){return O===void 0&&(O=""),A===void 0&&(A=9e4),{type:O,id:-1,pid:-1,inputTimeScale:A,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":function(j,C,x){x.r(C);var M=x("./src/utils/logger.ts"),O=function(){function A(P){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=P,this.bytesAvailable=P.byteLength,this.word=0,this.bitsAvailable=0}var b=A.prototype;return b.loadWord=function(){var I=this.data,L=this.bytesAvailable,T=I.byteLength-L,S=new Uint8Array(4),p=Math.min(4,L);if(p===0)throw new Error("no bytes available");S.set(I.subarray(T,T+p)),this.word=new DataView(S.buffer).getUint32(0),this.bitsAvailable=p*8,this.bytesAvailable-=p},b.skipBits=function(I){var L;this.bitsAvailable>I?(this.word<<=I,this.bitsAvailable-=I):(I-=this.bitsAvailable,L=I>>3,I-=L>>3,this.bytesAvailable-=L,this.loadWord(),this.word<<=I,this.bitsAvailable-=I)},b.readBits=function(I){var L=Math.min(this.bitsAvailable,I),T=this.word>>>32-L;return I>32&&M.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=L,this.bitsAvailable>0?this.word<<=L:this.bytesAvailable>0&&this.loadWord(),L=I-L,L>0&&this.bitsAvailable?T<<L|this.readBits(L):T},b.skipLZ=function(){var I;for(I=0;I<this.bitsAvailable;++I)if((this.word&2147483648>>>I)!==0)return this.word<<=I,this.bitsAvailable-=I,I;return this.loadWord(),I+this.skipLZ()},b.skipUEG=function(){this.skipBits(1+this.skipLZ())},b.skipEG=function(){this.skipBits(1+this.skipLZ())},b.readUEG=function(){var I=this.skipLZ();return this.readBits(I+1)-1},b.readEG=function(){var I=this.readUEG();return 1&I?1+I>>>1:-1*(I>>>1)},b.readBoolean=function(){return this.readBits(1)===1},b.readUByte=function(){return this.readBits(8)},b.readUShort=function(){return this.readBits(16)},b.readUInt=function(){return this.readBits(32)},b.skipScalingList=function(I){for(var L=8,T=8,S,p=0;p<I;p++)T!==0&&(S=this.readEG(),T=(L+S+256)%256),L=T===0?L:T},b.readSPS=function(){var I=0,L=0,T=0,S=0,p,y,g,c=this.readUByte.bind(this),i=this.readBits.bind(this),e=this.readUEG.bind(this),s=this.readBoolean.bind(this),l=this.skipBits.bind(this),f=this.skipEG.bind(this),o=this.skipUEG.bind(this),t=this.skipScalingList.bind(this);c();var n=c();if(i(5),l(3),c(),o(),n===100||n===110||n===122||n===244||n===44||n===83||n===86||n===118||n===128){var E=e();if(E===3&&l(1),o(),o(),l(1),s())for(y=E!==3?8:12,g=0;g<y;g++)s()&&(g<6?t(16):t(64))}o();var h=e();if(h===0)e();else if(h===1)for(l(1),f(),f(),p=e(),g=0;g<p;g++)f();o(),l(1);var d=e(),u=e(),r=i(1);r===0&&l(1),l(1),s()&&(I=e(),L=e(),T=e(),S=e());var a=[1,1];if(s()&&s()){var v=c();switch(v){case 1:a=[1,1];break;case 2:a=[12,11];break;case 3:a=[10,11];break;case 4:a=[16,11];break;case 5:a=[40,33];break;case 6:a=[24,11];break;case 7:a=[20,11];break;case 8:a=[32,11];break;case 9:a=[80,33];break;case 10:a=[18,11];break;case 11:a=[15,11];break;case 12:a=[64,33];break;case 13:a=[160,99];break;case 14:a=[4,3];break;case 15:a=[3,2];break;case 16:a=[2,1];break;case 255:{a=[c()<<8|c(),c()<<8|c()];break}}}return{width:Math.ceil((d+1)*16-I*2-L*2),height:(2-r)*(u+1)*16-(r?2:4)*(T+S),pixelRatio:a}},b.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},A}();C.default=O},"./src/demux/id3.ts":function(j,C,x){x.r(C),x.d(C,"isHeader",function(){return M}),x.d(C,"isFooter",function(){return O}),x.d(C,"getID3Data",function(){return A}),x.d(C,"canParse",function(){return P}),x.d(C,"getTimeStamp",function(){return I}),x.d(C,"isTimeStampFrame",function(){return L}),x.d(C,"getID3Frames",function(){return S}),x.d(C,"decodeFrame",function(){return p}),x.d(C,"utf8ArrayToStr",function(){return e}),x.d(C,"testables",function(){return s});var M=function(t,n){return n+10<=t.length&&t[n]===73&&t[n+1]===68&&t[n+2]===51&&t[n+3]<255&&t[n+4]<255&&t[n+6]<128&&t[n+7]<128&&t[n+8]<128&&t[n+9]<128},O=function(t,n){return n+10<=t.length&&t[n]===51&&t[n+1]===68&&t[n+2]===73&&t[n+3]<255&&t[n+4]<255&&t[n+6]<128&&t[n+7]<128&&t[n+8]<128&&t[n+9]<128},A=function(t,n){for(var E=n,h=0;M(t,n);){h+=10;var d=b(t,n+6);h+=d,O(t,n+10)&&(h+=10),n+=h}if(h>0)return t.subarray(E,E+h)},b=function(t,n){var E=0;return E=(t[n]&127)<<21,E|=(t[n+1]&127)<<14,E|=(t[n+2]&127)<<7,E|=t[n+3]&127,E},P=function(t,n){return M(t,n)&&b(t,n+6)+10<=t.length-n},I=function(t){for(var n=S(t),E=0;E<n.length;E++){var h=n[E];if(L(h))return i(h)}},L=function(t){return t&&t.key==="PRIV"&&t.info==="com.apple.streaming.transportStreamTimestamp"},T=function(t){var n=String.fromCharCode(t[0],t[1],t[2],t[3]),E=b(t,4),h=10;return{type:n,size:E,data:t.subarray(h,h+E)}},S=function(t){for(var n=0,E=[];M(t,n);){var h=b(t,n+6);n+=10;for(var d=n+h;n+8<d;){var u=T(t.subarray(n)),r=p(u);r&&E.push(r),n+=u.size+10}O(t,n)&&(n+=10)}return E},p=function(t){return t.type==="PRIV"?y(t):t.type[0]==="W"?c(t):g(t)},y=function(t){if(!(t.size<2)){var n=e(t.data,!0),E=new Uint8Array(t.data.subarray(n.length+1));return{key:t.type,info:n,data:E.buffer}}},g=function(t){if(!(t.size<2)){if(t.type==="TXXX"){var n=1,E=e(t.data.subarray(n),!0);n+=E.length+1;var h=e(t.data.subarray(n));return{key:t.type,info:E,data:h}}var d=e(t.data.subarray(1));return{key:t.type,data:d}}},c=function(t){if(t.type==="WXXX"){if(t.size<2)return;var n=1,E=e(t.data.subarray(n),!0);n+=E.length+1;var h=e(t.data.subarray(n));return{key:t.type,info:E,data:h}}var d=e(t.data);return{key:t.type,data:d}},i=function(t){if(t.data.byteLength===8){var n=new Uint8Array(t.data),E=n[3]&1,h=(n[4]<<23)+(n[5]<<15)+(n[6]<<7)+n[7];return h/=45,E&&(h+=4772185884e-2),Math.round(h)}},e=function(t,n){n===void 0&&(n=!1);var E=f();if(E){var h=E.decode(t);if(n){var d=h.indexOf("\0");return d!==-1?h.substring(0,d):h}return h.replace(/\0/g,"")}for(var u=t.length,r,a,v,m="",D=0;D<u;){if(r=t[D++],r===0&&n)return m;if(r===0||r===3)continue;switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:m+=String.fromCharCode(r);break;case 12:case 13:a=t[D++],m+=String.fromCharCode((r&31)<<6|a&63);break;case 14:a=t[D++],v=t[D++],m+=String.fromCharCode((r&15)<<12|(a&63)<<6|(v&63)<<0);break}}return m},s={decodeTextFrame:g},l;function f(){return!l&&typeof self.TextDecoder!="undefined"&&(l=new self.TextDecoder("utf-8")),l}},"./src/demux/mp3demuxer.ts":function(j,C,x){x.r(C);var M=x("./src/demux/base-audio-demuxer.ts"),O=x("./src/demux/id3.ts"),A=x("./src/utils/logger.ts"),b=x("./src/demux/mpegaudio.ts");function P(T,S){T.prototype=Object.create(S.prototype),T.prototype.constructor=T,I(T,S)}function I(T,S){return I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(y,g){return y.__proto__=g,y},I(T,S)}var L=function(T){P(S,T);function S(){return T.apply(this,arguments)||this}var p=S.prototype;return p.resetInitSegment=function(g,c,i,e){T.prototype.resetInitSegment.call(this,g,c,i,e),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:c,duration:e,inputTimeScale:9e4,dropped:0}},S.probe=function(g){if(!g)return!1;for(var c=O.getID3Data(g,0)||[],i=c.length,e=g.length;i<e;i++)if(b.probe(g,i))return A.logger.log("MPEG Audio sync word found !"),!0;return!1},p.canParse=function(g,c){return b.canParse(g,c)},p.appendFrame=function(g,c,i){if(this.initPTS!==null)return b.appendFrame(g,c,i,this.initPTS,this.frameIndex)},S}(M.default);L.minProbeByteLength=4,C.default=L},"./src/demux/mp4demuxer.ts":function(j,C,x){x.r(C);var M=x("./src/polyfills/number.ts"),O=x("./src/types/demuxer.ts"),A=x("./src/utils/mp4-tools.ts"),b=x("./src/demux/dummy-demuxed-track.ts"),P=/\/emsg[-/]ID3/i,I=function(){function L(S,p){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=p}var T=L.prototype;return T.resetTimeStamp=function(){},T.resetInitSegment=function(p,y,g,c){var i=Object(A.parseInitSegment)(p),e=this.videoTrack=Object(b.dummyTrack)("video",1),s=this.audioTrack=Object(b.dummyTrack)("audio",1),l=this.txtTrack=Object(b.dummyTrack)("text",1);if(this.id3Track=Object(b.dummyTrack)("id3",1),this.timeOffset=0,i.video){var f=i.video,o=f.id,t=f.timescale,n=f.codec;e.id=o,e.timescale=l.timescale=t,e.codec=n}if(i.audio){var E=i.audio,h=E.id,d=E.timescale,u=E.codec;s.id=h,s.timescale=d,s.codec=u}l.id=A.RemuxerTrackIdConfig.text,e.sampleDuration=0,e.duration=s.duration=c},T.resetContiguity=function(){},L.probe=function(p){return p=p.length>16384?p.subarray(0,16384):p,Object(A.findBox)(p,["moof"]).length>0},T.demux=function(p,y){this.timeOffset=y;var g=p,c=this.videoTrack,i=this.txtTrack;if(this.config.progressive){this.remainderData&&(g=Object(A.appendUint8Array)(this.remainderData,p));var e=Object(A.segmentValidRange)(g);this.remainderData=e.remainder,c.samples=e.valid||new Uint8Array}else c.samples=g;var s=this.extractID3Track(c,y);return i.samples=Object(A.parseSamples)(y,c),{videoTrack:c,audioTrack:this.audioTrack,id3Track:s,textTrack:this.txtTrack}},T.flush=function(){var p=this.timeOffset,y=this.videoTrack,g=this.txtTrack;y.samples=this.remainderData||new Uint8Array,this.remainderData=null;var c=this.extractID3Track(y,this.timeOffset);return g.samples=Object(A.parseSamples)(p,y),{videoTrack:y,audioTrack:Object(b.dummyTrack)(),id3Track:c,textTrack:Object(b.dummyTrack)()}},T.extractID3Track=function(p,y){var g=this.id3Track;if(p.samples.length){var c=Object(A.findBox)(p.samples,["emsg"]);c&&c.forEach(function(i){var e=Object(A.parseEmsg)(i);if(P.test(e.schemeIdUri)){var s=Object(M.isFiniteNumber)(e.presentationTime)?e.presentationTime/e.timeScale:y+e.presentationTimeDelta/e.timeScale,l=e.payload;g.samples.push({data:l,len:l.byteLength,dts:s,pts:s,type:O.MetadataSchema.emsg})}})}return g},T.demuxSampleAes=function(p,y,g){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},T.destroy=function(){},L}();I.minProbeByteLength=1024,C.default=I},"./src/demux/mpegaudio.ts":function(j,C,x){x.r(C),x.d(C,"appendFrame",function(){return I}),x.d(C,"parseHeader",function(){return L}),x.d(C,"isHeaderPattern",function(){return T}),x.d(C,"isHeader",function(){return S}),x.d(C,"canParse",function(){return p}),x.d(C,"probe",function(){return y});var M=null,O=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],A=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],b=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],P=[0,1,1,4];function I(g,c,i,e,s){if(!(i+24>c.length)){var l=L(c,i);if(l&&i+l.frameLength<=c.length){var f=l.samplesPerFrame*9e4/l.sampleRate,o=e+s*f,t={unit:c.subarray(i,i+l.frameLength),pts:o,dts:o};return g.config=[],g.channelCount=l.channelCount,g.samplerate=l.sampleRate,g.samples.push(t),{sample:t,length:l.frameLength,missing:0}}}}function L(g,c){var i=g[c+1]>>3&3,e=g[c+1]>>1&3,s=g[c+2]>>4&15,l=g[c+2]>>2&3;if(i!==1&&s!==0&&s!==15&&l!==3){var f=g[c+2]>>1&1,o=g[c+3]>>6,t=i===3?3-e:e===3?3:4,n=O[t*14+s-1]*1e3,E=i===3?0:i===2?1:2,h=A[E*3+l],d=o===3?1:2,u=b[i][e],r=P[e],a=u*8*r,v=Math.floor(u*n/h+f)*r;if(M===null){var m=navigator.userAgent||"",D=m.match(/Chrome\/(\d+)/i);M=D?parseInt(D[1]):0}var R=!!M&&M<=87;return R&&e===2&&n>=224e3&&o===0&&(g[c+3]=g[c+3]|128),{sampleRate:h,channelCount:d,frameLength:v,samplesPerFrame:a}}}function T(g,c){return g[c]===255&&(g[c+1]&224)===224&&(g[c+1]&6)!==0}function S(g,c){return c+1<g.length&&T(g,c)}function p(g,c){var i=4;return T(g,c)&&i<=g.length-c}function y(g,c){if(c+1<g.length&&T(g,c)){var i=4,e=L(g,c),s=i;e!=null&&e.frameLength&&(s=e.frameLength);var l=c+s;return l===g.length||S(g,l)}return!1}},"./src/demux/sample-aes.ts":function(j,C,x){x.r(C);var M=x("./src/crypt/decrypter.ts"),O=x("./src/demux/tsdemuxer.ts"),A=function(){function b(I,L,T){this.keyData=void 0,this.decrypter=void 0,this.keyData=T,this.decrypter=new M.default(I,L,{removePKCS7Padding:!1})}var P=b.prototype;return P.decryptBuffer=function(L,T){this.decrypter.decrypt(L,this.keyData.key.buffer,this.keyData.iv.buffer,T)},P.decryptAacSample=function(L,T,S,p){var y=L[T].unit;if(!(y.length<=16)){var g=y.subarray(16,y.length-y.length%16),c=g.buffer.slice(g.byteOffset,g.byteOffset+g.length),i=this;this.decryptBuffer(c,function(e){var s=new Uint8Array(e);y.set(s,16),p||i.decryptAacSamples(L,T+1,S)})}},P.decryptAacSamples=function(L,T,S){for(;;T++){if(T>=L.length){S();return}if(!(L[T].unit.length<32)){var p=this.decrypter.isSync();if(this.decryptAacSample(L,T,S,p),!p)return}}},P.getAvcEncryptedData=function(L){for(var T=Math.floor((L.length-48)/160)*16+16,S=new Int8Array(T),p=0,y=32;y<L.length-16;y+=160,p+=16)S.set(L.subarray(y,y+16),p);return S},P.getAvcDecryptedUnit=function(L,T){for(var S=new Uint8Array(T),p=0,y=32;y<L.length-16;y+=160,p+=16)L.set(S.subarray(p,p+16),y);return L},P.decryptAvcSample=function(L,T,S,p,y,g){var c=Object(O.discardEPB)(y.data),i=this.getAvcEncryptedData(c),e=this;this.decryptBuffer(i.buffer,function(s){y.data=e.getAvcDecryptedUnit(c,s),g||e.decryptAvcSamples(L,T,S+1,p)})},P.decryptAvcSamples=function(L,T,S,p){if(L instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;T++,S=0){if(T>=L.length){p();return}for(var y=L[T].units;!(S>=y.length);S++){var g=y[S];if(!(g.data.length<=48||g.type!==1&&g.type!==5)){var c=this.decrypter.isSync();if(this.decryptAvcSample(L,T,S,p,g,c),!c)return}}}},b}();C.default=A},"./src/demux/transmuxer-interface.ts":function(j,C,x){x.r(C),x.d(C,"default",function(){return S});var M=x("./node_modules/webworkify-webpack/index.js"),O=x("./src/events.ts"),A=x("./src/demux/transmuxer.ts"),b=x("./src/utils/logger.ts"),P=x("./src/errors.ts"),I=x("./src/utils/mediasource-helper.ts"),L=x("./node_modules/eventemitter3/index.js"),T=Object(I.getMediaSource)()||{isTypeSupported:function(){return!1}},S=function(){function p(g,c,i,e){var s=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=g,this.id=c,this.onTransmuxComplete=i,this.onFlush=e;var l=g.config,f=function(h,d){d=d||{},d.frag=s.frag,d.id=s.id,g.trigger(h,d)};this.observer=new L.EventEmitter,this.observer.on(O.Events.FRAG_DECRYPTED,f),this.observer.on(O.Events.ERROR,f);var o={mp4:T.isTypeSupported("video/mp4"),mpeg:T.isTypeSupported("audio/mpeg"),mp3:T.isTypeSupported('audio/mp4; codecs="mp3"')},t=navigator.vendor;if(l.enableWorker&&typeof Worker!="undefined"){b.logger.log("demuxing in webworker");var n;try{n=this.worker=M("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),n.addEventListener("message",this.onwmsg),n.onerror=function(E){g.trigger(O.Events.ERROR,{type:P.ErrorTypes.OTHER_ERROR,details:P.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(E.message+"  ("+E.filename+":"+E.lineno+")")})},n.postMessage({cmd:"init",typeSupported:o,vendor:t,id:c,config:JSON.stringify(l)})}catch(E){b.logger.warn("Error in worker:",E),b.logger.error("Error while initializing DemuxerWorker, fallback to inline"),n&&self.URL.revokeObjectURL(n.objectURL),this.transmuxer=new A.default(this.observer,o,l,t,c),this.worker=null}}else this.transmuxer=new A.default(this.observer,o,l,t,c)}var y=p.prototype;return y.destroy=function(){var c=this.worker;if(c)c.removeEventListener("message",this.onwmsg),c.terminate(),this.worker=null,this.onwmsg=void 0;else{var i=this.transmuxer;i&&(i.destroy(),this.transmuxer=null)}var e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},y.push=function(c,i,e,s,l,f,o,t,n,E){var h,d,u=this;n.transmuxing.start=self.performance.now();var r=this.transmuxer,a=this.worker,v=f?f.start:l.start,m=l.decryptdata,D=this.frag,R=!(D&&l.cc===D.cc),F=!(D&&n.level===D.level),_=D?n.sn-D.sn:-1,B=this.part?n.part-this.part.index:-1,U=!F&&(_===1||_===0&&B===1),N=self.performance.now();(F||_||l.stats.parsing.start===0)&&(l.stats.parsing.start=N),f&&(B||!U)&&(f.stats.parsing.start=N);var k=!(D&&((h=l.initSegment)===null||h===void 0?void 0:h.url)===((d=D.initSegment)===null||d===void 0?void 0:d.url)),w=new A.TransmuxState(R,U,t,F,v,k);if(!U||R||k){b.logger.log("[transmuxer-interface, "+l.type+"]: Starting new transmux session for sn: "+n.sn+" p: "+n.part+" level: "+n.level+" id: "+n.id+`
        discontinuity: `+R+`
        trackSwitch: `+F+`
        contiguous: `+U+`
        accurateTimeOffset: `+t+`
        timeOffset: `+v+`
        initSegmentChange: `+k);var K=new A.TransmuxConfig(e,s,i,o,E);this.configureTransmuxer(K)}if(this.frag=l,this.part=f,a)a.postMessage({cmd:"demux",data:c,decryptdata:m,chunkMeta:n,state:w},c instanceof ArrayBuffer?[c]:[]);else if(r){var W=r.push(c,m,n,w);Object(A.isPromise)(W)?W.then(function(H){u.handleTransmuxComplete(H)}):this.handleTransmuxComplete(W)}},y.flush=function(c){var i=this;c.transmuxing.start=self.performance.now();var e=this.transmuxer,s=this.worker;if(s)s.postMessage({cmd:"flush",chunkMeta:c});else if(e){var l=e.flush(c);Object(A.isPromise)(l)?l.then(function(f){i.handleFlushResult(f,c)}):this.handleFlushResult(l,c)}},y.handleFlushResult=function(c,i){var e=this;c.forEach(function(s){e.handleTransmuxComplete(s)}),this.onFlush(i)},y.onWorkerMessage=function(c){var i=c.data,e=this.hls;switch(i.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(i.data);break}case"flush":{this.onFlush(i.data);break}default:{i.data=i.data||{},i.data.frag=this.frag,i.data.id=this.id,e.trigger(i.event,i.data);break}}},y.configureTransmuxer=function(c){var i=this.worker,e=this.transmuxer;i?i.postMessage({cmd:"configure",config:c}):e&&e.configure(c)},y.handleTransmuxComplete=function(c){c.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(c)},p}()},"./src/demux/transmuxer-worker.ts":function(j,C,x){x.r(C),x.d(C,"default",function(){return P});var M=x("./src/demux/transmuxer.ts"),O=x("./src/events.ts"),A=x("./src/utils/logger.ts"),b=x("./node_modules/eventemitter3/index.js");function P(p){var y=new b.EventEmitter,g=function(i,e){p.postMessage({event:i,data:e})};y.on(O.Events.FRAG_DECRYPTED,g),y.on(O.Events.ERROR,g),p.addEventListener("message",function(c){var i=c.data;switch(i.cmd){case"init":{var e=JSON.parse(i.config);p.transmuxer=new M.default(y,i.typeSupported,e,i.vendor,i.id),Object(A.enableLogs)(e.debug),g("init",null);break}case"configure":{p.transmuxer.configure(i.config);break}case"demux":{var s=p.transmuxer.push(i.data,i.decryptdata,i.chunkMeta,i.state);Object(M.isPromise)(s)?s.then(function(o){I(p,o)}):I(p,s);break}case"flush":{var l=i.chunkMeta,f=p.transmuxer.flush(l);Object(M.isPromise)(f)?f.then(function(o){T(p,o,l)}):T(p,f,l);break}}})}function I(p,y){if(S(y.remuxResult))return!1;var g=[],c=y.remuxResult,i=c.audio,e=c.video;return i&&L(g,i),e&&L(g,e),p.postMessage({event:"transmuxComplete",data:y},g),!0}function L(p,y){y.data1&&p.push(y.data1.buffer),y.data2&&p.push(y.data2.buffer)}function T(p,y,g){var c=y.reduce(function(i,e){return I(p,e)||i},!1);c||p.postMessage({event:"transmuxComplete",data:y[0]}),p.postMessage({event:"flush",data:g})}function S(p){return!p.audio&&!p.video&&!p.text&&!p.id3&&!p.initSegment}},"./src/demux/transmuxer.ts":function(j,C,x){x.r(C),x.d(C,"default",function(){return s}),x.d(C,"isPromise",function(){return o}),x.d(C,"TransmuxConfig",function(){return t}),x.d(C,"TransmuxState",function(){return n});var M=x("./src/events.ts"),O=x("./src/errors.ts"),A=x("./src/crypt/decrypter.ts"),b=x("./src/demux/aacdemuxer.ts"),P=x("./src/demux/mp4demuxer.ts"),I=x("./src/demux/tsdemuxer.ts"),L=x("./src/demux/mp3demuxer.ts"),T=x("./src/remux/mp4-remuxer.ts"),S=x("./src/remux/passthrough-remuxer.ts"),p=x("./src/demux/chunk-cache.ts"),y=x("./src/utils/mp4-tools.ts"),g=x("./src/utils/logger.ts"),c;try{c=self.performance.now.bind(self.performance)}catch{g.logger.debug("Unable to use Performance API on this environment"),c=self.Date.now}var i=[{demux:I.default,remux:T.default},{demux:P.default,remux:S.default},{demux:b.default,remux:T.default},{demux:L.default,remux:T.default}],e=1024;i.forEach(function(E){var h=E.demux;e=Math.max(e,h.minProbeByteLength)});var s=function(){function E(d,u,r,a,v){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new p.default,this.observer=d,this.typeSupported=u,this.config=r,this.vendor=a,this.id=v}var h=E.prototype;return h.configure=function(u){this.transmuxConfig=u,this.decrypter&&this.decrypter.reset()},h.push=function(u,r,a,v){var m=this,D=a.transmuxing;D.executeStart=c();var R=new Uint8Array(u),F=this.cache,_=this.config,B=this.currentTransmuxState,U=this.transmuxConfig;v&&(this.currentTransmuxState=v);var N=l(R,r);if(N&&N.method==="AES-128"){var k=this.getDecrypter();if(_.enableSoftwareAES){var w=k.softwareDecrypt(R,N.key.buffer,N.iv.buffer);if(!w)return D.executeEnd=c(),f(a);R=new Uint8Array(w)}else return this.decryptionPromise=k.webCryptoDecrypt(R,N.key.buffer,N.iv.buffer).then(function(te){var se=m.push(te,null,a);return m.decryptionPromise=null,se}),this.decryptionPromise}var K=v||B,W=K.contiguous,H=K.discontinuity,G=K.trackSwitch,Y=K.accurateTimeOffset,Q=K.timeOffset,z=K.initSegmentChange,V=U.audioCodec,X=U.videoCodec,J=U.defaultInitPts,$=U.duration,Z=U.initSegmentData;if((H||G||z)&&this.resetInitSegment(Z,V,X,$),(H||z)&&this.resetInitialTimestamp(J),W||this.resetContiguity(),this.needsProbing(R,H,G)){if(F.dataLength){var q=F.flush();R=Object(y.appendUint8Array)(q,R)}this.configureTransmuxer(R,U)}var ee=this.transmux(R,N,Q,Y,a),re=this.currentTransmuxState;return re.contiguous=!0,re.discontinuity=!1,re.trackSwitch=!1,D.executeEnd=c(),ee},h.flush=function(u){var r=this,a=u.transmuxing;a.executeStart=c();var v=this.decrypter,m=this.cache,D=this.currentTransmuxState,R=this.decryptionPromise;if(R)return R.then(function(){return r.flush(u)});var F=[],_=D.timeOffset;if(v){var B=v.flush();B&&F.push(this.push(B,null,u))}var U=m.dataLength;m.reset();var N=this.demuxer,k=this.remuxer;if(!N||!k)return U>=e&&this.observer.emit(M.Events.ERROR,M.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),a.executeEnd=c(),[f(u)];var w=N.flush(_);return o(w)?w.then(function(K){return r.flushRemux(F,K,u),F}):(this.flushRemux(F,w,u),F)},h.flushRemux=function(u,r,a){var v=r.audioTrack,m=r.videoTrack,D=r.id3Track,R=r.textTrack,F=this.currentTransmuxState,_=F.accurateTimeOffset,B=F.timeOffset;g.logger.log("[transmuxer.ts]: Flushed fragment "+a.sn+(a.part>-1?" p: "+a.part:"")+" of level "+a.level);var U=this.remuxer.remux(v,m,D,R,B,_,!0,this.id);u.push({remuxResult:U,chunkMeta:a}),a.transmuxing.executeEnd=c()},h.resetInitialTimestamp=function(u){var r=this.demuxer,a=this.remuxer;!r||!a||(r.resetTimeStamp(u),a.resetTimeStamp(u))},h.resetContiguity=function(){var u=this.demuxer,r=this.remuxer;!u||!r||(u.resetContiguity(),r.resetNextTimestamp())},h.resetInitSegment=function(u,r,a,v){var m=this.demuxer,D=this.remuxer;!m||!D||(m.resetInitSegment(u,r,a,v),D.resetInitSegment(u,r,a))},h.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},h.transmux=function(u,r,a,v,m){var D;return r&&r.method==="SAMPLE-AES"?D=this.transmuxSampleAes(u,r,a,v,m):D=this.transmuxUnencrypted(u,a,v,m),D},h.transmuxUnencrypted=function(u,r,a,v){var m=this.demuxer.demux(u,r,!1,!this.config.progressive),D=m.audioTrack,R=m.videoTrack,F=m.id3Track,_=m.textTrack,B=this.remuxer.remux(D,R,F,_,r,a,!1,this.id);return{remuxResult:B,chunkMeta:v}},h.transmuxSampleAes=function(u,r,a,v,m){var D=this;return this.demuxer.demuxSampleAes(u,r,a).then(function(R){var F=D.remuxer.remux(R.audioTrack,R.videoTrack,R.id3Track,R.textTrack,a,v,!1,D.id);return{remuxResult:F,chunkMeta:m}})},h.configureTransmuxer=function(u,r){for(var a=this.config,v=this.observer,m=this.typeSupported,D=this.vendor,R=r.audioCodec,F=r.defaultInitPts,_=r.duration,B=r.initSegmentData,U=r.videoCodec,N,k=0,w=i.length;k<w;k++)if(i[k].demux.probe(u)){N=i[k];break}N||(g.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),N={demux:P.default,remux:S.default});var K=this.demuxer,W=this.remuxer,H=N.remux,G=N.demux;(!W||!(W instanceof H))&&(this.remuxer=new H(v,a,m,D)),(!K||!(K instanceof G))&&(this.demuxer=new G(v,a,m),this.probe=G.probe),this.resetInitSegment(B,R,U,_),this.resetInitialTimestamp(F)},h.needsProbing=function(u,r,a){return!this.demuxer||!this.remuxer||r||a},h.getDecrypter=function(){var u=this.decrypter;return u||(u=this.decrypter=new A.default(this.observer,this.config)),u},E}();function l(E,h){var d=null;return E.byteLength>0&&h!=null&&h.key!=null&&h.iv!==null&&h.method!=null&&(d=h),d}var f=function(h){return{remuxResult:{},chunkMeta:h}};function o(E){return"then"in E&&E.then instanceof Function}var t=function(h,d,u,r,a){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=h,this.videoCodec=d,this.initSegmentData=u,this.duration=r,this.defaultInitPts=a},n=function(h,d,u,r,a,v){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=h,this.contiguous=d,this.accurateTimeOffset=u,this.trackSwitch=r,this.timeOffset=a,this.initSegmentChange=v}},"./src/demux/tsdemuxer.ts":function(j,C,x){x.r(C),x.d(C,"discardEPB",function(){return l});var M=x("./src/demux/adts.ts"),O=x("./src/demux/mpegaudio.ts"),A=x("./src/demux/exp-golomb.ts"),b=x("./src/demux/sample-aes.ts"),P=x("./src/events.ts"),I=x("./src/utils/mp4-tools.ts"),L=x("./src/utils/logger.ts"),T=x("./src/errors.ts"),S=x("./src/types/demuxer.ts");function p(){return p=Object.assign?Object.assign.bind():function(f){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(f[n]=t[n])}return f},p.apply(this,arguments)}var y=function(){function f(t,n,E){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=t,this.config=n,this.typeSupported=E}f.probe=function(n){var E=f.syncOffset(n);return E<0?!1:(E&&L.logger.warn("MPEG2-TS detected but first sync word found @ offset "+E+", junk ahead ?"),!0)},f.syncOffset=function(n){for(var E=Math.min(1e3,n.length-564),h=0;h<E;){if(n[h]===71&&n[h+188]===71&&n[h+2*188]===71)return h;h++}return-1},f.createTrack=function(n,E){return{container:n==="video"||n==="audio"?"video/mp2t":void 0,type:n,id:I.RemuxerTrackIdConfig[n],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:n==="audio"?E:void 0}};var o=f.prototype;return o.resetInitSegment=function(n,E,h,d){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=f.createTrack("video"),this._audioTrack=f.createTrack("audio",d),this._id3Track=f.createTrack("id3"),this._txtTrack=f.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.audioCodec=E,this.videoCodec=h,this._duration=d},o.resetTimeStamp=function(){},o.resetContiguity=function(){var n=this._audioTrack,E=this._avcTrack,h=this._id3Track;n&&(n.pesData=null),E&&(E.pesData=null),h&&(h.pesData=null),this.aacOverFlow=null},o.demux=function(n,E,h,d){h===void 0&&(h=!1),d===void 0&&(d=!1),h||(this.sampleAes=null);var u,r=this._avcTrack,a=this._audioTrack,v=this._id3Track,m=this._txtTrack,D=r.pid,R=r.pesData,F=a.pid,_=v.pid,B=a.pesData,U=v.pesData,N=!1,k=this.pmtParsed,w=this._pmtId,K=n.length;if(this.remainderData&&(n=Object(I.appendUint8Array)(this.remainderData,n),K=n.length,this.remainderData=null),K<188&&!d)return this.remainderData=n,{audioTrack:a,videoTrack:r,id3Track:v,textTrack:m};var W=Math.max(0,f.syncOffset(n));K-=(K+W)%188,K<n.byteLength&&!d&&(this.remainderData=new Uint8Array(n.buffer,K,n.buffer.byteLength-K));for(var H=0,G=W;G<K;G+=188)if(n[G]===71){var Y=!!(n[G+1]&64),Q=((n[G+1]&31)<<8)+n[G+2],z=(n[G+3]&48)>>4,V=void 0;if(z>1){if(V=G+5+n[G+4],V===G+188)continue}else V=G+4;switch(Q){case D:Y&&(R&&(u=e(R))&&this.parseAVCPES(r,m,u,!1),R={data:[],size:0}),R&&(R.data.push(n.subarray(V,G+188)),R.size+=G+188-V);break;case F:if(Y){if(B&&(u=e(B)))switch(a.segmentCodec){case"aac":this.parseAACPES(a,u);break;case"mp3":this.parseMPEGPES(a,u);break}B={data:[],size:0}}B&&(B.data.push(n.subarray(V,G+188)),B.size+=G+188-V);break;case _:Y&&(U&&(u=e(U))&&this.parseID3PES(v,u),U={data:[],size:0}),U&&(U.data.push(n.subarray(V,G+188)),U.size+=G+188-V);break;case 0:Y&&(V+=n[V]+1),w=this._pmtId=c(n,V);break;case w:{Y&&(V+=n[V]+1);var X=i(n,V,this.typeSupported,h);D=X.avc,D>0&&(r.pid=D),F=X.audio,F>0&&(a.pid=F,a.segmentCodec=X.segmentCodec),_=X.id3,_>0&&(v.pid=_),N&&!k&&(L.logger.log("reparse from beginning"),N=!1,G=W-188),k=this.pmtParsed=!0;break}case 17:case 8191:break;default:N=!0;break}}else H++;H>0&&this.observer.emit(P.Events.ERROR,P.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+H+" TS packet/s that do not start with 0x47"}),r.pesData=R,a.pesData=B,v.pesData=U;var J={audioTrack:a,videoTrack:r,id3Track:v,textTrack:m};return d&&this.extractRemainingSamples(J),J},o.flush=function(){var n=this.remainderData;this.remainderData=null;var E;return n?E=this.demux(n,-1,!1,!0):E={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(E),this.sampleAes?this.decrypt(E,this.sampleAes):E},o.extractRemainingSamples=function(n){var E=n.audioTrack,h=n.videoTrack,d=n.id3Track,u=n.textTrack,r=h.pesData,a=E.pesData,v=d.pesData,m;if(r&&(m=e(r))?(this.parseAVCPES(h,u,m,!0),h.pesData=null):h.pesData=r,a&&(m=e(a))){switch(E.segmentCodec){case"aac":this.parseAACPES(E,m);break;case"mp3":this.parseMPEGPES(E,m);break}E.pesData=null}else a!=null&&a.size&&L.logger.log("last AAC PES packet truncated,might overlap between fragments"),E.pesData=a;v&&(m=e(v))?(this.parseID3PES(d,m),d.pesData=null):d.pesData=v},o.demuxSampleAes=function(n,E,h){var d=this.demux(n,h,!0,!this.config.progressive),u=this.sampleAes=new b.default(this.observer,this.config,E);return this.decrypt(d,u)},o.decrypt=function(n,E){return new Promise(function(h){var d=n.audioTrack,u=n.videoTrack;d.samples&&d.segmentCodec==="aac"?E.decryptAacSamples(d.samples,0,function(){u.samples?E.decryptAvcSamples(u.samples,0,0,function(){h(n)}):h(n)}):u.samples&&E.decryptAvcSamples(u.samples,0,0,function(){h(n)})})},o.destroy=function(){this._duration=0},o.parseAVCPES=function(n,E,h,d){var u=this,r=this.parseAVCNALu(n,h.data),a=this.avcSample,v,m=!1;h.data=null,a&&r.length&&!n.audFound&&(s(a,n),a=this.avcSample=g(!1,h.pts,h.dts,"")),r.forEach(function(D){switch(D.type){case 1:{v=!0,a||(a=u.avcSample=g(!0,h.pts,h.dts,"")),a.frame=!0;var R=D.data;if(m&&R.length>4){var F=new A.default(R).readSliceType();(F===2||F===4||F===7||F===9)&&(a.key=!0)}break}case 5:v=!0,a||(a=u.avcSample=g(!0,h.pts,h.dts,"")),a.key=!0,a.frame=!0;break;case 6:{v=!0,Object(I.parseSEIMessageFromNALu)(l(D.data),h.pts,E.samples);break}case 7:if(v=!0,m=!0,!n.sps){var _=new A.default(D.data),B=_.readSPS();n.width=B.width,n.height=B.height,n.pixelRatio=B.pixelRatio,n.sps=[D.data],n.duration=u._duration;for(var U=D.data.subarray(1,4),N="avc1.",k=0;k<3;k++){var w=U[k].toString(16);w.length<2&&(w="0"+w),N+=w}n.codec=N}break;case 8:v=!0,n.pps||(n.pps=[D.data]);break;case 9:v=!1,n.audFound=!0,a&&s(a,n),a=u.avcSample=g(!1,h.pts,h.dts,"");break;case 12:v=!0;break;default:v=!1,a&&(a.debug+="unknown NAL "+D.type+" ");break}if(a&&v){var K=a.units;K.push(D)}}),d&&a&&(s(a,n),this.avcSample=null)},o.getLastNalUnit=function(n){var E,h=this.avcSample,d;if((!h||h.units.length===0)&&(h=n[n.length-1]),(E=h)!==null&&E!==void 0&&E.units){var u=h.units;d=u[u.length-1]}return d},o.parseAVCNALu=function(n,E){var h=E.byteLength,d=n.naluState||0,u=d,r=[],a=0,v,m,D,R=-1,F=0;for(d===-1&&(R=0,F=E[0]&31,d=0,a=1);a<h;){if(v=E[a++],!d){d=v?0:1;continue}if(d===1){d=v?0:2;continue}if(!v)d=3;else if(v===1){if(R>=0){var _={data:E.subarray(R,a-d-1),type:F};r.push(_)}else{var B=this.getLastNalUnit(n.samples);if(B&&(u&&a<=4-u&&B.state&&(B.data=B.data.subarray(0,B.data.byteLength-u)),m=a-d-1,m>0)){var U=new Uint8Array(B.data.byteLength+m);U.set(B.data,0),U.set(E.subarray(0,m),B.data.byteLength),B.data=U,B.state=0}}a<h?(D=E[a]&31,R=a,F=D,d=0):d=-1}else d=0}if(R>=0&&d>=0){var N={data:E.subarray(R,h),type:F,state:d};r.push(N)}if(r.length===0){var k=this.getLastNalUnit(n.samples);if(k){var w=new Uint8Array(k.data.byteLength+E.byteLength);w.set(k.data,0),w.set(E,k.data.byteLength),k.data=w}}return n.naluState=d,r},o.parseAACPES=function(n,E){var h=0,d=this.aacOverFlow,u=E.data;if(d){this.aacOverFlow=null;var r=d.missing,a=d.sample.unit.byteLength;if(r===-1){var v=new Uint8Array(a+u.byteLength);v.set(d.sample.unit,0),v.set(u,a),u=v}else{var m=a-r;d.sample.unit.set(u.subarray(0,r),m),n.samples.push(d.sample),h=d.missing}}var D,R;for(D=h,R=u.length;D<R-1&&!M.isHeader(u,D);D++);if(D!==h){var F,_;if(D<R-1?(F="AAC PES did not start with ADTS header,offset:"+D,_=!1):(F="no ADTS header found in AAC PES",_=!0),L.logger.warn("parsing error:"+F),this.observer.emit(P.Events.ERROR,P.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.FRAG_PARSING_ERROR,fatal:_,reason:F}),_)return}M.initTrackConfig(n,this.observer,u,D,this.audioCodec);var B;if(E.pts!==void 0)B=E.pts;else if(d){var U=M.getFrameDuration(n.samplerate);B=d.sample.pts+U}else{L.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var N=0,k;D<R;)if(k=M.appendFrame(n,u,D,B,N),D+=k.length,k.missing){this.aacOverFlow=k;break}else for(N++;D<R-1&&!M.isHeader(u,D);D++);},o.parseMPEGPES=function(n,E){var h=E.data,d=h.length,u=0,r=0,a=E.pts;if(a===void 0){L.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;r<d;)if(O.isHeader(h,r)){var v=O.appendFrame(n,h,r,a,u);if(v)r+=v.length,u++;else break}else r++},o.parseID3PES=function(n,E){if(E.pts===void 0){L.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var h=p({},E,{type:this._avcTrack?S.MetadataSchema.emsg:S.MetadataSchema.audioId3});n.samples.push(h)},f}();y.minProbeByteLength=188;function g(f,o,t,n){return{key:f,frame:!1,pts:o,dts:t,units:[],debug:n,length:0}}function c(f,o){return(f[o+10]&31)<<8|f[o+11]}function i(f,o,t,n){var E={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},h=(f[o+1]&15)<<8|f[o+2],d=o+3+h-4,u=(f[o+10]&15)<<8|f[o+11];for(o+=12+u;o<d;){var r=(f[o+1]&31)<<8|f[o+2];switch(f[o]){case 207:if(!n){L.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:E.audio===-1&&(E.audio=r);break;case 21:E.id3===-1&&(E.id3=r);break;case 219:if(!n){L.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:E.avc===-1&&(E.avc=r);break;case 3:case 4:t.mpeg!==!0&&t.mp3!==!0?L.logger.log("MPEG audio found, not supported in this browser"):E.audio===-1&&(E.audio=r,E.segmentCodec="mp3");break;case 36:L.logger.warn("Unsupported HEVC stream type found");break}o+=((f[o+3]&15)<<8|f[o+4])+5}return E}function e(f){var o=0,t,n,E,h,d,u=f.data;if(!f||f.size===0)return null;for(;u[0].length<19&&u.length>1;){var r=new Uint8Array(u[0].length+u[1].length);r.set(u[0]),r.set(u[1],u[0].length),u[0]=r,u.splice(1,1)}t=u[0];var a=(t[0]<<16)+(t[1]<<8)+t[2];if(a===1){if(n=(t[4]<<8)+t[5],n&&n>f.size-6)return null;var v=t[7];v&192&&(h=(t[9]&14)*536870912+(t[10]&255)*4194304+(t[11]&254)*16384+(t[12]&255)*128+(t[13]&254)/2,v&64?(d=(t[14]&14)*536870912+(t[15]&255)*4194304+(t[16]&254)*16384+(t[17]&255)*128+(t[18]&254)/2,h-d>60*9e4&&(L.logger.warn(Math.round((h-d)/9e4)+"s delta between PTS and DTS, align them"),h=d)):d=h),E=t[8];var m=E+9;if(f.size<=m)return null;f.size-=m;for(var D=new Uint8Array(f.size),R=0,F=u.length;R<F;R++){t=u[R];var _=t.byteLength;if(m)if(m>_){m-=_;continue}else t=t.subarray(m),_-=m,m=0;D.set(t,o),o+=_}return n&&(n-=E+3),{data:D,pts:h,dts:d,len:n}}return null}function s(f,o){if(f.units.length&&f.frame){if(f.pts===void 0){var t=o.samples,n=t.length;if(n){var E=t[n-1];f.pts=E.pts,f.dts=E.dts}else{o.dropped++;return}}o.samples.push(f)}f.debug.length&&L.logger.log(f.pts+"/"+f.dts+":"+f.debug)}function l(f){for(var o=f.byteLength,t=[],n=1;n<o-2;)f[n]===0&&f[n+1]===0&&f[n+2]===3?(t.push(n+2),n+=2):n++;if(t.length===0)return f;var E=o-t.length,h=new Uint8Array(E),d=0;for(n=0;n<E;d++,n++)d===t[0]&&(d++,t.shift()),h[n]=f[d];return h}C.default=y},"./src/errors.ts":function(j,C,x){x.r(C),x.d(C,"ErrorTypes",function(){return M}),x.d(C,"ErrorDetails",function(){return O});var M;(function(A){A.NETWORK_ERROR="networkError",A.MEDIA_ERROR="mediaError",A.KEY_SYSTEM_ERROR="keySystemError",A.MUX_ERROR="muxError",A.OTHER_ERROR="otherError"})(M||(M={}));var O;(function(A){A.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",A.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",A.KEY_SYSTEM_NO_SESSION="keySystemNoSession",A.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",A.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",A.MANIFEST_LOAD_ERROR="manifestLoadError",A.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",A.MANIFEST_PARSING_ERROR="manifestParsingError",A.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",A.LEVEL_EMPTY_ERROR="levelEmptyError",A.LEVEL_LOAD_ERROR="levelLoadError",A.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",A.LEVEL_SWITCH_ERROR="levelSwitchError",A.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",A.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",A.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",A.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",A.FRAG_LOAD_ERROR="fragLoadError",A.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",A.FRAG_DECRYPT_ERROR="fragDecryptError",A.FRAG_PARSING_ERROR="fragParsingError",A.REMUX_ALLOC_ERROR="remuxAllocError",A.KEY_LOAD_ERROR="keyLoadError",A.KEY_LOAD_TIMEOUT="keyLoadTimeOut",A.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",A.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",A.BUFFER_APPEND_ERROR="bufferAppendError",A.BUFFER_APPENDING_ERROR="bufferAppendingError",A.BUFFER_STALLED_ERROR="bufferStalledError",A.BUFFER_FULL_ERROR="bufferFullError",A.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",A.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",A.INTERNAL_EXCEPTION="internalException",A.INTERNAL_ABORTED="aborted",A.UNKNOWN="unknown"})(O||(O={}))},"./src/events.ts":function(j,C,x){x.r(C),x.d(C,"Events",function(){return M});var M;(function(O){O.MEDIA_ATTACHING="hlsMediaAttaching",O.MEDIA_ATTACHED="hlsMediaAttached",O.MEDIA_DETACHING="hlsMediaDetaching",O.MEDIA_DETACHED="hlsMediaDetached",O.BUFFER_RESET="hlsBufferReset",O.BUFFER_CODECS="hlsBufferCodecs",O.BUFFER_CREATED="hlsBufferCreated",O.BUFFER_APPENDING="hlsBufferAppending",O.BUFFER_APPENDED="hlsBufferAppended",O.BUFFER_EOS="hlsBufferEos",O.BUFFER_FLUSHING="hlsBufferFlushing",O.BUFFER_FLUSHED="hlsBufferFlushed",O.MANIFEST_LOADING="hlsManifestLoading",O.MANIFEST_LOADED="hlsManifestLoaded",O.MANIFEST_PARSED="hlsManifestParsed",O.LEVEL_SWITCHING="hlsLevelSwitching",O.LEVEL_SWITCHED="hlsLevelSwitched",O.LEVEL_LOADING="hlsLevelLoading",O.LEVEL_LOADED="hlsLevelLoaded",O.LEVEL_UPDATED="hlsLevelUpdated",O.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",O.LEVELS_UPDATED="hlsLevelsUpdated",O.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",O.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",O.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",O.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",O.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",O.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",O.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",O.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",O.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",O.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",O.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",O.CUES_PARSED="hlsCuesParsed",O.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",O.INIT_PTS_FOUND="hlsInitPtsFound",O.FRAG_LOADING="hlsFragLoading",O.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",O.FRAG_LOADED="hlsFragLoaded",O.FRAG_DECRYPTED="hlsFragDecrypted",O.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",O.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",O.FRAG_PARSING_METADATA="hlsFragParsingMetadata",O.FRAG_PARSED="hlsFragParsed",O.FRAG_BUFFERED="hlsFragBuffered",O.FRAG_CHANGED="hlsFragChanged",O.FPS_DROP="hlsFpsDrop",O.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",O.ERROR="hlsError",O.DESTROYING="hlsDestroying",O.KEY_LOADING="hlsKeyLoading",O.KEY_LOADED="hlsKeyLoaded",O.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",O.BACK_BUFFER_REACHED="hlsBackBufferReached"})(M||(M={}))},"./src/hls.ts":function(j,C,x){x.r(C),x.d(C,"default",function(){return l});var M=x("./node_modules/url-toolkit/src/url-toolkit.js"),O=x("./src/loader/playlist-loader.ts"),A=x("./src/loader/key-loader.ts"),b=x("./src/controller/id3-track-controller.ts"),P=x("./src/controller/latency-controller.ts"),I=x("./src/controller/level-controller.ts"),L=x("./src/controller/fragment-tracker.ts"),T=x("./src/controller/stream-controller.ts"),S=x("./src/is-supported.ts"),p=x("./src/utils/logger.ts"),y=x("./src/config.ts"),g=x("./node_modules/eventemitter3/index.js"),c=x("./src/events.ts"),i=x("./src/errors.ts");function e(f,o){for(var t=0;t<o.length;t++){var n=o[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(f,n.key,n)}}function s(f,o,t){return o&&e(f.prototype,o),t&&e(f,t),Object.defineProperty(f,"prototype",{writable:!1}),f}var l=function(){f.isSupported=function(){return Object(S.isSupported)()};function f(t){t===void 0&&(t={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new g.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var n=this.config=Object(y.mergeConfig)(f.DefaultConfig,t);this.userConfig=t,Object(p.enableLogs)(n.debug),this._autoLevelCapping=-1,n.progressive&&Object(y.enableStreamingMode)(n);var E=n.abrController,h=n.bufferController,d=n.capLevelController,u=n.fpsController,r=this.abrController=new E(this),a=this.bufferController=new h(this),v=this.capLevelController=new d(this),m=new u(this),D=new O.default(this),R=new A.default(this),F=new b.default(this),_=this.levelController=new I.default(this),B=new L.FragmentTracker(this),U=this.streamController=new T.default(this,B);v.setStreamController(U),m.setStreamController(U);var N=[_,U];this.networkControllers=N;var k=[D,R,r,a,v,m,F,B];this.audioTrackController=this.createController(n.audioTrackController,null,N),this.createController(n.audioStreamController,B,N),this.subtitleTrackController=this.createController(n.subtitleTrackController,null,N),this.createController(n.subtitleStreamController,B,N),this.createController(n.timelineController,null,k),this.emeController=this.createController(n.emeController,null,k),this.cmcdController=this.createController(n.cmcdController,null,k),this.latencyController=this.createController(P.default,null,k),this.coreComponents=k}var o=f.prototype;return o.createController=function(n,E,h){if(n){var d=E?new n(this,E):new n(this);return h&&h.push(d),d}return null},o.on=function(n,E,h){h===void 0&&(h=this),this._emitter.on(n,E,h)},o.once=function(n,E,h){h===void 0&&(h=this),this._emitter.once(n,E,h)},o.removeAllListeners=function(n){this._emitter.removeAllListeners(n)},o.off=function(n,E,h,d){h===void 0&&(h=this),this._emitter.off(n,E,h,d)},o.listeners=function(n){return this._emitter.listeners(n)},o.emit=function(n,E,h){return this._emitter.emit(n,E,h)},o.trigger=function(n,E){if(this.config.debug)return this.emit(n,n,E);try{return this.emit(n,n,E)}catch(h){p.logger.error("An internal error happened while handling event "+n+'. Error message: "'+h.message+'". Here is a stacktrace:',h),this.trigger(c.Events.ERROR,{type:i.ErrorTypes.OTHER_ERROR,details:i.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:n,error:h})}return!1},o.listenerCount=function(n){return this._emitter.listenerCount(n)},o.destroy=function(){p.logger.log("destroy"),this.trigger(c.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(n){return n.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(n){return n.destroy()}),this.coreComponents.length=0},o.attachMedia=function(n){p.logger.log("attachMedia"),this._media=n,this.trigger(c.Events.MEDIA_ATTACHING,{media:n})},o.detachMedia=function(){p.logger.log("detachMedia"),this.trigger(c.Events.MEDIA_DETACHING,void 0),this._media=null},o.loadSource=function(n){this.stopLoad();var E=this.media,h=this.url,d=this.url=M.buildAbsoluteURL(self.location.href,n,{alwaysNormalize:!0});p.logger.log("loadSource:"+d),E&&h&&h!==d&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(E)),this.trigger(c.Events.MANIFEST_LOADING,{url:n})},o.startLoad=function(n){n===void 0&&(n=-1),p.logger.log("startLoad("+n+")"),this.networkControllers.forEach(function(E){E.startLoad(n)})},o.stopLoad=function(){p.logger.log("stopLoad"),this.networkControllers.forEach(function(n){n.stopLoad()})},o.swapAudioCodec=function(){p.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},o.recoverMediaError=function(){p.logger.log("recoverMediaError");var n=this._media;this.detachMedia(),n&&this.attachMedia(n)},o.removeLevel=function(n,E){E===void 0&&(E=0),this.levelController.removeLevel(n,E)},s(f,[{key:"levels",get:function(){var n=this.levelController.levels;return n||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(n){p.logger.log("set currentLevel:"+n),this.loadLevel=n,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(n){p.logger.log("set nextLevel:"+n),this.levelController.manualLevel=n,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(n){p.logger.log("set loadLevel:"+n),this.levelController.manualLevel=n}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(n){this.levelController.nextLoadLevel=n}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(n){p.logger.log("set firstLevel:"+n),this.levelController.firstLevel=n}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(n){p.logger.log("set startLevel:"+n),n!==-1&&(n=Math.max(n,this.minAutoLevel)),this.levelController.startLevel=n}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(n){var E=!!n;E!==this.config.capLevelToPlayerSize&&(E?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=E)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(n){this._autoLevelCapping!==n&&(p.logger.log("set autoLevelCapping:"+n),this._autoLevelCapping=n)}},{key:"bandwidthEstimate",get:function(){var n=this.abrController.bwEstimator;return n?n.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var n=this.levels,E=this.config.minAutoBitrate;if(!n)return 0;for(var h=n.length,d=0;d<h;d++)if(n[d].maxBitrate>=E)return d;return 0}},{key:"maxAutoLevel",get:function(){var n=this.levels,E=this.autoLevelCapping,h;return E===-1&&n&&n.length?h=n.length-1:h=E,h}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(n){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,n)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"audioTracks",get:function(){var n=this.audioTrackController;return n?n.audioTracks:[]}},{key:"audioTrack",get:function(){var n=this.audioTrackController;return n?n.audioTrack:-1},set:function(n){var E=this.audioTrackController;E&&(E.audioTrack=n)}},{key:"subtitleTracks",get:function(){var n=this.subtitleTrackController;return n?n.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var n=this.subtitleTrackController;return n?n.subtitleTrack:-1},set:function(n){var E=this.subtitleTrackController;E&&(E.subtitleTrack=n)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var n=this.subtitleTrackController;return n?n.subtitleDisplay:!1},set:function(n){var E=this.subtitleTrackController;E&&(E.subtitleDisplay=n)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(n){this.config.lowLatencyMode=n}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.2.0"}},{key:"Events",get:function(){return c.Events}},{key:"ErrorTypes",get:function(){return i.ErrorTypes}},{key:"ErrorDetails",get:function(){return i.ErrorDetails}},{key:"DefaultConfig",get:function(){return f.defaultConfig?f.defaultConfig:y.hlsDefaultConfig},set:function(n){f.defaultConfig=n}}]),f}();l.defaultConfig=void 0},"./src/is-supported.ts":function(j,C,x){x.r(C),x.d(C,"isSupported",function(){return A}),x.d(C,"changeTypeSupported",function(){return b});var M=x("./src/utils/mediasource-helper.ts");function O(){return self.SourceBuffer||self.WebKitSourceBuffer}function A(){var P=Object(M.getMediaSource)();if(!P)return!1;var I=O(),L=P&&typeof P.isTypeSupported=="function"&&P.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),T=!I||I.prototype&&typeof I.prototype.appendBuffer=="function"&&typeof I.prototype.remove=="function";return!!L&&!!T}function b(){var P,I=O();return typeof(I==null||(P=I.prototype)===null||P===void 0?void 0:P.changeType)=="function"}},"./src/loader/date-range.ts":function(j,C,x){x.r(C),x.d(C,"DateRangeAttribute",function(){return L}),x.d(C,"DateRange",function(){return T});var M=x("./src/polyfills/number.ts"),O=x("./src/utils/attr-list.ts"),A=x("./src/utils/logger.ts");function b(){return b=Object.assign?Object.assign.bind():function(S){for(var p=1;p<arguments.length;p++){var y=arguments[p];for(var g in y)Object.prototype.hasOwnProperty.call(y,g)&&(S[g]=y[g])}return S},b.apply(this,arguments)}function P(S,p){for(var y=0;y<p.length;y++){var g=p[y];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(S,g.key,g)}}function I(S,p,y){return p&&P(S.prototype,p),y&&P(S,y),Object.defineProperty(S,"prototype",{writable:!1}),S}var L;(function(S){S.ID="ID",S.CLASS="CLASS",S.START_DATE="START-DATE",S.DURATION="DURATION",S.END_DATE="END-DATE",S.END_ON_NEXT="END-ON-NEXT",S.PLANNED_DURATION="PLANNED-DURATION",S.SCTE35_OUT="SCTE35-OUT",S.SCTE35_IN="SCTE35-IN"})(L||(L={}));var T=function(){function S(p,y){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,y){var g=y.attr;for(var c in g)if(Object.prototype.hasOwnProperty.call(p,c)&&p[c]!==g[c]){A.logger.warn('DATERANGE tag attribute: "'+c+'" does not match for tags with ID: "'+p.ID+'"'),this._badValueForSameId=c;break}p=b(new O.AttrList({}),g,p)}if(this.attr=p,this._startDate=new Date(p[L.START_DATE]),L.END_DATE in this.attr){var i=new Date(this.attr[L.END_DATE]);Object(M.isFiniteNumber)(i.getTime())&&(this._endDate=i)}}return I(S,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var y=this.duration;return y!==null?new Date(this._startDate.getTime()+y*1e3):null}},{key:"duration",get:function(){if(L.DURATION in this.attr){var y=this.attr.decimalFloatingPoint(L.DURATION);if(Object(M.isFiniteNumber)(y))return y}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return L.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(L.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(L.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&Object(M.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),S}()},"./src/loader/fragment-loader.ts":function(j,C,x){x.r(C),x.d(C,"default",function(){return y}),x.d(C,"LoadError",function(){return c});var M=x("./src/polyfills/number.ts"),O=x("./src/errors.ts");function A(i,e){i.prototype=Object.create(e.prototype),i.prototype.constructor=i,T(i,e)}function b(i){var e=typeof Map=="function"?new Map:void 0;return b=function(l){if(l===null||!L(l))return l;if(typeof l!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e!="undefined"){if(e.has(l))return e.get(l);e.set(l,f)}function f(){return P(l,arguments,S(this).constructor)}return f.prototype=Object.create(l.prototype,{constructor:{value:f,enumerable:!1,writable:!0,configurable:!0}}),T(f,l)},b(i)}function P(i,e,s){return I()?P=Reflect.construct.bind():P=function(f,o,t){var n=[null];n.push.apply(n,o);var E=Function.bind.apply(f,n),h=new E;return t&&T(h,t.prototype),h},P.apply(null,arguments)}function I(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function L(i){return Function.toString.call(i).indexOf("[native code]")!==-1}function T(i,e){return T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,f){return l.__proto__=f,l},T(i,e)}function S(i){return S=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},S(i)}var p=Math.pow(2,17),y=function(){function i(s){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=s}var e=i.prototype;return e.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},e.abort=function(){this.loader&&this.loader.abort()},e.load=function(l,f){var o=this,t=l.url;if(!t)return Promise.reject(new c({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:l,networkDetails:null},"Fragment does not have a "+(t?"part list":"url")));this.abort();var n=this.config,E=n.fLoader,h=n.loader;return new Promise(function(d,u){o.loader&&o.loader.destroy();var r=o.loader=l.loader=E?new E(n):new h(n),a=g(l),v={timeout:n.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:n.fragLoadingMaxRetryTimeout,highWaterMark:l.sn==="initSegment"?1/0:p};l.stats=r.stats,r.load(a,v,{onSuccess:function(D,R,F,_){o.resetLoader(l,r),d({frag:l,part:null,payload:D.data,networkDetails:_})},onError:function(D,R,F){o.resetLoader(l,r),u(new c({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:l,response:D,networkDetails:F}))},onAbort:function(D,R,F){o.resetLoader(l,r),u(new c({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:l,networkDetails:F}))},onTimeout:function(D,R,F){o.resetLoader(l,r),u(new c({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:l,networkDetails:F}))},onProgress:function(D,R,F,_){f&&f({frag:l,part:null,payload:F,networkDetails:_})}})})},e.loadPart=function(l,f,o){var t=this;this.abort();var n=this.config,E=n.fLoader,h=n.loader;return new Promise(function(d,u){t.loader&&t.loader.destroy();var r=t.loader=l.loader=E?new E(n):new h(n),a=g(l,f),v={timeout:n.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:n.fragLoadingMaxRetryTimeout,highWaterMark:p};f.stats=r.stats,r.load(a,v,{onSuccess:function(D,R,F,_){t.resetLoader(l,r),t.updateStatsFromPart(l,f);var B={frag:l,part:f,payload:D.data,networkDetails:_};o(B),d(B)},onError:function(D,R,F){t.resetLoader(l,r),u(new c({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:l,part:f,response:D,networkDetails:F}))},onAbort:function(D,R,F){l.stats.aborted=f.stats.aborted,t.resetLoader(l,r),u(new c({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:l,part:f,networkDetails:F}))},onTimeout:function(D,R,F){t.resetLoader(l,r),u(new c({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:l,part:f,networkDetails:F}))}})})},e.updateStatsFromPart=function(l,f){var o=l.stats,t=f.stats,n=t.total;if(o.loaded+=t.loaded,n){var E=Math.round(l.duration/f.duration),h=Math.min(Math.round(o.loaded/n),E),d=E-h,u=d*Math.round(o.loaded/h);o.total=o.loaded+u}else o.total=Math.max(o.loaded,o.total);var r=o.loading,a=t.loading;r.start?r.first+=a.first-a.start:(r.start=a.start,r.first=a.first),r.end=a.end},e.resetLoader=function(l,f){l.loader=null,this.loader===f&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),f.destroy()},i}();function g(i,e){e===void 0&&(e=null);var s=e||i,l={frag:i,part:e,responseType:"arraybuffer",url:s.url,headers:{},rangeStart:0,rangeEnd:0},f=s.byteRangeStartOffset,o=s.byteRangeEndOffset;return Object(M.isFiniteNumber)(f)&&Object(M.isFiniteNumber)(o)&&(l.rangeStart=f,l.rangeEnd=o),l}var c=function(i){A(e,i);function e(s){for(var l,f=arguments.length,o=new Array(f>1?f-1:0),t=1;t<f;t++)o[t-1]=arguments[t];return l=i.call.apply(i,[this].concat(o))||this,l.data=void 0,l.data=s,l}return e}(b(Error))},"./src/loader/fragment.ts":function(j,C,x){x.r(C),x.d(C,"ElementaryStreamTypes",function(){return p}),x.d(C,"BaseSegment",function(){return y}),x.d(C,"Fragment",function(){return g}),x.d(C,"Part",function(){return c});var M=x("./src/polyfills/number.ts"),O=x("./node_modules/url-toolkit/src/url-toolkit.js"),A=x("./src/utils/logger.ts"),b=x("./src/loader/level-key.ts"),P=x("./src/loader/load-stats.ts");function I(i,e){i.prototype=Object.create(e.prototype),i.prototype.constructor=i,L(i,e)}function L(i,e){return L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,f){return l.__proto__=f,l},L(i,e)}function T(i,e){for(var s=0;s<e.length;s++){var l=e[s];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(i,l.key,l)}}function S(i,e,s){return e&&T(i.prototype,e),s&&T(i,s),Object.defineProperty(i,"prototype",{writable:!1}),i}var p;(function(i){i.AUDIO="audio",i.VIDEO="video",i.AUDIOVIDEO="audiovideo"})(p||(p={}));var y=function(){function i(s){var l;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(l={},l[p.AUDIO]=null,l[p.VIDEO]=null,l[p.AUDIOVIDEO]=null,l),this.baseurl=s}var e=i.prototype;return e.setByteRange=function(l,f){var o=l.split("@",2),t=[];o.length===1?t[0]=f?f.byteRangeEndOffset:0:t[0]=parseInt(o[1]),t[1]=parseInt(o[0])+t[0],this._byteRange=t},S(i,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(O.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(l){this._url=l}}]),i}(),g=function(i){I(e,i);function e(l,f){var o;return o=i.call(this,f)||this,o._decryptdata=null,o.rawProgramDateTime=null,o.programDateTime=null,o.tagList=[],o.duration=0,o.sn=0,o.levelkey=void 0,o.type=void 0,o.loader=null,o.level=-1,o.cc=0,o.startPTS=void 0,o.endPTS=void 0,o.appendedPTS=void 0,o.startDTS=void 0,o.endDTS=void 0,o.start=0,o.deltaPTS=void 0,o.maxStartPTS=void 0,o.minEndPTS=void 0,o.stats=new P.LoadStats,o.urlId=0,o.data=void 0,o.bitrateTest=!1,o.title=null,o.initSegment=null,o.type=l,o}var s=e.prototype;return s.createInitializationVector=function(f){for(var o=new Uint8Array(16),t=12;t<16;t++)o[t]=f>>8*(15-t)&255;return o},s.setDecryptDataFromLevelKey=function(f,o){var t=f;return(f==null?void 0:f.method)==="AES-128"&&f.uri&&!f.iv&&(t=b.LevelKey.fromURI(f.uri),t.method=f.method,t.iv=this.createInitializationVector(o),t.keyFormat="identity"),t},s.setElementaryStreamInfo=function(f,o,t,n,E,h){h===void 0&&(h=!1);var d=this.elementaryStreams,u=d[f];if(!u){d[f]={startPTS:o,endPTS:t,startDTS:n,endDTS:E,partial:h};return}u.startPTS=Math.min(u.startPTS,o),u.endPTS=Math.max(u.endPTS,t),u.startDTS=Math.min(u.startDTS,n),u.endDTS=Math.max(u.endDTS,E)},s.clearElementaryStreamInfo=function(){var f=this.elementaryStreams;f[p.AUDIO]=null,f[p.VIDEO]=null,f[p.AUDIOVIDEO]=null},S(e,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var f=this.sn;typeof f!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&A.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),f=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,f)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(M.isFiniteNumber)(this.programDateTime))return null;var f=Object(M.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+f*1e3}},{key:"encrypted",get:function(){var f;return!!((f=this.decryptdata)!==null&&f!==void 0&&f.keyFormat&&this.decryptdata.uri)}}]),e}(y),c=function(i){I(e,i);function e(s,l,f,o,t){var n;n=i.call(this,f)||this,n.fragOffset=0,n.duration=0,n.gap=!1,n.independent=!1,n.relurl=void 0,n.fragment=void 0,n.index=void 0,n.stats=new P.LoadStats,n.duration=s.decimalFloatingPoint("DURATION"),n.gap=s.bool("GAP"),n.independent=s.bool("INDEPENDENT"),n.relurl=s.enumeratedString("URI"),n.fragment=l,n.index=o;var E=s.enumeratedString("BYTERANGE");return E&&n.setByteRange(E,t),t&&(n.fragOffset=t.fragOffset+t.duration),n}return S(e,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var l=this.elementaryStreams;return!!(l.audio||l.video||l.audiovideo)}}]),e}(y)},"./src/loader/key-loader.ts":function(j,C,x){x.r(C),x.d(C,"default",function(){return b});var M=x("./src/events.ts"),O=x("./src/errors.ts"),A=x("./src/utils/logger.ts"),b=function(){function P(L){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=L,this._registerListeners()}var I=P.prototype;return I._registerListeners=function(){this.hls.on(M.Events.KEY_LOADING,this.onKeyLoading,this)},I._unregisterListeners=function(){this.hls.off(M.Events.KEY_LOADING,this.onKeyLoading)},I.destroy=function(){this._unregisterListeners();for(var T in this.loaders){var S=this.loaders[T];S&&S.destroy()}this.loaders={}},I.onKeyLoading=function(T,S){var p=S.frag,y=p.type,g=this.loaders[y];if(!p.decryptdata){A.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var c=p.decryptdata.uri;if(c!==this.decrypturl||this.decryptkey===null){var i=this.hls.config;if(g&&(A.logger.warn("abort previous key loader for type:"+y),g.abort()),!c){A.logger.warn("key uri is falsy");return}var e=i.loader,s=p.loader=this.loaders[y]=new e(i);this.decrypturl=c,this.decryptkey=null;var l={url:c,frag:p,responseType:"arraybuffer"},f={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:i.fragLoadingRetryDelay,maxRetryDelay:i.fragLoadingMaxRetryTimeout,highWaterMark:0},o={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};s.load(l,f,o)}else this.decryptkey&&(p.decryptdata.key=this.decryptkey,this.hls.trigger(M.Events.KEY_LOADED,{frag:p}))},I.loadsuccess=function(T,S,p){var y=p.frag;if(!y.decryptdata){A.logger.error("after key load, decryptdata unset");return}this.decryptkey=y.decryptdata.key=new Uint8Array(T.data),y.loader=null,delete this.loaders[y.type],this.hls.trigger(M.Events.KEY_LOADED,{frag:y})},I.loaderror=function(T,S){var p=S.frag,y=p.loader;y&&y.abort(),delete this.loaders[p.type],this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:p,response:T})},I.loadtimeout=function(T,S){var p=S.frag,y=p.loader;y&&y.abort(),delete this.loaders[p.type],this.hls.trigger(M.Events.ERROR,{type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:p})},P}()},"./src/loader/level-details.ts":function(j,C,x){x.r(C),x.d(C,"LevelDetails",function(){return P});var M=x("./src/polyfills/number.ts");function O(I,L){for(var T=0;T<L.length;T++){var S=L[T];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(I,S.key,S)}}function A(I,L,T){return L&&O(I.prototype,L),T&&O(I,T),Object.defineProperty(I,"prototype",{writable:!1}),I}var b=10,P=function(){function I(T){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=T}var L=I.prototype;return L.reloaded=function(S){if(!S){this.advanced=!0,this.updated=!0;return}var p=this.lastPartSn-S.lastPartSn,y=this.lastPartIndex-S.lastPartIndex;this.updated=this.endSN!==S.endSN||!!y||!!p,this.advanced=this.endSN>S.endSN||p>0||p===0&&y>0,this.updated||this.advanced?this.misses=Math.floor(S.misses*.6):this.misses=S.misses+1,this.availabilityDelay=S.availabilityDelay},A(I,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?Object(M.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||b}},{key:"drift",get:function(){var S=this.driftEndTime-this.driftStartTime;if(S>0){var p=this.driftEnd-this.driftStart;return p*1e3/S}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var S;return(S=this.partList)!==null&&S!==void 0&&S.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var S;return(S=this.fragments)!==null&&S!==void 0&&S.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var S;return(S=this.partList)!==null&&S!==void 0&&S.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var S;return(S=this.partList)!==null&&S!==void 0&&S.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),I}()},"./src/loader/level-key.ts":function(j,C,x){x.r(C),x.d(C,"LevelKey",function(){return b});var M=x("./node_modules/url-toolkit/src/url-toolkit.js");function O(P,I){for(var L=0;L<I.length;L++){var T=I[L];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(P,T.key,T)}}function A(P,I,L){return I&&O(P.prototype,I),L&&O(P,L),Object.defineProperty(P,"prototype",{writable:!1}),P}var b=function(){P.fromURL=function(L,T){return new P(L,T)},P.fromURI=function(L){return new P(L)};function P(I,L){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,L?this._uri=Object(M.buildAbsoluteURL)(I,L,{alwaysNormalize:!0}):this._uri=I}return A(P,[{key:"uri",get:function(){return this._uri}}]),P}()},"./src/loader/load-stats.ts":function(j,C,x){x.r(C),x.d(C,"LoadStats",function(){return M});var M=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(j,C,x){x.r(C),x.d(C,"default",function(){return s});var M=x("./src/polyfills/number.ts"),O=x("./node_modules/url-toolkit/src/url-toolkit.js"),A=x("./src/loader/date-range.ts"),b=x("./src/loader/fragment.ts"),P=x("./src/loader/level-details.ts"),I=x("./src/loader/level-key.ts"),L=x("./src/utils/attr-list.ts"),T=x("./src/utils/logger.ts"),S=x("./src/utils/codecs.ts"),p=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,y=/#EXT-X-MEDIA:(.*)/g,g=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),c=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),i=/\.(mp4|m4s|m4v|m4a)$/i;function e(E){var h,d;return i.test((h=(d=O.parseURL(E))===null||d===void 0?void 0:d.path)!=null?h:"")}var s=function(){function E(){}return E.findGroup=function(d,u){for(var r=0;r<d.length;r++){var a=d[r];if(a.id===u)return a}},E.convertAVC1ToAVCOTI=function(d){var u=d.split(".");if(u.length>2){var r=u.shift()+".";return r+=parseInt(u.shift()).toString(16),r+=("000"+parseInt(u.shift()).toString(16)).slice(-4),r}return d},E.resolve=function(d,u){return O.buildAbsoluteURL(u,d,{alwaysNormalize:!0})},E.parseMasterPlaylist=function(d,u){var r=[],a={},v=!1;p.lastIndex=0;for(var m;(m=p.exec(d))!=null;)if(m[1]){var D=new L.AttrList(m[1]),R={attrs:D,bitrate:D.decimalInteger("AVERAGE-BANDWIDTH")||D.decimalInteger("BANDWIDTH"),name:D.NAME,url:E.resolve(m[2],u)},F=D.decimalResolution("RESOLUTION");F&&(R.width=F.width,R.height=F.height),l((D.CODECS||"").split(/[ ,]+/).filter(function(B){return B}),R),R.videoCodec&&R.videoCodec.indexOf("avc1")!==-1&&(R.videoCodec=E.convertAVC1ToAVCOTI(R.videoCodec)),r.push(R)}else if(m[3]){var _=new L.AttrList(m[3]);_["DATA-ID"]&&(v=!0,a[_["DATA-ID"]]=_)}return{levels:r,sessionData:v?a:null}},E.parseMasterPlaylistMedia=function(d,u,r,a){a===void 0&&(a=[]);var v,m=[],D=0;for(y.lastIndex=0;(v=y.exec(d))!==null;){var R=new L.AttrList(v[1]);if(R.TYPE===r){var F={attrs:R,bitrate:0,id:D++,groupId:R["GROUP-ID"],instreamId:R["INSTREAM-ID"],name:R.NAME||R.LANGUAGE||"",type:r,default:R.bool("DEFAULT"),autoselect:R.bool("AUTOSELECT"),forced:R.bool("FORCED"),lang:R.LANGUAGE,url:R.URI?E.resolve(R.URI,u):""};if(a.length){var _=E.findGroup(a,F.groupId)||a[0];f(F,_,"audioCodec"),f(F,_,"textCodec")}m.push(F)}}return m},E.parseLevelPlaylist=function(d,u,r,a,v){var m=new P.LevelDetails(u),D=m.fragments,R=null,F=0,_=0,B=0,U=0,N=null,k=new b.Fragment(a,u),w,K,W,H=-1,G=!1;for(g.lastIndex=0,m.m3u8=d;(w=g.exec(d))!==null;){G&&(G=!1,k=new b.Fragment(a,u),k.start=B,k.sn=F,k.cc=U,k.level=r,R&&(k.initSegment=R,k.rawProgramDateTime=R.rawProgramDateTime,R.rawProgramDateTime=null));var Y=w[1];if(Y){k.duration=parseFloat(Y);var Q=(" "+w[2]).slice(1);k.title=Q||null,k.tagList.push(Q?["INF",Y,Q]:["INF",Y])}else if(w[3])Object(M.isFiniteNumber)(k.duration)&&(k.start=B,W&&(k.levelkey=W),k.sn=F,k.level=r,k.cc=U,k.urlId=v,D.push(k),k.relurl=(" "+w[3]).slice(1),t(k,N),N=k,B+=k.duration,F++,_=0,G=!0);else if(w[4]){var z=(" "+w[4]).slice(1);N?k.setByteRange(z,N):k.setByteRange(z)}else if(w[5])k.rawProgramDateTime=(" "+w[5]).slice(1),k.tagList.push(["PROGRAM-DATE-TIME",k.rawProgramDateTime]),H===-1&&(H=D.length);else{if(w=w[0].match(c),!w){T.logger.warn("No matches on slow regex match for level playlist!");continue}for(K=1;K<w.length&&typeof w[K]=="undefined";K++);var V=(" "+w[K]).slice(1),X=(" "+w[K+1]).slice(1),J=w[K+2]?(" "+w[K+2]).slice(1):"";switch(V){case"PLAYLIST-TYPE":m.type=X.toUpperCase();break;case"MEDIA-SEQUENCE":F=m.startSN=parseInt(X);break;case"SKIP":{var $=new L.AttrList(X),Z=$.decimalInteger("SKIPPED-SEGMENTS");if(Object(M.isFiniteNumber)(Z)){m.skippedSegments=Z;for(var q=Z;q--;)D.unshift(null);F+=Z}var ee=$.enumeratedString("RECENTLY-REMOVED-DATERANGES");ee&&(m.recentlyRemovedDateranges=ee.split("	"));break}case"TARGETDURATION":m.targetduration=parseFloat(X);break;case"VERSION":m.version=parseInt(X);break;case"EXTM3U":break;case"ENDLIST":m.live=!1;break;case"#":(X||J)&&k.tagList.push(J?[X,J]:[X]);break;case"DISCONTINUITY":U++,k.tagList.push(["DIS"]);break;case"GAP":k.tagList.push([V]);break;case"BITRATE":k.tagList.push([V,X]);break;case"DATERANGE":{var re=new L.AttrList(X),te=new A.DateRange(re,m.dateRanges[re.ID]);te.isValid||m.skippedSegments?m.dateRanges[te.id]=te:T.logger.warn('Ignoring invalid DATERANGE tag: "'+X+'"'),k.tagList.push(["EXT-X-DATERANGE",X]);break}case"DISCONTINUITY-SEQUENCE":U=parseInt(X);break;case"KEY":{var se,ue=new L.AttrList(X),fe=ue.enumeratedString("METHOD"),ne=ue.URI,ye=ue.hexadecimalInteger("IV"),de=ue.enumeratedString("KEYFORMATVERSIONS"),oe=ue.enumeratedString("KEYID"),ge=(se=ue.enumeratedString("KEYFORMAT"))!=null?se:"identity",pe=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(pe.indexOf(ge)>-1){T.logger.warn("Keyformat "+ge+" is not supported from the manifest");continue}else if(ge!=="identity")continue;fe&&(W=I.LevelKey.fromURL(u,ne),ne&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(fe)>=0&&(W.method=fe,W.keyFormat=ge,oe&&(W.keyID=oe),de&&(W.keyFormatVersions=de),W.iv=ye));break}case"START":{var me=new L.AttrList(X),ie=me.decimalFloatingPoint("TIME-OFFSET");Object(M.isFiniteNumber)(ie)&&(m.startTimeOffset=ie);break}case"MAP":{var le=new L.AttrList(X);if(k.duration){var he=new b.Fragment(a,u);n(he,le,r,W),R=he,k.initSegment=R,R.rawProgramDateTime&&!k.rawProgramDateTime&&(k.rawProgramDateTime=R.rawProgramDateTime)}else n(k,le,r,W),R=k,G=!0;break}case"SERVER-CONTROL":{var ce=new L.AttrList(X);m.canBlockReload=ce.bool("CAN-BLOCK-RELOAD"),m.canSkipUntil=ce.optionalFloat("CAN-SKIP-UNTIL",0),m.canSkipDateRanges=m.canSkipUntil>0&&ce.bool("CAN-SKIP-DATERANGES"),m.partHoldBack=ce.optionalFloat("PART-HOLD-BACK",0),m.holdBack=ce.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var Te=new L.AttrList(X);m.partTarget=Te.decimalFloatingPoint("PART-TARGET");break}case"PART":{var ae=m.partList;ae||(ae=m.partList=[]);var ve=_>0?ae[ae.length-1]:void 0,Se=_++,De=new b.Part(new L.AttrList(X),k,u,Se,ve);ae.push(De),k.duration+=De.duration;break}case"PRELOAD-HINT":{var Le=new L.AttrList(X);m.preloadHint=Le;break}case"RENDITION-REPORT":{var xe=new L.AttrList(X);m.renditionReports=m.renditionReports||[],m.renditionReports.push(xe);break}default:T.logger.warn("line parsed but not handled: "+w);break}}}N&&!N.relurl?(D.pop(),B-=N.duration,m.partList&&(m.fragmentHint=N)):m.partList&&(t(k,N),k.cc=U,m.fragmentHint=k);var Re=D.length,Ie=D[0],Ae=D[Re-1];if(B+=m.skippedSegments*m.targetduration,B>0&&Re&&Ae){m.averagetargetduration=B/Re;var Pe=Ae.sn;m.endSN=Pe!=="initSegment"?Pe:0,Ie&&(m.startCC=Ie.cc,Ie.initSegment||m.fragments.every(function(Oe){return Oe.relurl&&e(Oe.relurl)})&&(T.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),k=new b.Fragment(a,u),k.relurl=Ae.relurl,k.level=r,k.sn="initSegment",Ie.initSegment=k,m.needSidxRanges=!0))}else m.endSN=0,m.startCC=0;return m.fragmentHint&&(B+=m.fragmentHint.duration),m.totalduration=B,m.endCC=U,H>0&&o(D,H),m},E}();function l(E,h){["video","audio","text"].forEach(function(d){var u=E.filter(function(a){return Object(S.isCodecType)(a,d)});if(u.length){var r=u.filter(function(a){return a.lastIndexOf("avc1",0)===0||a.lastIndexOf("mp4a",0)===0});h[d+"Codec"]=r.length>0?r[0]:u[0],E=E.filter(function(a){return u.indexOf(a)===-1})}}),h.unknownCodecs=E}function f(E,h,d){var u=h[d];u&&(E[d]=u)}function o(E,h){for(var d=E[h],u=h;u--;){var r=E[u];if(!r)return;r.programDateTime=d.programDateTime-r.duration*1e3,d=r}}function t(E,h){E.rawProgramDateTime?E.programDateTime=Date.parse(E.rawProgramDateTime):h!=null&&h.programDateTime&&(E.programDateTime=h.endProgramDateTime),Object(M.isFiniteNumber)(E.programDateTime)||(E.programDateTime=null,E.rawProgramDateTime=null)}function n(E,h,d,u){E.relurl=h.URI,h.BYTERANGE&&E.setByteRange(h.BYTERANGE),E.level=d,E.sn="initSegment",u&&(E.levelkey=u),E.initSegment=null}},"./src/loader/playlist-loader.ts":function(j,C,x){x.r(C);var M=x("./src/polyfills/number.ts"),O=x("./src/events.ts"),A=x("./src/errors.ts"),b=x("./src/utils/logger.ts"),P=x("./src/utils/mp4-tools.ts"),I=x("./src/loader/m3u8-parser.ts"),L=x("./src/types/loader.ts"),T=x("./src/utils/attr-list.ts");function S(g){var c=g.type;switch(c){case L.PlaylistContextType.AUDIO_TRACK:return L.PlaylistLevelType.AUDIO;case L.PlaylistContextType.SUBTITLE_TRACK:return L.PlaylistLevelType.SUBTITLE;default:return L.PlaylistLevelType.MAIN}}function p(g,c){var i=g.url;return(i===void 0||i.indexOf("data:")===0)&&(i=c.url),i}var y=function(){function g(i){this.hls=void 0,this.loaders=Object.create(null),this.hls=i,this.registerListeners()}var c=g.prototype;return c.registerListeners=function(){var e=this.hls;e.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(O.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(O.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(O.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},c.unregisterListeners=function(){var e=this.hls;e.off(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(O.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(O.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(O.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},c.createInternalLoader=function(e){var s=this.hls.config,l=s.pLoader,f=s.loader,o=l||f,t=new o(s);return e.loader=t,this.loaders[e.type]=t,t},c.getInternalLoader=function(e){return this.loaders[e.type]},c.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},c.destroyInternalLoaders=function(){for(var e in this.loaders){var s=this.loaders[e];s&&s.destroy(),this.resetInternalLoader(e)}},c.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},c.onManifestLoading=function(e,s){var l=s.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:L.PlaylistContextType.MANIFEST,url:l,deliveryDirectives:null})},c.onLevelLoading=function(e,s){var l=s.id,f=s.level,o=s.url,t=s.deliveryDirectives;this.load({id:l,groupId:null,level:f,responseType:"text",type:L.PlaylistContextType.LEVEL,url:o,deliveryDirectives:t})},c.onAudioTrackLoading=function(e,s){var l=s.id,f=s.groupId,o=s.url,t=s.deliveryDirectives;this.load({id:l,groupId:f,level:null,responseType:"text",type:L.PlaylistContextType.AUDIO_TRACK,url:o,deliveryDirectives:t})},c.onSubtitleTrackLoading=function(e,s){var l=s.id,f=s.groupId,o=s.url,t=s.deliveryDirectives;this.load({id:l,groupId:f,level:null,responseType:"text",type:L.PlaylistContextType.SUBTITLE_TRACK,url:o,deliveryDirectives:t})},c.load=function(e){var s,l=this.hls.config,f=this.getInternalLoader(e);if(f){var o=f.context;if(o&&o.url===e.url){b.logger.trace("[playlist-loader]: playlist request ongoing");return}b.logger.log("[playlist-loader]: aborting previous loader for type: "+e.type),f.abort()}var t,n,E,h;switch(e.type){case L.PlaylistContextType.MANIFEST:t=l.manifestLoadingMaxRetry,n=l.manifestLoadingTimeOut,E=l.manifestLoadingRetryDelay,h=l.manifestLoadingMaxRetryTimeout;break;case L.PlaylistContextType.LEVEL:case L.PlaylistContextType.AUDIO_TRACK:case L.PlaylistContextType.SUBTITLE_TRACK:t=0,n=l.levelLoadingTimeOut;break;default:t=l.levelLoadingMaxRetry,n=l.levelLoadingTimeOut,E=l.levelLoadingRetryDelay,h=l.levelLoadingMaxRetryTimeout;break}if(f=this.createInternalLoader(e),(s=e.deliveryDirectives)!==null&&s!==void 0&&s.part){var d;if(e.type===L.PlaylistContextType.LEVEL&&e.level!==null?d=this.hls.levels[e.level].details:e.type===L.PlaylistContextType.AUDIO_TRACK&&e.id!==null?d=this.hls.audioTracks[e.id].details:e.type===L.PlaylistContextType.SUBTITLE_TRACK&&e.id!==null&&(d=this.hls.subtitleTracks[e.id].details),d){var u=d.partTarget,r=d.targetduration;u&&r&&(n=Math.min(Math.max(u*3,r*.8)*1e3,n))}}var a={timeout:n,maxRetry:t,retryDelay:E,maxRetryDelay:h,highWaterMark:0},v={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};f.load(e,a,v)},c.loadsuccess=function(e,s,l,f){if(f===void 0&&(f=null),l.isSidxRequest){this.handleSidxRequest(e,l),this.handlePlaylistLoaded(e,s,l,f);return}this.resetInternalLoader(l.type);var o=e.data;if(o.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(e,l,"no EXTM3U delimiter",f);return}s.parsing.start=performance.now(),o.indexOf("#EXTINF:")>0||o.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(e,s,l,f):this.handleMasterPlaylist(e,s,l,f)},c.loaderror=function(e,s,l){l===void 0&&(l=null),this.handleNetworkError(s,l,!1,e)},c.loadtimeout=function(e,s,l){l===void 0&&(l=null),this.handleNetworkError(s,l,!0)},c.handleMasterPlaylist=function(e,s,l,f){var o=this.hls,t=e.data,n=p(e,l),E=I.default.parseMasterPlaylist(t,n),h=E.levels,d=E.sessionData;if(!h.length){this.handleManifestParsingError(e,l,"no level found in manifest",f);return}var u=h.map(function(R){return{id:R.attrs.AUDIO,audioCodec:R.audioCodec}}),r=h.map(function(R){return{id:R.attrs.SUBTITLES,textCodec:R.textCodec}}),a=I.default.parseMasterPlaylistMedia(t,n,"AUDIO",u),v=I.default.parseMasterPlaylistMedia(t,n,"SUBTITLES",r),m=I.default.parseMasterPlaylistMedia(t,n,"CLOSED-CAPTIONS");if(a.length){var D=a.some(function(R){return!R.url});!D&&h[0].audioCodec&&!h[0].attrs.AUDIO&&(b.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),a.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new T.AttrList({}),bitrate:0,url:""}))}o.trigger(O.Events.MANIFEST_LOADED,{levels:h,audioTracks:a,subtitles:v,captions:m,url:n,stats:s,networkDetails:f,sessionData:d})},c.handleTrackOrLevelPlaylist=function(e,s,l,f){var o=this.hls,t=l.id,n=l.level,E=l.type,h=p(e,l),d=Object(M.isFiniteNumber)(t)?t:0,u=Object(M.isFiniteNumber)(n)?n:d,r=S(l),a=I.default.parseLevelPlaylist(e.data,h,u,r,d);if(!a.fragments.length){o.trigger(O.Events.ERROR,{type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:h,reason:"no fragments found in level",level:typeof l.level=="number"?l.level:void 0});return}if(E===L.PlaylistContextType.MANIFEST){var v={attrs:new T.AttrList({}),bitrate:0,details:a,name:"",url:h};o.trigger(O.Events.MANIFEST_LOADED,{levels:[v],audioTracks:[],url:h,stats:s,networkDetails:f,sessionData:null})}if(s.parsing.end=performance.now(),a.needSidxRanges){var m,D=(m=a.fragments[0].initSegment)===null||m===void 0?void 0:m.url;this.load({url:D,isSidxRequest:!0,type:E,level:n,levelDetails:a,id:t,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}l.levelDetails=a,this.handlePlaylistLoaded(e,s,l,f)},c.handleSidxRequest=function(e,s){var l=Object(P.parseSegmentIndex)(new Uint8Array(e.data));if(!!l){var f=l.references,o=s.levelDetails;f.forEach(function(t,n){var E=t.info,h=o.fragments[n];h.byteRange.length===0&&h.setByteRange(String(1+E.end-E.start)+"@"+String(E.start)),h.initSegment&&h.initSegment.setByteRange(String(l.moovEndOffset)+"@0")})}},c.handleManifestParsingError=function(e,s,l,f){this.hls.trigger(O.Events.ERROR,{type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:s.type===L.PlaylistContextType.MANIFEST,url:e.url,reason:l,response:e,context:s,networkDetails:f})},c.handleNetworkError=function(e,s,l,f){l===void 0&&(l=!1),b.logger.warn("[playlist-loader]: A network "+(l?"timeout":"error")+" occurred while loading "+e.type+" level: "+e.level+" id: "+e.id+' group-id: "'+e.groupId+'"');var o=A.ErrorDetails.UNKNOWN,t=!1,n=this.getInternalLoader(e);switch(e.type){case L.PlaylistContextType.MANIFEST:o=l?A.ErrorDetails.MANIFEST_LOAD_TIMEOUT:A.ErrorDetails.MANIFEST_LOAD_ERROR,t=!0;break;case L.PlaylistContextType.LEVEL:o=l?A.ErrorDetails.LEVEL_LOAD_TIMEOUT:A.ErrorDetails.LEVEL_LOAD_ERROR,t=!1;break;case L.PlaylistContextType.AUDIO_TRACK:o=l?A.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:A.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,t=!1;break;case L.PlaylistContextType.SUBTITLE_TRACK:o=l?A.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:A.ErrorDetails.SUBTITLE_LOAD_ERROR,t=!1;break}n&&this.resetInternalLoader(e.type);var E={type:A.ErrorTypes.NETWORK_ERROR,details:o,fatal:t,url:e.url,loader:n,context:e,networkDetails:s};f&&(E.response=f),this.hls.trigger(O.Events.ERROR,E)},c.handlePlaylistLoaded=function(e,s,l,f){var o=l.type,t=l.level,n=l.id,E=l.groupId,h=l.loader,d=l.levelDetails,u=l.deliveryDirectives;if(!(d!=null&&d.targetduration)){this.handleManifestParsingError(e,l,"invalid target duration",f);return}if(!!h)switch(d.live&&(h.getCacheAge&&(d.ageHeader=h.getCacheAge()||0),(!h.getCacheAge||isNaN(d.ageHeader))&&(d.ageHeader=0)),o){case L.PlaylistContextType.MANIFEST:case L.PlaylistContextType.LEVEL:this.hls.trigger(O.Events.LEVEL_LOADED,{details:d,level:t||0,id:n||0,stats:s,networkDetails:f,deliveryDirectives:u});break;case L.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(O.Events.AUDIO_TRACK_LOADED,{details:d,id:n||0,groupId:E||"",stats:s,networkDetails:f,deliveryDirectives:u});break;case L.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(O.Events.SUBTITLE_TRACK_LOADED,{details:d,id:n||0,groupId:E||"",stats:s,networkDetails:f,deliveryDirectives:u});break}},g}();C.default=y},"./src/polyfills/number.ts":function(j,C,x){x.r(C),x.d(C,"isFiniteNumber",function(){return M}),x.d(C,"MAX_SAFE_INTEGER",function(){return O});var M=Number.isFinite||function(A){return typeof A=="number"&&isFinite(A)},O=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(j,C,x){x.r(C);var M=function(){function O(){}return O.getSilentFrame=function(b,P){switch(b){case"mp4a.40.2":if(P===1)return new Uint8Array([0,200,0,128,35,128]);if(P===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(P===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(P===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(P===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(P===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(P===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(P===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(P===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},O}();C.default=M},"./src/remux/mp4-generator.ts":function(j,C,x){x.r(C);var M=Math.pow(2,32)-1,O=function(){function A(){}return A.init=function(){A.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var P;for(P in A.types)A.types.hasOwnProperty(P)&&(A.types[P]=[P.charCodeAt(0),P.charCodeAt(1),P.charCodeAt(2),P.charCodeAt(3)]);var I=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),L=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);A.HDLR_TYPES={video:I,audio:L};var T=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),S=new Uint8Array([0,0,0,0,0,0,0,0]);A.STTS=A.STSC=A.STCO=S,A.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),A.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),A.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),A.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var p=new Uint8Array([105,115,111,109]),y=new Uint8Array([97,118,99,49]),g=new Uint8Array([0,0,0,1]);A.FTYP=A.box(A.types.ftyp,p,g,p,y),A.DINF=A.box(A.types.dinf,A.box(A.types.dref,T))},A.box=function(P){for(var I=8,L=arguments.length,T=new Array(L>1?L-1:0),S=1;S<L;S++)T[S-1]=arguments[S];for(var p=T.length,y=p;p--;)I+=T[p].byteLength;var g=new Uint8Array(I);for(g[0]=I>>24&255,g[1]=I>>16&255,g[2]=I>>8&255,g[3]=I&255,g.set(P,4),p=0,I=8;p<y;p++)g.set(T[p],I),I+=T[p].byteLength;return g},A.hdlr=function(P){return A.box(A.types.hdlr,A.HDLR_TYPES[P])},A.mdat=function(P){return A.box(A.types.mdat,P)},A.mdhd=function(P,I){I*=P;var L=Math.floor(I/(M+1)),T=Math.floor(I%(M+1));return A.box(A.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,P>>24&255,P>>16&255,P>>8&255,P&255,L>>24,L>>16&255,L>>8&255,L&255,T>>24,T>>16&255,T>>8&255,T&255,85,196,0,0]))},A.mdia=function(P){return A.box(A.types.mdia,A.mdhd(P.timescale,P.duration),A.hdlr(P.type),A.minf(P))},A.mfhd=function(P){return A.box(A.types.mfhd,new Uint8Array([0,0,0,0,P>>24,P>>16&255,P>>8&255,P&255]))},A.minf=function(P){return P.type==="audio"?A.box(A.types.minf,A.box(A.types.smhd,A.SMHD),A.DINF,A.stbl(P)):A.box(A.types.minf,A.box(A.types.vmhd,A.VMHD),A.DINF,A.stbl(P))},A.moof=function(P,I,L){return A.box(A.types.moof,A.mfhd(P),A.traf(L,I))},A.moov=function(P){for(var I=P.length,L=[];I--;)L[I]=A.trak(P[I]);return A.box.apply(null,[A.types.moov,A.mvhd(P[0].timescale,P[0].duration)].concat(L).concat(A.mvex(P)))},A.mvex=function(P){for(var I=P.length,L=[];I--;)L[I]=A.trex(P[I]);return A.box.apply(null,[A.types.mvex].concat(L))},A.mvhd=function(P,I){I*=P;var L=Math.floor(I/(M+1)),T=Math.floor(I%(M+1)),S=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,P>>24&255,P>>16&255,P>>8&255,P&255,L>>24,L>>16&255,L>>8&255,L&255,T>>24,T>>16&255,T>>8&255,T&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return A.box(A.types.mvhd,S)},A.sdtp=function(P){var I=P.samples||[],L=new Uint8Array(4+I.length),T,S;for(T=0;T<I.length;T++)S=I[T].flags,L[T+4]=S.dependsOn<<4|S.isDependedOn<<2|S.hasRedundancy;return A.box(A.types.sdtp,L)},A.stbl=function(P){return A.box(A.types.stbl,A.stsd(P),A.box(A.types.stts,A.STTS),A.box(A.types.stsc,A.STSC),A.box(A.types.stsz,A.STSZ),A.box(A.types.stco,A.STCO))},A.avc1=function(P){var I=[],L=[],T,S,p;for(T=0;T<P.sps.length;T++)S=P.sps[T],p=S.byteLength,I.push(p>>>8&255),I.push(p&255),I=I.concat(Array.prototype.slice.call(S));for(T=0;T<P.pps.length;T++)S=P.pps[T],p=S.byteLength,L.push(p>>>8&255),L.push(p&255),L=L.concat(Array.prototype.slice.call(S));var y=A.box(A.types.avcC,new Uint8Array([1,I[3],I[4],I[5],255,224|P.sps.length].concat(I).concat([P.pps.length]).concat(L))),g=P.width,c=P.height,i=P.pixelRatio[0],e=P.pixelRatio[1];return A.box(A.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,g>>8&255,g&255,c>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),y,A.box(A.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),A.box(A.types.pasp,new Uint8Array([i>>24,i>>16&255,i>>8&255,i&255,e>>24,e>>16&255,e>>8&255,e&255])))},A.esds=function(P){var I=P.config.length;return new Uint8Array([0,0,0,0,3,23+I,0,1,0,4,15+I,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([I]).concat(P.config).concat([6,1,2]))},A.mp4a=function(P){var I=P.samplerate;return A.box(A.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,P.channelCount,0,16,0,0,0,0,I>>8&255,I&255,0,0]),A.box(A.types.esds,A.esds(P)))},A.mp3=function(P){var I=P.samplerate;return A.box(A.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,P.channelCount,0,16,0,0,0,0,I>>8&255,I&255,0,0]))},A.stsd=function(P){return P.type==="audio"?P.segmentCodec==="mp3"&&P.codec==="mp3"?A.box(A.types.stsd,A.STSD,A.mp3(P)):A.box(A.types.stsd,A.STSD,A.mp4a(P)):A.box(A.types.stsd,A.STSD,A.avc1(P))},A.tkhd=function(P){var I=P.id,L=P.duration*P.timescale,T=P.width,S=P.height,p=Math.floor(L/(M+1)),y=Math.floor(L%(M+1));return A.box(A.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,I>>24&255,I>>16&255,I>>8&255,I&255,0,0,0,0,p>>24,p>>16&255,p>>8&255,p&255,y>>24,y>>16&255,y>>8&255,y&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,T>>8&255,T&255,0,0,S>>8&255,S&255,0,0]))},A.traf=function(P,I){var L=A.sdtp(P),T=P.id,S=Math.floor(I/(M+1)),p=Math.floor(I%(M+1));return A.box(A.types.traf,A.box(A.types.tfhd,new Uint8Array([0,0,0,0,T>>24,T>>16&255,T>>8&255,T&255])),A.box(A.types.tfdt,new Uint8Array([1,0,0,0,S>>24,S>>16&255,S>>8&255,S&255,p>>24,p>>16&255,p>>8&255,p&255])),A.trun(P,L.length+16+20+8+16+8+8),L)},A.trak=function(P){return P.duration=P.duration||4294967295,A.box(A.types.trak,A.tkhd(P),A.mdia(P))},A.trex=function(P){var I=P.id;return A.box(A.types.trex,new Uint8Array([0,0,0,0,I>>24,I>>16&255,I>>8&255,I&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},A.trun=function(P,I){var L=P.samples||[],T=L.length,S=12+16*T,p=new Uint8Array(S),y,g,c,i,e,s;for(I+=8+S,p.set([0,0,15,1,T>>>24&255,T>>>16&255,T>>>8&255,T&255,I>>>24&255,I>>>16&255,I>>>8&255,I&255],0),y=0;y<T;y++)g=L[y],c=g.duration,i=g.size,e=g.flags,s=g.cts,p.set([c>>>24&255,c>>>16&255,c>>>8&255,c&255,i>>>24&255,i>>>16&255,i>>>8&255,i&255,e.isLeading<<2|e.dependsOn,e.isDependedOn<<6|e.hasRedundancy<<4|e.paddingValue<<1|e.isNonSync,e.degradPrio&240<<8,e.degradPrio&15,s>>>24&255,s>>>16&255,s>>>8&255,s&255],12+16*y);return A.box(A.types.trun,p)},A.initSegment=function(P){A.types||A.init();var I=A.moov(P),L=new Uint8Array(A.FTYP.byteLength+I.byteLength);return L.set(A.FTYP),L.set(I,A.FTYP.byteLength),L},A}();O.types=void 0,O.HDLR_TYPES=void 0,O.STTS=void 0,O.STSC=void 0,O.STCO=void 0,O.STSZ=void 0,O.VMHD=void 0,O.SMHD=void 0,O.STSD=void 0,O.FTYP=void 0,O.DINF=void 0,C.default=O},"./src/remux/mp4-remuxer.ts":function(j,C,x){x.r(C),x.d(C,"default",function(){return s}),x.d(C,"normalizePts",function(){return l}),x.d(C,"flushTextTrackMetadataCueSamples",function(){return o}),x.d(C,"flushTextTrackUserdataCueSamples",function(){return t});var M=x("./src/polyfills/number.ts"),O=x("./src/remux/aac-helper.ts"),A=x("./src/remux/mp4-generator.ts"),b=x("./src/events.ts"),P=x("./src/errors.ts"),I=x("./src/utils/logger.ts"),L=x("./src/types/loader.ts"),T=x("./src/utils/timescale-conversion.ts");function S(){return S=Object.assign?Object.assign.bind():function(h){for(var d=1;d<arguments.length;d++){var u=arguments[d];for(var r in u)Object.prototype.hasOwnProperty.call(u,r)&&(h[r]=u[r])}return h},S.apply(this,arguments)}var p=10*1e3,y=1024,g=1152,c=null,i=null,e=!1,s=function(){function h(u,r,a,v){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=u,this.config=r,this.typeSupported=a,this.ISGenerated=!1,c===null){var m=navigator.userAgent||"",D=m.match(/Chrome\/(\d+)/i);c=D?parseInt(D[1]):0}if(i===null){var R=navigator.userAgent.match(/Safari\/(\d+)/i);i=R?parseInt(R[1]):0}e=!(!!c&&c>=75||!!i&&i>=600)}var d=h.prototype;return d.destroy=function(){},d.resetTimeStamp=function(r){I.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=r},d.resetNextTimestamp=function(){I.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},d.resetInitSegment=function(){I.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},d.getVideoStartPts=function(r){var a=!1,v=r.reduce(function(m,D){var R=D.pts-m;return R<-4294967296?(a=!0,l(m,D.pts)):R>0?m:D.pts},r[0].pts);return a&&I.logger.debug("PTS rollover detected"),v},d.remux=function(r,a,v,m,D,R,F,_){var B,U,N,k,w,K,W=D,H=D,G=r.pid>-1,Y=a.pid>-1,Q=a.samples.length,z=r.samples.length>0,V=F&&Q>0||Q>1,X=(!G||z)&&(!Y||V)||this.ISGenerated||F;if(X){this.ISGenerated||(N=this.generateIS(r,a,D));var J=this.isVideoContiguous,$=-1,Z;if(V&&($=f(a.samples),!J&&this.config.forceKeyFrameOnDiscontinuity))if(K=!0,$>0){I.logger.warn("[mp4-remuxer]: Dropped "+$+" out of "+Q+" video samples due to a missing keyframe");var q=this.getVideoStartPts(a.samples);a.samples=a.samples.slice($),a.dropped+=$,H+=(a.samples[0].pts-q)/a.inputTimeScale,Z=H}else $===-1&&(I.logger.warn("[mp4-remuxer]: No keyframe found out of "+Q+" video samples"),K=!1);if(this.ISGenerated){if(z&&V){var ee=this.getVideoStartPts(a.samples),re=l(r.samples[0].pts,ee)-ee,te=re/a.inputTimeScale;W+=Math.max(0,te),H+=Math.max(0,-te)}if(z){if(r.samplerate||(I.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),N=this.generateIS(r,a,D)),U=this.remuxAudio(r,W,this.isAudioContiguous,R,Y||V||_===L.PlaylistLevelType.AUDIO?H:void 0),V){var se=U?U.endPTS-U.startPTS:0;a.inputTimeScale||(I.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),N=this.generateIS(r,a,D)),B=this.remuxVideo(a,H,J,se)}}else V&&(B=this.remuxVideo(a,H,J,0));B&&(B.firstKeyFrame=$,B.independent=$!==-1,B.firstKeyFramePTS=Z)}}return this.ISGenerated&&(v.samples.length&&(w=o(v,D,this._initPTS,this._initDTS)),m.samples.length&&(k=t(m,D,this._initPTS))),{audio:U,video:B,initSegment:N,independent:K,text:k,id3:w}},d.generateIS=function(r,a,v){var m=r.samples,D=a.samples,R=this.typeSupported,F={},_=!Object(M.isFiniteNumber)(this._initPTS),B="audio/mp4",U,N,k;if(_&&(U=N=1/0),r.config&&m.length){switch(r.timescale=r.samplerate,r.segmentCodec){case"mp3":R.mpeg?(B="audio/mpeg",r.codec=""):R.mp3&&(r.codec="mp3");break}F.audio={id:"audio",container:B,codec:r.codec,initSegment:r.segmentCodec==="mp3"&&R.mpeg?new Uint8Array(0):A.default.initSegment([r]),metadata:{channelCount:r.channelCount}},_&&(k=r.inputTimeScale,U=N=m[0].pts-Math.round(k*v))}if(a.sps&&a.pps&&D.length&&(a.timescale=a.inputTimeScale,F.video={id:"main",container:"video/mp4",codec:a.codec,initSegment:A.default.initSegment([a]),metadata:{width:a.width,height:a.height}},_)){k=a.inputTimeScale;var w=this.getVideoStartPts(D),K=Math.round(k*v);N=Math.min(N,l(D[0].dts,w)-K),U=Math.min(U,w-K)}if(Object.keys(F).length)return this.ISGenerated=!0,_&&(this._initPTS=U,this._initDTS=N),{tracks:F,initPTS:U,timescale:k}},d.remuxVideo=function(r,a,v,m){var D=r.inputTimeScale,R=r.samples,F=[],_=R.length,B=this._initPTS,U=this.nextAvcDts,N=8,k=this.videoSampleDuration,w,K,W=Number.POSITIVE_INFINITY,H=Number.NEGATIVE_INFINITY,G=0,Y=!1;if(!v||U===null){var Q=a*D,z=R[0].pts-l(R[0].dts,R[0].pts);U=Q-z}for(var V=0;V<_;V++){var X=R[V];if(X.pts=l(X.pts-B,U),X.dts=l(X.dts-B,U),X.dts>X.pts){var J=18e3;G=Math.max(Math.min(G,X.pts-X.dts),-1*J)}X.dts<R[V>0?V-1:V].dts&&(Y=!0)}Y&&R.sort(function(Me,Be){var We=Me.dts-Be.dts,Ge=Me.pts-Be.pts;return We||Ge}),w=R[0].dts,K=R[R.length-1].dts;var $=K-w,Z=$?Math.round($/(_-1)):k||r.inputTimeScale/30;if(G<0){if(G<Z*-2){I.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(T.toMsFromMpegTsClock)(-Z,!0)+" ms");for(var q=G,ee=0;ee<_;ee++)R[ee].dts=q=Math.max(q,R[ee].pts-Z),R[ee].pts=Math.max(q,R[ee].pts)}else{I.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(T.toMsFromMpegTsClock)(G,!0)+" ms to overcome this issue");for(var re=0;re<_;re++)R[re].dts=R[re].dts+G}w=R[0].dts}if(v){var te=w-U,se=te>Z,ue=te<-1;if(se||ue){se?I.logger.warn("AVC: "+Object(T.toMsFromMpegTsClock)(te,!0)+" ms ("+te+"dts) hole between fragments detected, filling it"):I.logger.warn("AVC: "+Object(T.toMsFromMpegTsClock)(-te,!0)+" ms ("+te+"dts) overlapping between fragments detected"),w=U;var fe=R[0].pts-te;R[0].dts=w,R[0].pts=fe,I.logger.log("Video: First PTS/DTS adjusted: "+Object(T.toMsFromMpegTsClock)(fe,!0)+"/"+Object(T.toMsFromMpegTsClock)(w,!0)+", delta: "+Object(T.toMsFromMpegTsClock)(te,!0)+" ms")}}e&&(w=Math.max(0,w));for(var ne=0,ye=0,de=0;de<_;de++){for(var oe=R[de],ge=oe.units,pe=ge.length,me=0,ie=0;ie<pe;ie++)me+=ge[ie].data.length;ye+=me,ne+=pe,oe.length=me,oe.dts=Math.max(oe.dts,w),oe.pts=Math.max(oe.pts,oe.dts,0),W=Math.min(oe.pts,W),H=Math.max(oe.pts,H)}K=R[_-1].dts;var le=ye+4*ne+8,he;try{he=new Uint8Array(le)}catch{this.observer.emit(b.Events.ERROR,b.Events.ERROR,{type:P.ErrorTypes.MUX_ERROR,details:P.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:le,reason:"fail allocating video mdat "+le});return}var ce=new DataView(he.buffer);ce.setUint32(0,le),he.set(A.default.types.mdat,4);for(var Te=!1,ae=0;ae<_;ae++){for(var ve=R[ae],Se=ve.units,De=0,Le=0,xe=Se.length;Le<xe;Le++){var Re=Se[Le],Ie=Re.data,Ae=Re.data.byteLength;ce.setUint32(N,Ae),N+=4,he.set(Ie,N),N+=Ae,De+=4+Ae}if(ae<_-1)k=R[ae+1].dts-ve.dts;else{var Pe=this.config,Oe=ae>0?ve.dts-R[ae-1].dts:Z;if(Pe.stretchShortVideoTrack&&this.nextAudioPts!==null){var Ue=Math.floor(Pe.maxBufferHole*D),Ce=(m?W+m*D:this.nextAudioPts)-ve.pts;Ce>Ue?(k=Ce-Oe,k<0?k=Oe:Te=!0,I.logger.log("[mp4-remuxer]: It is approximately "+Ce/90+" ms to the next segment; using duration "+k/90+" ms for the last video frame.")):k=Oe}else k=Oe}var Ne=Math.round(ve.pts-ve.dts);F.push(new n(ve.key,k,De,Ne))}if(F.length&&c&&c<70){var Fe=F[0].flags;Fe.dependsOn=2,Fe.isNonSync=0}console.assert(k!==null,"mp4SampleDuration must be computed"),k=Te||!k?Z:k,this.nextAvcDts=U=K+k,this.videoSampleDuration=k,this.isVideoContiguous=!0;var ke=A.default.moof(r.sequenceNumber++,w,S({},r,{samples:F})),we="video",Ke={data1:ke,data2:he,startPTS:W/D,endPTS:(H+k)/D,startDTS:w/D,endDTS:U/D,type:we,hasAudio:!1,hasVideo:!0,nb:F.length,dropped:r.dropped};return r.samples=[],r.dropped=0,console.assert(he.length,"MDAT length must not be zero"),Ke},d.remuxAudio=function(r,a,v,m,D){var R=r.inputTimeScale,F=r.samplerate?r.samplerate:R,_=R/F,B=r.segmentCodec==="aac"?y:g,U=B*_,N=this._initPTS,k=r.segmentCodec==="mp3"&&this.typeSupported.mpeg,w=[],K=D!==void 0,W=r.samples,H=k?0:8,G=this.nextAudioPts||-1,Y=a*R;if(this.isAudioContiguous=v=v||W.length&&G>0&&(m&&Math.abs(Y-G)<9e3||Math.abs(l(W[0].pts-N,Y)-G)<20*U),W.forEach(function(xe){xe.pts=l(xe.pts-N,Y)}),!v||G<0){if(W=W.filter(function(xe){return xe.pts>=0}),!W.length)return;D===0?G=0:m&&!K?G=Math.max(0,Y):G=W[0].pts}if(r.segmentCodec==="aac")for(var Q=this.config.maxAudioFramesDrift,z=0,V=G;z<W.length;z++){var X=W[z],J=X.pts,$=J-V,Z=Math.abs(1e3*$/R);if($<=-Q*U&&K)z===0&&(I.logger.warn("Audio frame @ "+(J/R).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*$/R)+" ms."),this.nextAudioPts=G=V=J);else if($>=Q*U&&Z<p&&K){var q=Math.round($/U);V=J-q*U,V<0&&(q--,V+=U),z===0&&(this.nextAudioPts=G=V),I.logger.warn("[mp4-remuxer]: Injecting "+q+" audio frame @ "+(V/R).toFixed(3)+"s due to "+Math.round(1e3*$/R)+" ms gap.");for(var ee=0;ee<q;ee++){var re=Math.max(V,0),te=O.default.getSilentFrame(r.manifestCodec||r.codec,r.channelCount);te||(I.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),te=X.unit.subarray()),W.splice(z,0,{unit:te,pts:re}),V+=U,z++}}X.pts=V,V+=U}for(var se=null,ue=null,fe,ne=0,ye=W.length;ye--;)ne+=W[ye].unit.byteLength;for(var de=0,oe=W.length;de<oe;de++){var ge=W[de],pe=ge.unit,me=ge.pts;if(ue!==null){var ie=w[de-1];ie.duration=Math.round((me-ue)/_)}else if(v&&r.segmentCodec==="aac"&&(me=G),se=me,ne>0){ne+=H;try{fe=new Uint8Array(ne)}catch{this.observer.emit(b.Events.ERROR,b.Events.ERROR,{type:P.ErrorTypes.MUX_ERROR,details:P.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ne,reason:"fail allocating audio mdat "+ne});return}if(!k){var le=new DataView(fe.buffer);le.setUint32(0,ne),fe.set(A.default.types.mdat,4)}}else return;fe.set(pe,H);var he=pe.byteLength;H+=he,w.push(new n(!0,B,he,0)),ue=me}var ce=w.length;if(!!ce){var Te=w[w.length-1];this.nextAudioPts=G=ue+_*Te.duration;var ae=k?new Uint8Array(0):A.default.moof(r.sequenceNumber++,se/_,S({},r,{samples:w}));r.samples=[];var ve=se/R,Se=G/R,De="audio",Le={data1:ae,data2:fe,startPTS:ve,endPTS:Se,startDTS:ve,endDTS:Se,type:De,hasAudio:!0,hasVideo:!1,nb:ce};return this.isAudioContiguous=!0,console.assert(fe.length,"MDAT length must not be zero"),Le}},d.remuxEmptyAudio=function(r,a,v,m){var D=r.inputTimeScale,R=r.samplerate?r.samplerate:D,F=D/R,_=this.nextAudioPts,B=(_!==null?_:m.startDTS*D)+this._initDTS,U=m.endDTS*D+this._initDTS,N=F*y,k=Math.ceil((U-B)/N),w=O.default.getSilentFrame(r.manifestCodec||r.codec,r.channelCount);if(I.logger.warn("[mp4-remuxer]: remux empty Audio"),!w){I.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var K=[],W=0;W<k;W++){var H=B+W*N;K.push({unit:w,pts:H,dts:H})}return r.samples=K,this.remuxAudio(r,a,v,!1)},h}();function l(h,d){var u;if(d===null)return h;for(d<h?u=-8589934592:u=8589934592;Math.abs(h-d)>4294967296;)h+=u;return h}function f(h){for(var d=0;d<h.length;d++)if(h[d].key)return d;return-1}function o(h,d,u,r){var a=h.samples.length;if(!!a){for(var v=h.inputTimeScale,m=0;m<a;m++){var D=h.samples[m];D.pts=l(D.pts-u,d*v)/v,D.dts=l(D.dts-r,d*v)/v}var R=h.samples;return h.samples=[],{samples:R}}}function t(h,d,u){var r=h.samples.length;if(!!r){for(var a=h.inputTimeScale,v=0;v<r;v++){var m=h.samples[v];m.pts=l(m.pts-u,d*a)/a}h.samples.sort(function(R,F){return R.pts-F.pts});var D=h.samples;return h.samples=[],{samples:D}}}var n=function(d,u,r,a){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=u,this.size=r,this.cts=a,this.flags=new E(d)},E=function(d){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=d?2:1,this.isNonSync=d?0:1}},"./src/remux/passthrough-remuxer.ts":function(j,C,x){x.r(C);var M=x("./src/polyfills/number.ts"),O=x("./src/remux/mp4-remuxer.ts"),A=x("./src/utils/mp4-tools.ts"),b=x("./src/loader/fragment.ts"),P=x("./src/utils/logger.ts"),I=function(){function S(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var p=S.prototype;return p.destroy=function(){},p.resetTimeStamp=function(g){this.initPTS=g,this.lastEndDTS=null},p.resetNextTimestamp=function(){this.lastEndDTS=null},p.resetInitSegment=function(g,c,i){this.audioCodec=c,this.videoCodec=i,this.generateInitSegment(g),this.emitInitSegment=!0},p.generateInitSegment=function(g){var c=this.audioCodec,i=this.videoCodec;if(!g||!g.byteLength){this.initTracks=void 0,this.initData=void 0;return}var e=this.initData=Object(A.parseInitSegment)(g);c||(c=T(e.audio,b.ElementaryStreamTypes.AUDIO)),i||(i=T(e.video,b.ElementaryStreamTypes.VIDEO));var s={};e.audio&&e.video?s.audiovideo={container:"video/mp4",codec:c+","+i,initSegment:g,id:"main"}:e.audio?s.audio={container:"audio/mp4",codec:c,initSegment:g,id:"audio"}:e.video?s.video={container:"video/mp4",codec:i,initSegment:g,id:"main"}:P.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=s},p.remux=function(g,c,i,e,s){var l,f=this.initPTS,o=this.lastEndDTS,t={audio:void 0,video:void 0,text:e,id3:i,initSegment:void 0};Object(M.isFiniteNumber)(o)||(o=this.lastEndDTS=s||0);var n=c.samples;if(!n||!n.length)return t;var E={initPTS:void 0,timescale:1},h=this.initData;if((!h||!h.length)&&(this.generateInitSegment(n),h=this.initData),!h||!h.length)return P.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),t;this.emitInitSegment&&(E.tracks=this.initTracks,this.emitInitSegment=!1),Object(M.isFiniteNumber)(f)||(this.initPTS=E.initPTS=f=L(h,n,o));var d=Object(A.getDuration)(n,h),u=o,r=d+u;Object(A.offsetStartDTS)(h,n,f),d>0?this.lastEndDTS=r:(P.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var a=!!h.audio,v=!!h.video,m="";a&&(m+="audio"),v&&(m+="video");var D={data1:n,startPTS:u,startDTS:u,endPTS:r,endDTS:r,type:m,hasAudio:a,hasVideo:v,nb:1,dropped:0};t.audio=D.type==="audio"?D:void 0,t.video=D.type!=="audio"?D:void 0,t.initSegment=E;var R=(l=this.initPTS)!=null?l:0;return t.id3=Object(O.flushTextTrackMetadataCueSamples)(i,s,R,R),e.samples.length&&(t.text=Object(O.flushTextTrackUserdataCueSamples)(e,s,R)),t},S}(),L=function(p,y,g){return Object(A.getStartDTS)(p,y)-g};function T(S,p){var y=S==null?void 0:S.codec;return y&&y.length>4?y:y==="hvc1"||y==="hev1"?"hvc1.1.c.L120.90":y==="av01"?"av01.0.04M.08":y==="avc1"||p===b.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}C.default=I},"./src/task-loop.ts":function(j,C,x){x.r(C),x.d(C,"default",function(){return M});var M=function(){function O(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var A=O.prototype;return A.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},A.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},A.onHandlerDestroyed=function(){},A.hasInterval=function(){return!!this._tickInterval},A.hasNextTick=function(){return!!this._tickTimer},A.setInterval=function(P){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,P),!0)},A.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},A.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},A.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},A.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},A.doTick=function(){},O}()},"./src/types/cmcd.ts":function(j,C,x){x.r(C),x.d(C,"CMCDVersion",function(){return M}),x.d(C,"CMCDObjectType",function(){return O}),x.d(C,"CMCDStreamingFormat",function(){return A}),x.d(C,"CMCDStreamType",function(){return b});var M=1,O;(function(P){P.MANIFEST="m",P.AUDIO="a",P.VIDEO="v",P.MUXED="av",P.INIT="i",P.CAPTION="c",P.TIMED_TEXT="tt",P.KEY="k",P.OTHER="o"})(O||(O={}));var A;(function(P){P.DASH="d",P.HLS="h",P.SMOOTH="s",P.OTHER="o"})(A||(A={}));var b;(function(P){P.VOD="v",P.LIVE="l"})(b||(b={}))},"./src/types/demuxer.ts":function(j,C,x){x.r(C),x.d(C,"MetadataSchema",function(){return M});var M;(function(O){O.audioId3="org.id3",O.dateRange="com.apple.quicktime.HLS",O.emsg="https://aomedia.org/emsg/ID3"})(M||(M={}))},"./src/types/level.ts":function(j,C,x){x.r(C),x.d(C,"HlsSkip",function(){return A}),x.d(C,"getSkipValue",function(){return b}),x.d(C,"HlsUrlParameters",function(){return P}),x.d(C,"Level",function(){return I});function M(L,T){for(var S=0;S<T.length;S++){var p=T[S];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(L,p.key,p)}}function O(L,T,S){return T&&M(L.prototype,T),S&&M(L,S),Object.defineProperty(L,"prototype",{writable:!1}),L}var A;(function(L){L.No="",L.Yes="YES",L.v2="v2"})(A||(A={}));function b(L,T){var S=L.canSkipUntil,p=L.canSkipDateRanges,y=L.endSN,g=T!==void 0?T-y:0;return S&&g<S?p?A.v2:A.Yes:A.No}var P=function(){function L(S,p,y){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=S,this.part=p,this.skip=y}var T=L.prototype;return T.addDirectives=function(p){var y=new self.URL(p);return this.msn!==void 0&&y.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&y.searchParams.set("_HLS_part",this.part.toString()),this.skip&&y.searchParams.set("_HLS_skip",this.skip),y.toString()},L}(),I=function(){function L(T){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[T.url],this.attrs=T.attrs,this.bitrate=T.bitrate,T.details&&(this.details=T.details),this.id=T.id||0,this.name=T.name,this.width=T.width||0,this.height=T.height||0,this.audioCodec=T.audioCodec,this.videoCodec=T.videoCodec,this.unknownCodecs=T.unknownCodecs,this.codecSet=[T.videoCodec,T.audioCodec].filter(function(S){return S}).join(",").replace(/\.[^.,]+/g,"")}return O(L,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(S){var p=S%this.url.length;this._urlId!==p&&(this.details=void 0,this._urlId=p)}}]),L}()},"./src/types/loader.ts":function(j,C,x){x.r(C),x.d(C,"PlaylistContextType",function(){return M}),x.d(C,"PlaylistLevelType",function(){return O});var M;(function(A){A.MANIFEST="manifest",A.LEVEL="level",A.AUDIO_TRACK="audioTrack",A.SUBTITLE_TRACK="subtitleTrack"})(M||(M={}));var O;(function(A){A.MAIN="main",A.AUDIO="audio",A.SUBTITLE="subtitle"})(O||(O={}))},"./src/types/transmuxer.ts":function(j,C,x){x.r(C),x.d(C,"ChunkMetadata",function(){return M});var M=function(b,P,I,L,T,S){L===void 0&&(L=0),T===void 0&&(T=-1),S===void 0&&(S=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=O(),this.buffering={audio:O(),video:O(),audiovideo:O()},this.level=b,this.sn=P,this.id=I,this.size=L,this.part=T,this.partial=S};function O(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":function(j,C,x){x.r(C),x.d(C,"AttrList",function(){return A});var M=/^(\d+)x(\d+)$/,O=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,A=function(){function b(I){typeof I=="string"&&(I=b.parseAttrList(I));for(var L in I)I.hasOwnProperty(L)&&(this[L]=I[L])}var P=b.prototype;return P.decimalInteger=function(L){var T=parseInt(this[L],10);return T>Number.MAX_SAFE_INTEGER?1/0:T},P.hexadecimalInteger=function(L){if(this[L]){var T=(this[L]||"0x").slice(2);T=(T.length&1?"0":"")+T;for(var S=new Uint8Array(T.length/2),p=0;p<T.length/2;p++)S[p]=parseInt(T.slice(p*2,p*2+2),16);return S}else return null},P.hexadecimalIntegerAsNumber=function(L){var T=parseInt(this[L],16);return T>Number.MAX_SAFE_INTEGER?1/0:T},P.decimalFloatingPoint=function(L){return parseFloat(this[L])},P.optionalFloat=function(L,T){var S=this[L];return S?parseFloat(S):T},P.enumeratedString=function(L){return this[L]},P.bool=function(L){return this[L]==="YES"},P.decimalResolution=function(L){var T=M.exec(this[L]);if(T!==null)return{width:parseInt(T[1],10),height:parseInt(T[2],10)}},b.parseAttrList=function(L){var T,S={},p='"';for(O.lastIndex=0;(T=O.exec(L))!==null;){var y=T[2];y.indexOf(p)===0&&y.lastIndexOf(p)===y.length-1&&(y=y.slice(1,-1)),S[T[1]]=y}return S},b}()},"./src/utils/binary-search.ts":function(j,C,x){x.r(C);var M={search:function(A,b){for(var P=0,I=A.length-1,L=null,T=null;P<=I;){L=(P+I)/2|0,T=A[L];var S=b(T);if(S>0)P=L+1;else if(S<0)I=L-1;else return T}return null}};C.default=M},"./src/utils/buffer-helper.ts":function(j,C,x){x.r(C),x.d(C,"BufferHelper",function(){return A});var M=x("./src/utils/logger.ts"),O={length:0,start:function(){return 0},end:function(){return 0}},A=function(){function b(){}return b.isBuffered=function(I,L){try{if(I){for(var T=b.getBuffered(I),S=0;S<T.length;S++)if(L>=T.start(S)&&L<=T.end(S))return!0}}catch{}return!1},b.bufferInfo=function(I,L,T){try{if(I){var S=b.getBuffered(I),p=[],y;for(y=0;y<S.length;y++)p.push({start:S.start(y),end:S.end(y)});return this.bufferedInfo(p,L,T)}}catch{}return{len:0,start:L,end:L,nextStart:void 0}},b.bufferedInfo=function(I,L,T){L=Math.max(0,L),I.sort(function(t,n){var E=t.start-n.start;return E||n.end-t.end});var S=[];if(T)for(var p=0;p<I.length;p++){var y=S.length;if(y){var g=S[y-1].end;I[p].start-g<T?I[p].end>g&&(S[y-1].end=I[p].end):S.push(I[p])}else S.push(I[p])}else S=I;for(var c=0,i,e=L,s=L,l=0;l<S.length;l++){var f=S[l].start,o=S[l].end;if(L+T>=f&&L<o)e=f,s=o,c=s-L;else if(L+T<f){i=f;break}}return{len:c,start:e||0,end:s||0,nextStart:i}},b.getBuffered=function(I){try{return I.buffered}catch(L){return M.logger.log("failed to get media.buffered",L),O}},b}()},"./src/utils/cea-608-parser.ts":function(j,C,x){x.r(C),x.d(C,"Row",function(){return s}),x.d(C,"CaptionScreen",function(){return l});var M=x("./src/utils/logger.ts"),O={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},A=function(d){var u=d;return O.hasOwnProperty(d)&&(u=O[d]),String.fromCharCode(u)},b=15,P=100,I={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},L={17:2,18:4,21:6,22:8,23:10,19:13,20:15},T={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},S={25:2,26:4,29:6,30:8,31:10,27:13,28:15},p=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],y;(function(h){h[h.ERROR=0]="ERROR",h[h.TEXT=1]="TEXT",h[h.WARNING=2]="WARNING",h[h.INFO=2]="INFO",h[h.DEBUG=3]="DEBUG",h[h.DATA=3]="DATA"})(y||(y={}));var g=function(){function h(){this.time=null,this.verboseLevel=y.ERROR}var d=h.prototype;return d.log=function(r,a){this.verboseLevel>=r&&M.logger.log(this.time+" ["+r+"] "+a)},h}(),c=function(d){for(var u=[],r=0;r<d.length;r++)u.push(d[r].toString(16));return u},i=function(){function h(u,r,a,v,m){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=u||"white",this.underline=r||!1,this.italics=a||!1,this.background=v||"black",this.flash=m||!1}var d=h.prototype;return d.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},d.setStyles=function(r){for(var a=["foreground","underline","italics","background","flash"],v=0;v<a.length;v++){var m=a[v];r.hasOwnProperty(m)&&(this[m]=r[m])}},d.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},d.equals=function(r){return this.foreground===r.foreground&&this.underline===r.underline&&this.italics===r.italics&&this.background===r.background&&this.flash===r.flash},d.copy=function(r){this.foreground=r.foreground,this.underline=r.underline,this.italics=r.italics,this.background=r.background,this.flash=r.flash},d.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},h}(),e=function(){function h(u,r,a,v,m,D){this.uchar=void 0,this.penState=void 0,this.uchar=u||" ",this.penState=new i(r,a,v,m,D)}var d=h.prototype;return d.reset=function(){this.uchar=" ",this.penState.reset()},d.setChar=function(r,a){this.uchar=r,this.penState.copy(a)},d.setPenState=function(r){this.penState.copy(r)},d.equals=function(r){return this.uchar===r.uchar&&this.penState.equals(r.penState)},d.copy=function(r){this.uchar=r.uchar,this.penState.copy(r.penState)},d.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},h}(),s=function(){function h(u){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var r=0;r<P;r++)this.chars.push(new e);this.logger=u,this.pos=0,this.currPenState=new i}var d=h.prototype;return d.equals=function(r){for(var a=!0,v=0;v<P;v++)if(!this.chars[v].equals(r.chars[v])){a=!1;break}return a},d.copy=function(r){for(var a=0;a<P;a++)this.chars[a].copy(r.chars[a])},d.isEmpty=function(){for(var r=!0,a=0;a<P;a++)if(!this.chars[a].isEmpty()){r=!1;break}return r},d.setCursor=function(r){this.pos!==r&&(this.pos=r),this.pos<0?(this.logger.log(y.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>P&&(this.logger.log(y.DEBUG,"Too large cursor position "+this.pos),this.pos=P)},d.moveCursor=function(r){var a=this.pos+r;if(r>1)for(var v=this.pos+1;v<a+1;v++)this.chars[v].setPenState(this.currPenState);this.setCursor(a)},d.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},d.insertChar=function(r){r>=144&&this.backSpace();var a=A(r);if(this.pos>=P){this.logger.log(y.ERROR,"Cannot insert "+r.toString(16)+" ("+a+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(a,this.currPenState),this.moveCursor(1)},d.clearFromPos=function(r){var a;for(a=r;a<P;a++)this.chars[a].reset()},d.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},d.clearToEndOfRow=function(){this.clearFromPos(this.pos)},d.getTextString=function(){for(var r=[],a=!0,v=0;v<P;v++){var m=this.chars[v].uchar;m!==" "&&(a=!1),r.push(m)}return a?"":r.join("")},d.setPenStyles=function(r){this.currPenState.setStyles(r);var a=this.chars[this.pos];a.setPenState(this.currPenState)},h}(),l=function(){function h(u){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var r=0;r<b;r++)this.rows.push(new s(u));this.logger=u,this.currRow=b-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var d=h.prototype;return d.reset=function(){for(var r=0;r<b;r++)this.rows[r].clear();this.currRow=b-1},d.equals=function(r){for(var a=!0,v=0;v<b;v++)if(!this.rows[v].equals(r.rows[v])){a=!1;break}return a},d.copy=function(r){for(var a=0;a<b;a++)this.rows[a].copy(r.rows[a])},d.isEmpty=function(){for(var r=!0,a=0;a<b;a++)if(!this.rows[a].isEmpty()){r=!1;break}return r},d.backSpace=function(){var r=this.rows[this.currRow];r.backSpace()},d.clearToEndOfRow=function(){var r=this.rows[this.currRow];r.clearToEndOfRow()},d.insertChar=function(r){var a=this.rows[this.currRow];a.insertChar(r)},d.setPen=function(r){var a=this.rows[this.currRow];a.setPenStyles(r)},d.moveCursor=function(r){var a=this.rows[this.currRow];a.moveCursor(r)},d.setCursor=function(r){this.logger.log(y.INFO,"setCursor: "+r);var a=this.rows[this.currRow];a.setCursor(r)},d.setPAC=function(r){this.logger.log(y.INFO,"pacData = "+JSON.stringify(r));var a=r.row-1;if(this.nrRollUpRows&&a<this.nrRollUpRows-1&&(a=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==a){for(var v=0;v<b;v++)this.rows[v].clear();var m=this.currRow+1-this.nrRollUpRows,D=this.lastOutputScreen;if(D){var R=D.rows[m].cueStartTime,F=this.logger.time;if(R&&F!==null&&R<F)for(var _=0;_<this.nrRollUpRows;_++)this.rows[a-this.nrRollUpRows+_+1].copy(D.rows[m+_])}}this.currRow=a;var B=this.rows[this.currRow];if(r.indent!==null){var U=r.indent,N=Math.max(U-1,0);B.setCursor(r.indent),r.color=B.chars[N].penState.foreground}var k={foreground:r.color,underline:r.underline,italics:r.italics,background:"black",flash:!1};this.setPen(k)},d.setBkgData=function(r){this.logger.log(y.INFO,"bkgData = "+JSON.stringify(r)),this.backSpace(),this.setPen(r),this.insertChar(32)},d.setRollUpRows=function(r){this.nrRollUpRows=r},d.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(y.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(y.TEXT,this.getDisplayText());var r=this.currRow+1-this.nrRollUpRows,a=this.rows.splice(r,1)[0];a.clear(),this.rows.splice(this.currRow,0,a),this.logger.log(y.INFO,"Rolling up")},d.getDisplayText=function(r){r=r||!1;for(var a=[],v="",m=-1,D=0;D<b;D++){var R=this.rows[D].getTextString();R&&(m=D+1,r?a.push("Row "+m+": '"+R+"'"):a.push(R.trim()))}return a.length>0&&(r?v="["+a.join(" | ")+"]":v=a.join(`
`)),v},d.getTextAndFormat=function(){return this.rows},h}(),f=function(){function h(u,r,a){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=u,this.outputFilter=r,this.mode=null,this.verbose=0,this.displayedMemory=new l(a),this.nonDisplayedMemory=new l(a),this.lastOutputScreen=new l(a),this.currRollUpRow=this.displayedMemory.rows[b-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=a}var d=h.prototype;return d.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[b-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},d.getHandler=function(){return this.outputFilter},d.setHandler=function(r){this.outputFilter=r},d.setPAC=function(r){this.writeScreen.setPAC(r)},d.setBkgData=function(r){this.writeScreen.setBkgData(r)},d.setMode=function(r){r!==this.mode&&(this.mode=r,this.logger.log(y.INFO,"MODE="+r),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=r)},d.insertChars=function(r){for(var a=0;a<r.length;a++)this.writeScreen.insertChar(r[a]);var v=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(y.INFO,v+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(y.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},d.ccRCL=function(){this.logger.log(y.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},d.ccBS=function(){this.logger.log(y.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},d.ccAOF=function(){},d.ccAON=function(){},d.ccDER=function(){this.logger.log(y.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},d.ccRU=function(r){this.logger.log(y.INFO,"RU("+r+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(r)},d.ccFON=function(){this.logger.log(y.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},d.ccRDC=function(){this.logger.log(y.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},d.ccTR=function(){this.logger.log(y.INFO,"TR"),this.setMode("MODE_TEXT")},d.ccRTD=function(){this.logger.log(y.INFO,"RTD"),this.setMode("MODE_TEXT")},d.ccEDM=function(){this.logger.log(y.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},d.ccCR=function(){this.logger.log(y.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},d.ccENM=function(){this.logger.log(y.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},d.ccEOC=function(){if(this.logger.log(y.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var r=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=r,this.writeScreen=this.nonDisplayedMemory,this.logger.log(y.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},d.ccTO=function(r){this.logger.log(y.INFO,"TO("+r+") - Tab Offset"),this.writeScreen.moveCursor(r)},d.ccMIDROW=function(r){var a={flash:!1};if(a.underline=r%2===1,a.italics=r>=46,a.italics)a.foreground="white";else{var v=Math.floor(r/2)-16,m=["white","green","blue","cyan","red","yellow","magenta"];a.foreground=m[v]}this.logger.log(y.INFO,"MIDROW: "+JSON.stringify(a)),this.writeScreen.setPen(a)},d.outputDataUpdate=function(r){r===void 0&&(r=!1);var a=this.logger.time;a!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=a:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,a,this.lastOutputScreen),r&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:a),this.lastOutputScreen.copy(this.displayedMemory))},d.cueSplitAtTime=function(r){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,r,this.displayedMemory),this.cueStartTime=r))},h}(),o=function(){function h(u,r,a){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var v=new g;this.channels=[null,new f(u,r,v),new f(u+1,a,v)],this.cmdHistory=E(),this.logger=v}var d=h.prototype;return d.getHandler=function(r){return this.channels[r].getHandler()},d.setHandler=function(r,a){this.channels[r].setHandler(a)},d.addData=function(r,a){var v,m,D,R=!1;this.logger.time=r;for(var F=0;F<a.length;F+=2)if(m=a[F]&127,D=a[F+1]&127,!(m===0&&D===0)){if(this.logger.log(y.DATA,"["+c([a[F],a[F+1]])+"] -> ("+c([m,D])+")"),v=this.parseCmd(m,D),v||(v=this.parseMidrow(m,D)),v||(v=this.parsePAC(m,D)),v||(v=this.parseBackgroundAttributes(m,D)),!v&&(R=this.parseChars(m,D),R)){var _=this.currentChannel;if(_&&_>0){var B=this.channels[_];B.insertChars(R)}else this.logger.log(y.WARNING,"No channel found yet. TEXT-MODE?")}!v&&!R&&this.logger.log(y.WARNING,"Couldn't parse cleaned data "+c([m,D])+" orig: "+c([a[F],a[F+1]]))}},d.parseCmd=function(r,a){var v=this.cmdHistory,m=(r===20||r===28||r===21||r===29)&&a>=32&&a<=47,D=(r===23||r===31)&&a>=33&&a<=35;if(!(m||D))return!1;if(n(r,a,v))return t(null,null,v),this.logger.log(y.DEBUG,"Repeated command ("+c([r,a])+") is dropped"),!0;var R=r===20||r===21||r===23?1:2,F=this.channels[R];return r===20||r===21||r===28||r===29?a===32?F.ccRCL():a===33?F.ccBS():a===34?F.ccAOF():a===35?F.ccAON():a===36?F.ccDER():a===37?F.ccRU(2):a===38?F.ccRU(3):a===39?F.ccRU(4):a===40?F.ccFON():a===41?F.ccRDC():a===42?F.ccTR():a===43?F.ccRTD():a===44?F.ccEDM():a===45?F.ccCR():a===46?F.ccENM():a===47&&F.ccEOC():F.ccTO(a-32),t(r,a,v),this.currentChannel=R,!0},d.parseMidrow=function(r,a){var v=0;if((r===17||r===25)&&a>=32&&a<=47){if(r===17?v=1:v=2,v!==this.currentChannel)return this.logger.log(y.ERROR,"Mismatch channel in midrow parsing"),!1;var m=this.channels[v];return m?(m.ccMIDROW(a),this.logger.log(y.DEBUG,"MIDROW ("+c([r,a])+")"),!0):!1}return!1},d.parsePAC=function(r,a){var v,m=this.cmdHistory,D=(r>=17&&r<=23||r>=25&&r<=31)&&a>=64&&a<=127,R=(r===16||r===24)&&a>=64&&a<=95;if(!(D||R))return!1;if(n(r,a,m))return t(null,null,m),!0;var F=r<=23?1:2;a>=64&&a<=95?v=F===1?I[r]:T[r]:v=F===1?L[r]:S[r];var _=this.channels[F];return _?(_.setPAC(this.interpretPAC(v,a)),t(r,a,m),this.currentChannel=F,!0):!1},d.interpretPAC=function(r,a){var v,m={color:null,italics:!1,indent:null,underline:!1,row:r};return a>95?v=a-96:v=a-64,m.underline=(v&1)===1,v<=13?m.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(v/2)]:v<=15?(m.italics=!0,m.color="white"):m.indent=Math.floor((v-16)/2)*4,m},d.parseChars=function(r,a){var v,m=null,D=null;if(r>=25?(v=2,D=r-8):(v=1,D=r),D>=17&&D<=19){var R;D===17?R=a+80:D===18?R=a+112:R=a+144,this.logger.log(y.INFO,"Special char '"+A(R)+"' in channel "+v),m=[R]}else r>=32&&r<=127&&(m=a===0?[r]:[r,a]);if(m){var F=c(m);this.logger.log(y.DEBUG,"Char codes =  "+F.join(",")),t(r,a,this.cmdHistory)}return m},d.parseBackgroundAttributes=function(r,a){var v=(r===16||r===24)&&a>=32&&a<=47,m=(r===23||r===31)&&a>=45&&a<=47;if(!(v||m))return!1;var D,R={};r===16||r===24?(D=Math.floor((a-32)/2),R.background=p[D],a%2===1&&(R.background=R.background+"_semi")):a===45?R.background="transparent":(R.foreground="black",a===47&&(R.underline=!0));var F=r<=23?1:2,_=this.channels[F];return _.setBkgData(R),t(r,a,this.cmdHistory),!0},d.reset=function(){for(var r=0;r<Object.keys(this.channels).length;r++){var a=this.channels[r];a&&a.reset()}this.cmdHistory=E()},d.cueSplitAtTime=function(r){for(var a=0;a<this.channels.length;a++){var v=this.channels[a];v&&v.cueSplitAtTime(r)}},h}();function t(h,d,u){u.a=h,u.b=d}function n(h,d,u){return u.a===h&&u.b===d}function E(){return{a:null,b:null}}C.default=o},"./src/utils/codecs.ts":function(j,C,x){x.r(C),x.d(C,"isCodecType",function(){return O}),x.d(C,"isCodecSupportedInMp4",function(){return A});var M={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function O(b,P){var I=M[P];return!!I&&I[b.slice(0,4)]===!0}function A(b,P){return MediaSource.isTypeSupported((P||"video")+'/mp4;codecs="'+b+'"')}},"./src/utils/cues.ts":function(j,C,x){x.r(C);var M=x("./src/utils/vttparser.ts"),O=x("./src/utils/webvtt-parser.ts"),A=x("./src/utils/texttrack-utils.ts"),b=/\s/,P={newCue:function(L,T,S,p){for(var y=[],g,c,i,e,s,l=self.VTTCue||self.TextTrackCue,f=0;f<p.rows.length;f++)if(g=p.rows[f],i=!0,e=0,s="",!g.isEmpty()){for(var o=0;o<g.chars.length;o++)b.test(g.chars[o].uchar)&&i?e++:(s+=g.chars[o].uchar,i=!1);g.cueStartTime=T,T===S&&(S+=1e-4),e>=16?e--:e++;var t=Object(M.fixLineBreaks)(s.trim()),n=Object(O.generateCueId)(T,S,t);(!L||!L.cues||!L.cues.getCueById(n))&&(c=new l(T,S,t),c.id=n,c.line=f+1,c.align="left",c.position=10+Math.min(80,Math.floor(e*8/32)*10),y.push(c))}return L&&y.length&&(y.sort(function(E,h){return E.line==="auto"||h.line==="auto"?0:E.line>8&&h.line>8?h.line-E.line:E.line-h.line}),y.forEach(function(E){return Object(A.addCueToTrack)(L,E)})),y}};C.default=P},"./src/utils/discontinuities.ts":function(j,C,x){x.r(C),x.d(C,"findFirstFragWithCC",function(){return b}),x.d(C,"shouldAlignOnDiscontinuities",function(){return P}),x.d(C,"findDiscontinuousReferenceFrag",function(){return I}),x.d(C,"adjustSlidingStart",function(){return T}),x.d(C,"alignStream",function(){return S}),x.d(C,"alignPDT",function(){return y}),x.d(C,"alignFragmentByPDTDelta",function(){return g}),x.d(C,"alignMediaPlaylistByPDT",function(){return c});var M=x("./src/polyfills/number.ts"),O=x("./src/utils/logger.ts"),A=x("./src/controller/level-helper.ts");function b(i,e){for(var s=null,l=0,f=i.length;l<f;l++){var o=i[l];if(o&&o.cc===e){s=o;break}}return s}function P(i,e,s){return!!(e.details&&(s.endCC>s.startCC||i&&i.cc<s.startCC))}function I(i,e){var s=i.fragments,l=e.fragments;if(!l.length||!s.length){O.logger.log("No fragments to align");return}var f=b(s,l[0].cc);if(!f||f&&!f.startPTS){O.logger.log("No frag in previous level to align on");return}return f}function L(i,e){if(i){var s=i.start+e;i.start=i.startPTS=s,i.endPTS=s+i.duration}}function T(i,e){for(var s=e.fragments,l=0,f=s.length;l<f;l++)L(s[l],i);e.fragmentHint&&L(e.fragmentHint,i),e.alignedSliding=!0}function S(i,e,s){!e||(p(i,s,e),!s.alignedSliding&&e.details&&y(s,e.details),!s.alignedSliding&&e.details&&!s.skippedSegments&&Object(A.adjustSliding)(e.details,s))}function p(i,e,s){if(P(i,s,e)){var l=I(s.details,e);l&&Object(M.isFiniteNumber)(l.start)&&(O.logger.log("Adjusting PTS using last level due to CC increase within current level "+e.url),T(l.start,e))}}function y(i,e){if(!(!e.fragments.length||!i.hasProgramDateTime||!e.hasProgramDateTime)){var s=e.fragments[0].programDateTime,l=i.fragments[0].programDateTime,f=(l-s)/1e3+e.fragments[0].start;f&&Object(M.isFiniteNumber)(f)&&(O.logger.log("Adjusting PTS using programDateTime delta "+(l-s)+"ms, sliding:"+f.toFixed(3)+" "+i.url+" "),T(f,i))}}function g(i,e){var s=i.programDateTime;if(!!s){var l=(s-e)/1e3;i.start=i.startPTS=l,i.endPTS=l+i.duration}}function c(i,e){if(!(!e.fragments.length||!i.hasProgramDateTime||!e.hasProgramDateTime)){var s=e.fragments[0].programDateTime,l=e.fragments[0].start,f=s-l*1e3;i.fragments.forEach(function(o){g(o,f)}),i.fragmentHint&&g(i.fragmentHint,f),i.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function(j,C,x){x.r(C);var M=x("./src/utils/ewma.ts"),O=function(){function A(P,I,L){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=L,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new M.default(P),this.fast_=new M.default(I)}var b=A.prototype;return b.update=function(I,L){var T=this.slow_,S=this.fast_;this.slow_.halfLife!==I&&(this.slow_=new M.default(I,T.getEstimate(),T.getTotalWeight())),this.fast_.halfLife!==L&&(this.fast_=new M.default(L,S.getEstimate(),S.getTotalWeight()))},b.sample=function(I,L){I=Math.max(I,this.minDelayMs_);var T=8*L,S=I/1e3,p=T/S;this.fast_.sample(S,p),this.slow_.sample(S,p)},b.canEstimate=function(){var I=this.fast_;return I&&I.getTotalWeight()>=this.minWeight_},b.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},b.destroy=function(){},A}();C.default=O},"./src/utils/ewma.ts":function(j,C,x){x.r(C);var M=function(){function O(b,P,I){P===void 0&&(P=0),I===void 0&&(I=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=b,this.alpha_=b?Math.exp(Math.log(.5)/b):0,this.estimate_=P,this.totalWeight_=I}var A=O.prototype;return A.sample=function(P,I){var L=Math.pow(this.alpha_,P);this.estimate_=I*(1-L)+L*this.estimate_,this.totalWeight_+=P},A.getTotalWeight=function(){return this.totalWeight_},A.getEstimate=function(){if(this.alpha_){var P=1-Math.pow(this.alpha_,this.totalWeight_);if(P)return this.estimate_/P}return this.estimate_},O}();C.default=M},"./src/utils/fetch-loader.ts":function(j,C,x){x.r(C),x.d(C,"fetchSupported",function(){return g});var M=x("./src/polyfills/number.ts"),O=x("./src/loader/load-stats.ts"),A=x("./src/demux/chunk-cache.ts");function b(l,f){l.prototype=Object.create(f.prototype),l.prototype.constructor=l,S(l,f)}function P(l){var f=typeof Map=="function"?new Map:void 0;return P=function(t){if(t===null||!T(t))return t;if(typeof t!="function")throw new TypeError("Super expression must either be null or a function");if(typeof f!="undefined"){if(f.has(t))return f.get(t);f.set(t,n)}function n(){return I(t,arguments,p(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),S(n,t)},P(l)}function I(l,f,o){return L()?I=Reflect.construct.bind():I=function(n,E,h){var d=[null];d.push.apply(d,E);var u=Function.bind.apply(n,d),r=new u;return h&&S(r,h.prototype),r},I.apply(null,arguments)}function L(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function T(l){return Function.toString.call(l).indexOf("[native code]")!==-1}function S(l,f){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},S(l,f)}function p(l){return p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},p(l)}function y(){return y=Object.assign?Object.assign.bind():function(l){for(var f=1;f<arguments.length;f++){var o=arguments[f];for(var t in o)Object.prototype.hasOwnProperty.call(o,t)&&(l[t]=o[t])}return l},y.apply(this,arguments)}function g(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var c=function(){function l(o){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=o.fetchSetup||e,this.controller=new self.AbortController,this.stats=new O.LoadStats}var f=l.prototype;return f.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},f.abortInternal=function(){var t=this.response;(!t||!t.ok)&&(this.stats.aborted=!0,this.controller.abort())},f.abort=function(){var t;this.abortInternal(),(t=this.callbacks)!==null&&t!==void 0&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},f.load=function(t,n,E){var h=this,d=this.stats;if(d.loading.start)throw new Error("Loader can only be used once.");d.loading.start=self.performance.now();var u=i(t,this.controller.signal),r=E.onProgress,a=t.responseType==="arraybuffer",v=a?"byteLength":"length";this.context=t,this.config=n,this.callbacks=E,this.request=this.fetchSetup(t,u),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){h.abortInternal(),E.onTimeout(d,t,h.response)},n.timeout),self.fetch(this.request).then(function(m){if(h.response=h.loader=m,!m.ok){var D=m.status,R=m.statusText;throw new s(R||"fetch, bad network response",D,m)}return d.loading.first=Math.max(self.performance.now(),d.loading.start),d.total=parseInt(m.headers.get("Content-Length")||"0"),r&&Object(M.isFiniteNumber)(n.highWaterMark)?h.loadProgressively(m,d,t,n.highWaterMark,r):a?m.arrayBuffer():m.text()}).then(function(m){var D=h.response;self.clearTimeout(h.requestTimeout),d.loading.end=Math.max(self.performance.now(),d.loading.first),d.loaded=d.total=m[v];var R={url:D.url,data:m};r&&!Object(M.isFiniteNumber)(n.highWaterMark)&&r(d,t,m,D),E.onSuccess(R,d,t,D)}).catch(function(m){if(self.clearTimeout(h.requestTimeout),!d.aborted){var D=m&&m.code||0,R=m?m.message:null;E.onError({code:D,text:R},t,m?m.details:null)}})},f.getCacheAge=function(){var t=null;if(this.response){var n=this.response.headers.get("age");t=n?parseFloat(n):null}return t},f.loadProgressively=function(t,n,E,h,d){h===void 0&&(h=0);var u=new A.default,r=t.body.getReader(),a=function v(){return r.read().then(function(m){if(m.done)return u.dataLength&&d(n,E,u.flush(),t),Promise.resolve(new ArrayBuffer(0));var D=m.value,R=D.length;return n.loaded+=R,R<h||u.dataLength?(u.push(D),u.dataLength>=h&&d(n,E,u.flush(),t)):d(n,E,D,t),v()}).catch(function(){return Promise.reject()})};return a()},l}();function i(l,f){var o={method:"GET",mode:"cors",credentials:"same-origin",signal:f,headers:new self.Headers(y({},l.headers))};return l.rangeEnd&&o.headers.set("Range","bytes="+l.rangeStart+"-"+String(l.rangeEnd-1)),o}function e(l,f){return new self.Request(l.url,f)}var s=function(l){b(f,l);function f(o,t,n){var E;return E=l.call(this,o)||this,E.code=void 0,E.details=void 0,E.code=t,E.details=n,E}return f}(P(Error));C.default=c},"./src/utils/imsc1-ttml-parser.ts":function(j,C,x){x.r(C),x.d(C,"IMSC1_CODEC",function(){return T}),x.d(C,"parseIMSC1",function(){return g});var M=x("./src/utils/mp4-tools.ts"),O=x("./src/utils/vttparser.ts"),A=x("./src/utils/vttcue.ts"),b=x("./src/demux/id3.ts"),P=x("./src/utils/timescale-conversion.ts"),I=x("./src/utils/webvtt-parser.ts");function L(){return L=Object.assign?Object.assign.bind():function(h){for(var d=1;d<arguments.length;d++){var u=arguments[d];for(var r in u)Object.prototype.hasOwnProperty.call(u,r)&&(h[r]=u[r])}return h},L.apply(this,arguments)}var T="stpp.ttml.im1t",S=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,p=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,y={left:"start",center:"center",right:"end",start:"start",end:"end"};function g(h,d,u,r,a){var v=Object(M.findBox)(new Uint8Array(h),["mdat"]);if(v.length===0){a(new Error("Could not parse IMSC1 mdat"));return}var m=v.map(function(R){return Object(b.utf8ArrayToStr)(R)}),D=Object(P.toTimescaleFromScale)(d,1,u);try{m.forEach(function(R){return r(c(R,D))})}catch(R){a(R)}}function c(h,d){var u=new DOMParser,r=u.parseFromString(h,"text/xml"),a=r.getElementsByTagName("tt")[0];if(!a)throw new Error("Invalid ttml");var v={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},m=Object.keys(v).reduce(function(B,U){return B[U]=a.getAttribute("ttp:"+U)||v[U],B},{}),D=a.getAttribute("xml:space")!=="preserve",R=e(i(a,"styling","style")),F=e(i(a,"layout","region")),_=i(a,"body","[begin]");return[].map.call(_,function(B){var U=s(B,D);if(!U||!B.hasAttribute("begin"))return null;var N=t(B.getAttribute("begin"),m),k=t(B.getAttribute("dur"),m),w=t(B.getAttribute("end"),m);if(N===null)throw o(B);if(w===null){if(k===null)throw o(B);w=N+k}var K=new A.default(N-d,w-d,U);K.id=Object(I.generateCueId)(K.startTime,K.endTime,K.text);var W=F[B.getAttribute("region")],H=R[B.getAttribute("style")];K.position=10,K.size=80;var G=l(W,H,R),Y=G.textAlign;if(Y){var Q=y[Y];Q&&(K.lineAlign=Q),K.align=Y}return L(K,G),K}).filter(function(B){return B!==null})}function i(h,d,u){var r=h.getElementsByTagName(d)[0];return r?[].slice.call(r.querySelectorAll(u)):[]}function e(h){return h.reduce(function(d,u){var r=u.getAttribute("xml:id");return r&&(d[r]=u),d},{})}function s(h,d){return[].slice.call(h.childNodes).reduce(function(u,r,a){var v;return r.nodeName==="br"&&a?u+`
`:(v=r.childNodes)!==null&&v!==void 0&&v.length?s(r,d):d?u+r.textContent.trim().replace(/\s+/g," "):u+r.textContent},"")}function l(h,d,u){var r="http://www.w3.org/ns/ttml#styling",a=null,v=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],m=h!=null&&h.hasAttribute("style")?h.getAttribute("style"):null;return m&&u.hasOwnProperty(m)&&(a=u[m]),v.reduce(function(D,R){var F=f(d,r,R)||f(h,r,R)||f(a,r,R);return F&&(D[R]=F),D},{})}function f(h,d,u){return h&&h.hasAttributeNS(d,u)?h.getAttributeNS(d,u):null}function o(h){return new Error("Could not parse ttml timestamp "+h)}function t(h,d){if(!h)return null;var u=Object(O.parseTimeStamp)(h);return u===null&&(S.test(h)?u=n(h,d):p.test(h)&&(u=E(h,d))),u}function n(h,d){var u=S.exec(h),r=(u[4]|0)+(u[5]|0)/d.subFrameRate;return(u[1]|0)*3600+(u[2]|0)*60+(u[3]|0)+r/d.frameRate}function E(h,d){var u=p.exec(h),r=Number(u[1]),a=u[2];switch(a){case"h":return r*3600;case"m":return r*60;case"ms":return r*1e3;case"f":return r/d.frameRate;case"t":return r/d.tickRate}return r}},"./src/utils/logger.ts":function(j,C,x){x.r(C),x.d(C,"enableLogs",function(){return I}),x.d(C,"logger",function(){return L});var M=function(){},O={trace:M,debug:M,log:M,warn:M,info:M,error:M},A=O;function b(T){var S=self.console[T];return S?S.bind(self.console,"["+T+"] >"):M}function P(T){for(var S=arguments.length,p=new Array(S>1?S-1:0),y=1;y<S;y++)p[y-1]=arguments[y];p.forEach(function(g){A[g]=T[g]?T[g].bind(T):b(g)})}function I(T){if(self.console&&T===!0||typeof T=="object"){P(T,"debug","log","info","warn","error");try{A.log()}catch{A=O}}else A=O}var L=A},"./src/utils/mediakeys-helper.ts":function(j,C,x){x.r(C),x.d(C,"KeySystems",function(){return M}),x.d(C,"requestMediaKeySystemAccess",function(){return O});var M;(function(A){A.WIDEVINE="com.widevine.alpha",A.PLAYREADY="com.microsoft.playready"})(M||(M={}));var O=function(){return typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":function(j,C,x){x.r(C),x.d(C,"getMediaSource",function(){return M});function M(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":function(j,C,x){x.r(C),x.d(C,"RemuxerTrackIdConfig",function(){return I}),x.d(C,"bin2str",function(){return L}),x.d(C,"readUint16",function(){return T}),x.d(C,"readUint32",function(){return S}),x.d(C,"readSint32",function(){return p}),x.d(C,"writeUint32",function(){return y}),x.d(C,"findBox",function(){return g}),x.d(C,"parseSegmentIndex",function(){return c}),x.d(C,"parseInitSegment",function(){return i}),x.d(C,"getStartDTS",function(){return e}),x.d(C,"getDuration",function(){return s}),x.d(C,"computeRawDurationFromSamples",function(){return l}),x.d(C,"offsetStartDTS",function(){return f}),x.d(C,"segmentValidRange",function(){return o}),x.d(C,"appendUint8Array",function(){return t}),x.d(C,"parseSamples",function(){return n}),x.d(C,"parseSEIMessageFromNALu",function(){return d}),x.d(C,"parseEmsg",function(){return r});var M=x("./src/utils/typed-array.ts"),O=x("./src/loader/fragment.ts"),A=x("./src/demux/id3.ts"),b=Math.pow(2,32)-1,P=[].push,I={video:1,audio:2,id3:3,text:4};function L(a){return String.fromCharCode.apply(null,a)}function T(a,v){var m=a[v]<<8|a[v+1];return m<0?65536+m:m}function S(a,v){var m=p(a,v);return m<0?4294967296+m:m}function p(a,v){return a[v]<<24|a[v+1]<<16|a[v+2]<<8|a[v+3]}function y(a,v,m){a[v]=m>>24,a[v+1]=m>>16&255,a[v+2]=m>>8&255,a[v+3]=m&255}function g(a,v){var m=[];if(!v.length)return m;for(var D=a.byteLength,R=0;R<D;){var F=S(a,R),_=L(a.subarray(R+4,R+8)),B=F>1?R+F:D;if(_===v[0])if(v.length===1)m.push(a.subarray(R+8,B));else{var U=g(a.subarray(R+8,B),v.slice(1));U.length&&P.apply(m,U)}R=B}return m}function c(a){var v=g(a,["moov"]),m=v[0],D=m?m.length:null,R=g(a,["sidx"]);if(!R||!R[0])return null;var F=[],_=R[0],B=_[0],U=8,N=S(_,U);U+=4;var k=0,w=0;B===0?U+=8:U+=16,U+=2;var K=_.length+w,W=T(_,U);U+=2;for(var H=0;H<W;H++){var G=U,Y=S(_,G);G+=4;var Q=Y&2147483647,z=(Y&2147483648)>>>31;if(z===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var V=S(_,G);G+=4,F.push({referenceSize:Q,subsegmentDuration:V,info:{duration:V/N,start:K,end:K+Q-1}}),K+=Q,G+=4,U=G}return{earliestPresentationTime:k,timescale:N,version:B,referencesCount:W,references:F,moovEndOffset:D}}function i(a){for(var v=[],m=g(a,["moov","trak"]),D=0;D<m.length;D++){var R=m[D],F=g(R,["tkhd"])[0];if(F){var _=F[0],B=_===0?12:20,U=S(F,B),N=g(R,["mdia","mdhd"])[0];if(N){_=N[0],B=_===0?12:20;var k=S(N,B),w=g(R,["mdia","hdlr"])[0];if(w){var K=L(w.subarray(8,12)),W={soun:O.ElementaryStreamTypes.AUDIO,vide:O.ElementaryStreamTypes.VIDEO}[K];if(W){var H=g(R,["mdia","minf","stbl","stsd"])[0],G=void 0;H&&(G=L(H.subarray(12,16))),v[U]={timescale:k,type:W},v[W]={timescale:k,id:U,codec:G}}}}}}var Y=g(a,["moov","mvex","trex"]);return Y.forEach(function(Q){var z=S(Q,4),V=v[z];V&&(V.default={duration:S(Q,12),flags:S(Q,20)})}),v}function e(a,v){return g(v,["moof","traf"]).reduce(function(m,D){var R=g(D,["tfdt"])[0],F=R[0],_=g(D,["tfhd"]).reduce(function(B,U){var N=S(U,4),k=a[N];if(k){var w=S(R,4);F===1&&(w*=Math.pow(2,32),w+=S(R,8));var K=k.timescale||9e4,W=w/K;if(isFinite(W)&&(B===null||W<B))return W}return B},null);return _!==null&&isFinite(_)&&(m===null||_<m)?_:m},null)||0}function s(a,v){for(var m=0,D=0,R=0,F=g(a,["moof","traf"]),_=0;_<F.length;_++){var B=F[_],U=g(B,["tfhd"])[0],N=S(U,4),k=v[N];if(!!k){var w=k.default,K=S(U,0)|(w==null?void 0:w.flags),W=w==null?void 0:w.duration;K&8&&(K&2?W=S(U,12):W=S(U,8));for(var H=k.timescale||9e4,G=g(B,["trun"]),Y=0;Y<G.length;Y++){if(m=l(G[Y]),!m&&W){var Q=S(G[Y],4);m=W*Q}k.type===O.ElementaryStreamTypes.VIDEO?D+=m/H:k.type===O.ElementaryStreamTypes.AUDIO&&(R+=m/H)}}}if(D===0&&R===0){var z=c(a);if(z!=null&&z.references)return z.references.reduce(function(V,X){return V+X.info.duration||0},0)}return D||R}function l(a){var v=S(a,0),m=8;v&1&&(m+=4),v&4&&(m+=4);for(var D=0,R=S(a,4),F=0;F<R;F++){if(v&256){var _=S(a,m);D+=_,m+=4}v&512&&(m+=4),v&1024&&(m+=4),v&2048&&(m+=4)}return D}function f(a,v,m){g(v,["moof","traf"]).forEach(function(D){g(D,["tfhd"]).forEach(function(R){var F=S(R,4),_=a[F];if(!!_){var B=_.timescale||9e4;g(D,["tfdt"]).forEach(function(U){var N=U[0],k=S(U,4);if(N===0)k-=m*B,k=Math.max(k,0),y(U,4,k);else{k*=Math.pow(2,32),k+=S(U,8),k-=m*B,k=Math.max(k,0);var w=Math.floor(k/(b+1)),K=Math.floor(k%(b+1));y(U,4,w),y(U,8,K)}})}})})}function o(a){var v={valid:null,remainder:null},m=g(a,["moof"]);if(m){if(m.length<2)return v.remainder=a,v}else return v;var D=m[m.length-1];return v.valid=Object(M.sliceUint8)(a,0,D.byteOffset-8),v.remainder=Object(M.sliceUint8)(a,D.byteOffset-8),v}function t(a,v){var m=new Uint8Array(a.length+v.length);return m.set(a),m.set(v,a.length),m}function n(a,v){var m=[],D=v.samples,R=v.timescale,F=v.id,_=!1,B=g(D,["moof"]);return B.map(function(U){var N=U.byteOffset-8,k=g(U,["traf"]);k.map(function(w){var K=g(w,["tfdt"]).map(function(W){var H=W[0],G=S(W,4);return H===1&&(G*=Math.pow(2,32),G+=S(W,8)),G/R})[0];return K!==void 0&&(a=K),g(w,["tfhd"]).map(function(W){var H=S(W,4),G=S(W,0)&16777215,Y=(G&1)!==0,Q=(G&2)!==0,z=(G&8)!==0,V=0,X=(G&16)!==0,J=0,$=(G&32)!==0,Z=8;H===F&&(Y&&(Z+=8),Q&&(Z+=4),z&&(V=S(W,Z),Z+=4),X&&(J=S(W,Z),Z+=4),$&&(Z+=4),v.type==="video"&&(_=E(v.codec)),g(w,["trun"]).map(function(q){var ee=q[0],re=S(q,0)&16777215,te=(re&1)!==0,se=0,ue=(re&4)!==0,fe=(re&256)!==0,ne=0,ye=(re&512)!==0,de=0,oe=(re&1024)!==0,ge=(re&2048)!==0,pe=0,me=S(q,4),ie=8;te&&(se=S(q,ie),ie+=4),ue&&(ie+=4);for(var le=se+N,he=0;he<me;he++){if(fe?(ne=S(q,ie),ie+=4):ne=V,ye?(de=S(q,ie),ie+=4):de=J,oe&&(ie+=4),ge&&(ee===0?pe=S(q,ie):pe=p(q,ie),ie+=4),v.type===O.ElementaryStreamTypes.VIDEO)for(var ce=0;ce<de;){var Te=S(D,le);le+=4;var ae=D[le]&31;if(h(_,ae)){var ve=D.subarray(le,le+Te);d(ve,a+pe/R,m)}le+=Te,ce+=Te+4}a+=ne/R}}))})})}),m}function E(a){if(!a)return!1;var v=a.indexOf("."),m=v<0?a:a.substring(0,v);return m==="hvc1"||m==="hev1"||m==="dvh1"||m==="dvhe"}function h(a,v){return a?v===39||v===40:v===6}function d(a,v,m){var D=u(a),R=0;R++;for(var F=0,_=0,B=!1,U=0;R<D.length;){F=0;do{if(R>=D.length)break;U=D[R++],F+=U}while(U===255);_=0;do{if(R>=D.length)break;U=D[R++],_+=U}while(U===255);var N=D.length-R;if(!B&&F===4&&R<D.length){B=!0;var k=D[R++];if(k===181){var w=T(D,R);if(R+=2,w===49){var K=S(D,R);if(R+=4,K===1195456820){var W=D[R++];if(W===3){var H=D[R++],G=31&H,Y=64&H,Q=Y?2+G*3:0,z=new Uint8Array(Q);if(Y){z[0]=H;for(var V=1;V<Q;V++)z[V]=D[R++]}m.push({type:W,payloadType:F,pts:v,bytes:z})}}}}}else if(F===5&&_<N){if(B=!0,_>16){for(var X=[],J=0;J<16;J++){var $=D[R++].toString(16);X.push($.length==1?"0"+$:$),(J===3||J===5||J===7||J===9)&&X.push("-")}for(var Z=_-16,q=new Uint8Array(Z),ee=0;ee<Z;ee++)q[ee]=D[R++];m.push({payloadType:F,pts:v,uuid:X.join(""),userData:Object(A.utf8ArrayToStr)(q),userDataBytes:q})}}else if(_<N)R+=_;else if(_>N)break}}function u(a){for(var v=a.byteLength,m=[],D=1;D<v-2;)a[D]===0&&a[D+1]===0&&a[D+2]===3?(m.push(D+2),D+=2):D++;if(m.length===0)return a;var R=v-m.length,F=new Uint8Array(R),_=0;for(D=0;D<R;_++,D++)_===m[0]&&(_++,m.shift()),F[D]=a[_];return F}function r(a){var v=a[0],m="",D="",R=0,F=0,_=0,B=0,U=0,N=0;if(v===0){for(;L(a.subarray(N,N+1))!=="\0";)m+=L(a.subarray(N,N+1)),N+=1;for(m+=L(a.subarray(N,N+1)),N+=1;L(a.subarray(N,N+1))!=="\0";)D+=L(a.subarray(N,N+1)),N+=1;D+=L(a.subarray(N,N+1)),N+=1,R=S(a,12),F=S(a,16),B=S(a,20),U=S(a,24),N=28}else if(v===1){N+=4,R=S(a,N),N+=4;var k=S(a,N);N+=4;var w=S(a,N);for(N+=4,_=Math.pow(2,32)*k+w,Number.isSafeInteger(_)||(_=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),B=S(a,N),N+=4,U=S(a,N),N+=4;L(a.subarray(N,N+1))!=="\0";)m+=L(a.subarray(N,N+1)),N+=1;for(m+=L(a.subarray(N,N+1)),N+=1;L(a.subarray(N,N+1))!=="\0";)D+=L(a.subarray(N,N+1)),N+=1;D+=L(a.subarray(N,N+1)),N+=1}var K=a.subarray(N,a.byteLength);return{schemeIdUri:m,value:D,timeScale:R,presentationTime:_,presentationTimeDelta:F,eventDuration:B,id:U,payload:K}}},"./src/utils/output-filter.ts":function(j,C,x){x.r(C),x.d(C,"default",function(){return M});var M=function(){function O(b,P){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=b,this.trackName=P}var A=O.prototype;return A.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},A.newCue=function(P,I,L){(this.startTime===null||this.startTime>P)&&(this.startTime=P),this.endTime=I,this.screen=L,this.timelineController.createCaptionsTrack(this.trackName)},A.reset=function(){this.cueRanges=[],this.startTime=null},O}()},"./src/utils/texttrack-utils.ts":function(j,C,x){x.r(C),x.d(C,"sendAddTrackEvent",function(){return O}),x.d(C,"addCueToTrack",function(){return A}),x.d(C,"clearCurrentCues",function(){return b}),x.d(C,"removeCuesInRange",function(){return P}),x.d(C,"getCuesInRange",function(){return L});var M=x("./src/utils/logger.ts");function O(T,S){var p;try{p=new Event("addtrack")}catch{p=document.createEvent("Event"),p.initEvent("addtrack",!1,!1)}p.track=T,S.dispatchEvent(p)}function A(T,S){var p=T.mode;if(p==="disabled"&&(T.mode="hidden"),T.cues&&!T.cues.getCueById(S.id))try{if(T.addCue(S),!T.cues.getCueById(S.id))throw new Error("addCue is failed for: "+S)}catch(g){M.logger.debug("[texttrack-utils]: "+g);var y=new self.TextTrackCue(S.startTime,S.endTime,S.text);y.id=S.id,T.addCue(y)}p==="disabled"&&(T.mode=p)}function b(T){var S=T.mode;if(S==="disabled"&&(T.mode="hidden"),T.cues)for(var p=T.cues.length;p--;)T.removeCue(T.cues[p]);S==="disabled"&&(T.mode=S)}function P(T,S,p,y){var g=T.mode;if(g==="disabled"&&(T.mode="hidden"),T.cues&&T.cues.length>0)for(var c=L(T.cues,S,p),i=0;i<c.length;i++)(!y||y(c[i]))&&T.removeCue(c[i]);g==="disabled"&&(T.mode=g)}function I(T,S){if(S<T[0].startTime)return 0;var p=T.length-1;if(S>T[p].endTime)return-1;for(var y=0,g=p;y<=g;){var c=Math.floor((g+y)/2);if(S<T[c].startTime)g=c-1;else if(S>T[c].startTime&&y<p)y=c+1;else return c}return T[y].startTime-S<S-T[g].startTime?y:g}function L(T,S,p){var y=[],g=I(T,S);if(g>-1)for(var c=g,i=T.length;c<i;c++){var e=T[c];if(e.startTime>=S&&e.endTime<=p)y.push(e);else if(e.startTime>p)return y}return y}},"./src/utils/time-ranges.ts":function(j,C,x){x.r(C);var M={toString:function(A){for(var b="",P=A.length,I=0;I<P;I++)b+="["+A.start(I).toFixed(3)+","+A.end(I).toFixed(3)+"]";return b}};C.default=M},"./src/utils/timescale-conversion.ts":function(j,C,x){x.r(C),x.d(C,"toTimescaleFromBase",function(){return O}),x.d(C,"toTimescaleFromScale",function(){return A}),x.d(C,"toMsFromMpegTsClock",function(){return b}),x.d(C,"toMpegTsClockFromTimescale",function(){return P});var M=9e4;function O(I,L,T,S){T===void 0&&(T=1),S===void 0&&(S=!1);var p=I*L*T;return S?Math.round(p):p}function A(I,L,T,S){return T===void 0&&(T=1),S===void 0&&(S=!1),O(I,L,1/T,S)}function b(I,L){return L===void 0&&(L=!1),O(I,1e3,1/M,L)}function P(I,L){return L===void 0&&(L=1),O(I,M,1/L)}},"./src/utils/typed-array.ts":function(j,C,x){x.r(C),x.d(C,"sliceUint8",function(){return M});function M(O,A,b){return Uint8Array.prototype.slice?O.slice(A,b):new Uint8Array(Array.prototype.slice.call(O,A,b))}},"./src/utils/vttcue.ts":function(j,C,x){x.r(C),C.default=function(){if(typeof self!="undefined"&&self.VTTCue)return self.VTTCue;var M=["","lr","rl"],O=["start","middle","end","left","right"];function A(T,S){if(typeof S!="string"||!Array.isArray(T))return!1;var p=S.toLowerCase();return~T.indexOf(p)?p:!1}function b(T){return A(M,T)}function P(T){return A(O,T)}function I(T){for(var S=arguments.length,p=new Array(S>1?S-1:0),y=1;y<S;y++)p[y-1]=arguments[y];for(var g=1;g<arguments.length;g++){var c=arguments[g];for(var i in c)T[i]=c[i]}return T}function L(T,S,p){var y=this,g={enumerable:!0};y.hasBeenReset=!1;var c="",i=!1,e=T,s=S,l=p,f=null,o="",t=!0,n="auto",E="start",h=50,d="middle",u=50,r="middle";Object.defineProperty(y,"id",I({},g,{get:function(){return c},set:function(v){c=""+v}})),Object.defineProperty(y,"pauseOnExit",I({},g,{get:function(){return i},set:function(v){i=!!v}})),Object.defineProperty(y,"startTime",I({},g,{get:function(){return e},set:function(v){if(typeof v!="number")throw new TypeError("Start time must be set to a number.");e=v,this.hasBeenReset=!0}})),Object.defineProperty(y,"endTime",I({},g,{get:function(){return s},set:function(v){if(typeof v!="number")throw new TypeError("End time must be set to a number.");s=v,this.hasBeenReset=!0}})),Object.defineProperty(y,"text",I({},g,{get:function(){return l},set:function(v){l=""+v,this.hasBeenReset=!0}})),Object.defineProperty(y,"region",I({},g,{get:function(){return f},set:function(v){f=v,this.hasBeenReset=!0}})),Object.defineProperty(y,"vertical",I({},g,{get:function(){return o},set:function(v){var m=b(v);if(m===!1)throw new SyntaxError("An invalid or illegal string was specified.");o=m,this.hasBeenReset=!0}})),Object.defineProperty(y,"snapToLines",I({},g,{get:function(){return t},set:function(v){t=!!v,this.hasBeenReset=!0}})),Object.defineProperty(y,"line",I({},g,{get:function(){return n},set:function(v){if(typeof v!="number"&&v!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");n=v,this.hasBeenReset=!0}})),Object.defineProperty(y,"lineAlign",I({},g,{get:function(){return E},set:function(v){var m=P(v);if(!m)throw new SyntaxError("An invalid or illegal string was specified.");E=m,this.hasBeenReset=!0}})),Object.defineProperty(y,"position",I({},g,{get:function(){return h},set:function(v){if(v<0||v>100)throw new Error("Position must be between 0 and 100.");h=v,this.hasBeenReset=!0}})),Object.defineProperty(y,"positionAlign",I({},g,{get:function(){return d},set:function(v){var m=P(v);if(!m)throw new SyntaxError("An invalid or illegal string was specified.");d=m,this.hasBeenReset=!0}})),Object.defineProperty(y,"size",I({},g,{get:function(){return u},set:function(v){if(v<0||v>100)throw new Error("Size must be between 0 and 100.");u=v,this.hasBeenReset=!0}})),Object.defineProperty(y,"align",I({},g,{get:function(){return r},set:function(v){var m=P(v);if(!m)throw new SyntaxError("An invalid or illegal string was specified.");r=m,this.hasBeenReset=!0}})),y.displayState=void 0}return L.prototype.getCueAsHTML=function(){var T=self.WebVTT;return T.convertCueToDOMTree(self,this.text)},L}()},"./src/utils/vttparser.ts":function(j,C,x){x.r(C),x.d(C,"parseTimeStamp",function(){return A}),x.d(C,"fixLineBreaks",function(){return S}),x.d(C,"VTTParser",function(){return p});var M=x("./src/utils/vttcue.ts"),O=function(){function y(){}var g=y.prototype;return g.decode=function(i,e){if(!i)return"";if(typeof i!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(i))},y}();function A(y){function g(i,e,s,l){return(i|0)*3600+(e|0)*60+(s|0)+parseFloat(l||0)}var c=y.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return c?parseFloat(c[2])>59?g(c[2],c[3],0,c[4]):g(c[1],c[2],c[3],c[4]):null}var b=function(){function y(){this.values=Object.create(null)}var g=y.prototype;return g.set=function(i,e){!this.get(i)&&e!==""&&(this.values[i]=e)},g.get=function(i,e,s){return s?this.has(i)?this.values[i]:e[s]:this.has(i)?this.values[i]:e},g.has=function(i){return i in this.values},g.alt=function(i,e,s){for(var l=0;l<s.length;++l)if(e===s[l]){this.set(i,e);break}},g.integer=function(i,e){/^-?\d+$/.test(e)&&this.set(i,parseInt(e,10))},g.percent=function(i,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var s=parseFloat(e);if(s>=0&&s<=100)return this.set(i,s),!0}return!1},y}();function P(y,g,c,i){var e=i?y.split(i):[y];for(var s in e)if(typeof e[s]=="string"){var l=e[s].split(c);if(l.length===2){var f=l[0],o=l[1];g(f,o)}}}var I=new M.default(0,0,""),L=I.align==="middle"?"middle":"center";function T(y,g,c){var i=y;function e(){var f=A(y);if(f===null)throw new Error("Malformed timestamp: "+i);return y=y.replace(/^[^\sa-zA-Z-]+/,""),f}function s(f,o){var t=new b;P(f,function(h,d){var u;switch(h){case"region":for(var r=c.length-1;r>=0;r--)if(c[r].id===d){t.set(h,c[r].region);break}break;case"vertical":t.alt(h,d,["rl","lr"]);break;case"line":u=d.split(","),t.integer(h,u[0]),t.percent(h,u[0])&&t.set("snapToLines",!1),t.alt(h,u[0],["auto"]),u.length===2&&t.alt("lineAlign",u[1],["start",L,"end"]);break;case"position":u=d.split(","),t.percent(h,u[0]),u.length===2&&t.alt("positionAlign",u[1],["start",L,"end","line-left","line-right","auto"]);break;case"size":t.percent(h,d);break;case"align":t.alt(h,d,["start",L,"end","left","right"]);break}},/:/,/\s/),o.region=t.get("region",null),o.vertical=t.get("vertical","");var n=t.get("line","auto");n==="auto"&&I.line===-1&&(n=-1),o.line=n,o.lineAlign=t.get("lineAlign","start"),o.snapToLines=t.get("snapToLines",!0),o.size=t.get("size",100),o.align=t.get("align",L);var E=t.get("position","auto");E==="auto"&&I.position===50&&(E=o.align==="start"||o.align==="left"?0:o.align==="end"||o.align==="right"?100:50),o.position=E}function l(){y=y.replace(/^\s+/,"")}if(l(),g.startTime=e(),l(),y.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+i);y=y.slice(3),l(),g.endTime=e(),l(),s(y,g)}function S(y){return y.replace(/<br(?: \/)?>/gi,`
`)}var p=function(){function y(){this.state="INITIAL",this.buffer="",this.decoder=new O,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var g=y.prototype;return g.parse=function(i){var e=this;i&&(e.buffer+=e.decoder.decode(i,{stream:!0}));function s(){var E=e.buffer,h=0;for(E=S(E);h<E.length&&E[h]!=="\r"&&E[h]!==`
`;)++h;var d=E.slice(0,h);return E[h]==="\r"&&++h,E[h]===`
`&&++h,e.buffer=E.slice(h),d}function l(E){P(E,function(h,d){},/:/)}try{var f="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;f=s();var o=f.match(/^()?WEBVTT([ \t].*)?$/);if(!o||!o[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var t=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(t?t=!1:f=s(),e.state){case"HEADER":/:/.test(f)?l(f):f||(e.state="ID");continue;case"NOTE":f||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(f)){e.state="NOTE";break}if(!f)continue;if(e.cue=new M.default(0,0,""),e.state="CUE",f.indexOf("-->")===-1){e.cue.id=f;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{T(f,e.cue,e.regionList)}catch{e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":{var n=f.indexOf("-->")!==-1;if(!f||n&&(t=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=f}continue;case"BADCUE":f||(e.state="ID")}}}catch{e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},g.flush=function(){var i=this;try{if((i.cue||i.state==="HEADER")&&(i.buffer+=`

`,i.parse()),i.state==="INITIAL"||i.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(e){i.onparsingerror&&i.onparsingerror(e)}return i.onflush&&i.onflush(),this},y}()},"./src/utils/webvtt-parser.ts":function(j,C,x){x.r(C),x.d(C,"generateCueId",function(){return p}),x.d(C,"parseWebVTT",function(){return g});var M=x("./src/polyfills/number.ts"),O=x("./src/utils/vttparser.ts"),A=x("./src/demux/id3.ts"),b=x("./src/utils/timescale-conversion.ts"),P=x("./src/remux/mp4-remuxer.ts"),I=/\r\n|\n\r|\n|\r/g,L=function(i,e,s){return s===void 0&&(s=0),i.slice(s,s+e.length)===e},T=function(i){var e=parseInt(i.slice(-3)),s=parseInt(i.slice(-6,-4)),l=parseInt(i.slice(-9,-7)),f=i.length>9?parseInt(i.substring(0,i.indexOf(":"))):0;if(!Object(M.isFiniteNumber)(e)||!Object(M.isFiniteNumber)(s)||!Object(M.isFiniteNumber)(l)||!Object(M.isFiniteNumber)(f))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+i);return e+=1e3*s,e+=60*1e3*l,e+=60*60*1e3*f,e},S=function(i){for(var e=5381,s=i.length;s;)e=e*33^i.charCodeAt(--s);return(e>>>0).toString()};function p(c,i,e){return S(c.toString())+S(i.toString())+S(e)}var y=function(i,e,s){var l=i[e],f=i[l.prevCC];if(!f||!f.new&&l.new){i.ccOffset=i.presentationOffset=l.start,l.new=!1;return}for(;(o=f)!==null&&o!==void 0&&o.new;){var o;i.ccOffset+=l.start-f.start,l.new=!1,l=f,f=i[l.prevCC]}i.presentationOffset=s};function g(c,i,e,s,l,f,o,t){var n=new O.VTTParser,E=Object(A.utf8ArrayToStr)(new Uint8Array(c)).trim().replace(I,`
`).split(`
`),h=[],d=Object(b.toMpegTsClockFromTimescale)(i,e),u="00:00.000",r=0,a=0,v,m=!0;n.oncue=function(D){var R=s[l],F=s.ccOffset,_=(r-d)/9e4;R!=null&&R.new&&(a!==void 0?F=s.ccOffset=R.start:y(s,l,_)),_&&(F=_-s.presentationOffset);var B=D.endTime-D.startTime,U=Object(P.normalizePts)((D.startTime+F-a)*9e4,f*9e4)/9e4;D.startTime=Math.max(U,0),D.endTime=Math.max(U+B,0);var N=D.text.trim();D.text=decodeURIComponent(encodeURIComponent(N)),D.id||(D.id=p(D.startTime,D.endTime,N)),D.endTime>0&&h.push(D)},n.onparsingerror=function(D){v=D},n.onflush=function(){if(v){t(v);return}o(h)},E.forEach(function(D){if(m)if(L(D,"X-TIMESTAMP-MAP=")){m=!1,D.slice(16).split(",").forEach(function(R){L(R,"LOCAL:")?u=R.slice(6):L(R,"MPEGTS:")&&(r=parseInt(R.slice(7)))});try{a=T(u)/1e3}catch(R){v=R}return}else D===""&&(m=!1);n.parse(D+`
`)}),n.flush()}},"./src/utils/xhr-loader.ts":function(j,C,x){x.r(C);var M=x("./src/utils/logger.ts"),O=x("./src/loader/load-stats.ts"),A=/^age:\s*[\d.]+\s*$/m,b=function(){function P(L){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=L?L.xhrSetup:null,this.stats=new O.LoadStats,this.retryDelay=0}var I=P.prototype;return I.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},I.abortInternal=function(){var T=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),T&&(T.onreadystatechange=null,T.onprogress=null,T.readyState!==4&&(this.stats.aborted=!0,T.abort()))},I.abort=function(){var T;this.abortInternal(),(T=this.callbacks)!==null&&T!==void 0&&T.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},I.load=function(T,S,p){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=T,this.config=S,this.callbacks=p,this.retryDelay=S.retryDelay,this.loadInternal()},I.loadInternal=function(){var T=this.config,S=this.context;if(!!T){var p=this.loader=new self.XMLHttpRequest,y=this.stats;y.loading.first=0,y.loaded=0;var g=this.xhrSetup;try{if(g)try{g(p,S.url)}catch{p.open("GET",S.url,!0),g(p,S.url)}p.readyState||p.open("GET",S.url,!0);var c=this.context.headers;if(c)for(var i in c)p.setRequestHeader(i,c[i])}catch(e){this.callbacks.onError({code:p.status,text:e.message},S,p);return}S.rangeEnd&&p.setRequestHeader("Range","bytes="+S.rangeStart+"-"+(S.rangeEnd-1)),p.onreadystatechange=this.readystatechange.bind(this),p.onprogress=this.loadprogress.bind(this),p.responseType=S.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),T.timeout),p.send()}},I.readystatechange=function(){var T=this.context,S=this.loader,p=this.stats;if(!(!T||!S)){var y=S.readyState,g=this.config;if(!p.aborted&&y>=2)if(self.clearTimeout(this.requestTimeout),p.loading.first===0&&(p.loading.first=Math.max(self.performance.now(),p.loading.start)),y===4){S.onreadystatechange=null,S.onprogress=null;var c=S.status;if(c>=200&&c<300){p.loading.end=Math.max(self.performance.now(),p.loading.first);var i,e;if(T.responseType==="arraybuffer"?(i=S.response,e=i.byteLength):(i=S.responseText,e=i.length),p.loaded=p.total=e,!this.callbacks)return;var s=this.callbacks.onProgress;if(s&&s(p,T,i,S),!this.callbacks)return;var l={url:S.responseURL,data:i};this.callbacks.onSuccess(l,p,T,S)}else p.retry>=g.maxRetry||c>=400&&c<499?(M.logger.error(c+" while loading "+T.url),this.callbacks.onError({code:c,text:S.statusText},T,S)):(M.logger.warn(c+" while loading "+T.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,g.maxRetryDelay),p.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),g.timeout)}},I.loadtimeout=function(){M.logger.warn("timeout while loading "+this.context.url);var T=this.callbacks;T&&(this.abortInternal(),T.onTimeout(this.stats,this.context,this.loader))},I.loadprogress=function(T){var S=this.stats;S.loaded=T.loaded,T.lengthComputable&&(S.total=T.total)},I.getCacheAge=function(){var T=null;if(this.loader&&A.test(this.loader.getAllResponseHeaders())){var S=this.loader.getResponseHeader("age");T=S?parseFloat(S):null}return T},P}();C.default=b}}).default})})(be);var Ye=Ve(be.exports),Xe=je({__proto__:null,default:Ye},[be.exports]);export{Xe as h};
